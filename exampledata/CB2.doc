<html xmlns:v="urn:schemas-microsoft-com:vml"
    xmlns:o="urn:schemas-microsoft-com:office:office"
    xmlns:w="urn:schemas-microsoft-com:office:word"
    xmlns="http://www.w3.org/TR/REC-html40">
    <head><meta http-equiv=Content-Type content="text/html; charset=utf-8">
    <style type="text/css">
        table  
        {  
            border-collapse: collapse;
            border: none;  
            width: 100%;  
        }  
        td,tr  
        {  
            border: solid #CCC 1px;
            padding:3px;
            font-size:9pt;
        } 
        .codestyle{
            word-break: break-all;
            mso-highlight:rgb(252, 252, 252);
            padding-left: 5px; background-color: rgb(252, 252, 252); border: 1px solid rgb(225, 225, 232);
        }
        img {
            width:100;
        }
    </style>
    <meta name=ProgId content=Word.Document>
    <meta name=Generator content="Microsoft Word 11">
    <meta name=Originator content="Microsoft Word 11">
    <xml><w:WordDocument><w:View>Print</w:View></xml></head>
    <body><h1>1、欢迎使用CEIBA2产品运维文档系统</h1><div style="margin-left:20px;"><h1>欢迎使用CEIBA2产品运维文档系统</h1>
<h2>使用说明：</h2>
<h2>FAQ（常见问题解答）；
该系统记录了用户日常使用平台过程中遇到的各类问题的解决方法；
比如服务器升级、数据库操作、视频无法预览、API对接、数据备份还原等；</h2>
<p>在使用平台的用户可以参考FAQ记录的相关文档，
针对遇到的问题，从中找到解决方法，快速处理问题，缩短客户等待时间，提高服务效率；
并且，可以参考FAQ对平台基本信息的相关介绍，科学的管理服务器，保证运营服务器的正常运行；</p>
<h2>操作说明：</h2>
<p>1、登录平台FAQ系统；
2、输入问题关键字搜索问题处理方法；
3、阅读文档；
4、参考文档中介绍的方法处理遇到的问题；
1、登录平台FAQ系统；
使用浏览器（谷歌、IE11等）输入以下网址，回车进入即可（无需注册、登录）；
<a href="http://jfwiki.streamax.com:7503/web/#/172/1275">http://jfwiki.streamax.com:7503/web/#/172/1275</a></p>
<p>2、输入问题关键字搜索问题处理方法；
可以通过问题关键字进行搜索，也可以根据问题分类手动进行查找；</p>
<p>3、阅读文档；
点击搜索出来的结果，或者点击手动查找记录的文档；</p>
<p>4、参考文档中介绍的方法处理遇到的问题；</p></div><h1>2、运维文档更新记录</h1><div style="margin-left:20px;"><p>[toc]</p>
<h1>运维文档更新记录</h1>
<h2>业务知识汇总</h2>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>263版本端口说明</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1277" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>车辆上下线</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1546" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-04-01</td>
</tr>
<tr>
<td>3</td>
<td>证据中心</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1547" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-04-01</td>
</tr>
<tr>
<td>4</td>
<td>直通视频</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1548" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-04-01</td>
</tr>
<tr>
<td>5</td>
<td>自动下载</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1549" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-04-01</td>
</tr>
</tbody>
</table>
<h2>系统安装部署</h2>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>服务器配置推荐</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1278" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>安装包下载</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1281" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>CMS Server部署准备</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1281" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>4</td>
<td>CMS Server安装</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1279" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h2>平台服务升级</h2>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>备份数据</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1283" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>卸载CMS Server</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1328" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>CMS Server升级</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1282" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>4</td>
<td>2.6.3.26.04升级2.6.3.0.63</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1376" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>5</td>
<td>单机252升级263操作手册</td>
<td><a href="hhttp://jfwiki.streamax.com:7503/web/#/172/1641" title="点我查看">点我查看</a></td>
<td>钟子浩</td>
<td>2022-04-02</td>
</tr>
<tr>
<td>6</td>
<td>单机262升级263操作手册</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1642" title="点我查看">点我查看</a></td>
<td>钟子浩</td>
<td>2022-04-02</td>
</tr>
<tr>
<td>7</td>
<td>单机263升级263操作手册</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1643" title="点我查看">点我查看</a></td>
<td>钟子浩</td>
<td>2022-04-02</td>
</tr>
</tbody>
</table>
<h2>基础运维操作</h2>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>服务的启动、停止、重启</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1284" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>查看端口监听</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1286" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2021-12-20</td>
</tr>
<tr>
<td>3</td>
<td>检查端口映射</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1301" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2021-12-20</td>
</tr>
<tr>
<td>4</td>
<td>定时备份</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1371" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-1-6</td>
</tr>
<tr>
<td>5</td>
<td>nginx的启动、停止、重载</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1648" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-4-11</td>
</tr>
</tbody>
</table>
<h2>常用运维工具</h2>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>WireShark抓包工具</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1287" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>DebugView打印工具</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1291" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>Redis数据库管理工具</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1288" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>4</td>
<td>Mysql数据库管理工具</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1290" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>5</td>
<td>DataTool自动备份工具</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1292" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>6</td>
<td>Mongodb数据库管理工具</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1289" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>7</td>
<td>PostMan接口测试工具</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1889" title="点我查看">点我查看</a></td>
<td>黄天</td>
<td>2022-07-08</td>
</tr>
</tbody>
</table>
<h2>FAQ：</h2>
<h3>客户端--PC</h3>
<h4>登录</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>客户端登录失败</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1293" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>客户端登陆提示load错误</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1294" title="点我查看">点我查看</a></td>
<td>曹志豪</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>客户端登录界面显示问号</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1373" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-1-6</td>
</tr>
</tbody>
</table>
<h4>实时视频</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>实时视频无法查看</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1295" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>实时视频花屏</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1296" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>设备回放</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>客户端回放无法查看</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1297" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>回放无法下载</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1298" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>证据中心</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>触发告警较多但证据存在漏传</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1309" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>打开证据中心提示服务器错误</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1310" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>服务器有证据文件，但证据中心未更新</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1311" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>4</td>
<td>邮箱推送的链接可以打开证据，但证据中心无法查询</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1312" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>5</td>
<td>证据点开的通道顺序与实时视频顺序不一致</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1313" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>6</td>
<td>设备从某个日期后无证据文件</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1314" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>远程设置</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>N9M1.0设备无法打开远程设置</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1299" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>N9M2.0设备无法打开远程设置</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1300" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>打开N9M2.0的远程提示“An error occurred”</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1302" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>设备在线</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>所有车辆不在线</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1303" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>车辆频繁上下线或车辆离线但实际在线</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1304" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>远程升级</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>远程升级修改ftp端口</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1307" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>远程升级返回文件不存在</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1306" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>自动上报</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>车辆未上报（无法自动加车）</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1305" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25 2022年1月6日更新例1</td>
</tr>
</tbody>
</table>
<h4>其他</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>客户端解析地址提示timeout（超时）</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1315" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>客户端点击基础数据跳转空白</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1316" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>车辆无时间、定位、报警（或时间、定位、报警不更新）</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1308" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>4</td>
<td>磁盘容量增加或者新增磁盘后，ADS设置未识别到磁盘变化</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1348" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h3>客户端--Web</h3>
<h4>基础数据</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Web端数据不显示</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1323" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>无法查询角色和用户</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1317" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>点击角色用户没有显示账号</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1320" title="点我查看">点我查看</a></td>
<td>李忠建</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>4</td>
<td>添加角色或添加用户提示服务器错误</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1318" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>5</td>
<td>加车提示车辆已存在</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1324" title="点我查看">点我查看</a></td>
<td>李忠建</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>实时视频</h4>
<h4>设备回放</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Web端无法查看远程回放</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1319" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>web端下载的远程回放点击file list无响应</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1321" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>Web端Https无法查看回放</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1322" title="点我查看">点我查看</a></td>
<td>李忠建</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>4</td>
<td>web端回放无法下载</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1326" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>远程升级</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>使用远程升级创建了任务但是找不到任务</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1325" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2021-11-10</td>
</tr>
</tbody>
</table>
<h4>报表</h4>
<h4>其他</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>访问12055网页提示Server Error in ‘/’Application</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1351" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>Api</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>https请求API错误</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/2001" title="点我查看">点我查看</a></td>
<td>黄天</td>
<td>2022-07-08</td>
</tr>
</tbody>
</table>
<h3>客户端--App</h3>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>安卓手机登录CB2app后无回放按钮</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1327" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h3>服务器</h3>
<h4>服务异常</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>【通用】服务启动失败</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1333" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>多个服务启动失败</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1334" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>数据库端口错误:3307</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1350" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>4</td>
<td>DVRGTService（转发服务）启动失败</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1336" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>5</td>
<td>MongoDB3.2启动失败</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1337" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>6</td>
<td>BaseDataServer启动失败</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1338" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>7</td>
<td>MessageServer启动失败</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1339" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>8</td>
<td>ARMSStorgeService/ARMSRestService启动失败</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1340" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>9</td>
<td>Mysql5.5启动失败</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1341" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>10</td>
<td>所有服务未正常启动，提示请安装服务，未知状态</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1347" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>安装服务</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>CB2多转发配置(DVRGT)</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1342" title="点我查看">点我查看</a></td>
<td>李忠建</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>安装国标服务</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1343" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2021-12-20</td>
</tr>
</tbody>
</table>
<h4>HTTPS部署</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2.6.3.0.55及以上版本</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1345" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>2.6.3.0.55以下版本</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1346" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h4>其他</h4>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>运行看门狗工具提示other user run program</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1335" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2021-11-30</td>
</tr>
<tr>
<td>2</td>
<td>修改8081端口</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1411" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2021-11-30</td>
</tr>
<tr>
<td>3</td>
<td>修改CB2每天自动重启时间</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1504" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-03-27</td>
</tr>
<tr>
<td>4</td>
<td>更改自动下载文件和证据文件存放路径</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1506" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-03-27</td>
</tr>
<tr>
<td>5</td>
<td>CEIBA2服务器清理硬盘空间</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1530" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2022-03-30</td>
</tr>
</tbody>
</table>
<h3>数据库</h3>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>进入数据库</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1329" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>2</td>
<td>还原数据库密码</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1330" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>3</td>
<td>修复损坏的数据表</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1331" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
<tr>
<td>4</td>
<td>忘记密码后修改用户密码</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1332" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2020-12-25</td>
</tr>
</tbody>
</table>
<h3>安全漏洞</h3>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>FAQ标题</th>
<th>链接</th>
<th>更新人员</th>
<th>时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>log4j2漏洞</td>
<td><a href="http://jfwiki.streamax.com:7503/web/#/172/1344" title="点我查看">点我查看</a></td>
<td>张利</td>
<td>2021-12-15</td>
</tr>
</tbody>
</table></div><h1>3、版本更新说明</h1><div style="margin-left:0px;"><h2>3.1、CB2所有版本更新信息</h2><div style="margin-left:0px;"><p>[toc]</p>
<h1>CB2所有版本更新信息</h1>
<h4>当前页面仅作为历史版本信息记录以及参考，不做版本推荐，最新安装包下载查看：<a href="http://jfwiki.streamax.com:7503/web/#/172/1509">http://jfwiki.streamax.com:7503/web/#/172/1509</a></h4>
<h2>2.6.7.0.9</h2>
<p>更新说明：
2023年3月22日  别装， 要装联系夏老师</p>
<p>1、新增License控制。
（1）根据授权文件，控制设备接入量。
（2）根据授权文件，控制License 过期时间。
（3）根据授权文件，控制API是否开放。
（4）授权文件支持一机一码，即一个授权文件只能适用一台服务器，此授权码不能给其他服务器使用。
（5）授权文件支持客户级隔离，比如718客户授权是3年，此授权不能给1448服务器使用。
2、安全性升级，针对老旧的三方组件，更新升级。并且针对之前扫描的高危漏洞全部修复。
3、软件优化，针对CPU使用比较高的优化。特别是虚拟机，云服务器，CPU使用率下降30%+
4、自定义语言，Logo，前方技术支持可以根据客户需要自行更换Logo和语言，并根据脚本打包发布，此类需求无需再导入到产品和研发。
5、新增服务监控接口，对主要业务功能进行监控，比如证据，视频等。由原来被动接收服务异常，变为主动监控服务异常。（目前小范围推广，建议选小客户，并且与客户沟通我们可以去获取日志数据，就联系技术专家部先部署后，然后通过日志分析准确度，以便调整精度）
6、增加单机自愈能力，针对本机服务异常，能做自我诊断和修复。保障服务器更高的可用性。|</p>
<h2>2.6.4.0.26</h2>
<p>针对上一个版本修复的bug和优化的功能如下：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b4d9bdd251b30c51349c7479a078e3a6" alt="" /></p>
<h2>2.6.4.0.18</h2>
<p>版本更新记录</p>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>比起2.6.3.0.63的版本变化</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>新增从WEB端直接下载客户端的功能</td>
</tr>
<tr>
<td>2</td>
<td>新增强制校验密码强度功能</td>
</tr>
<tr>
<td>3</td>
<td>新增密码有效期</td>
</tr>
<tr>
<td>4</td>
<td>新增用户长期无操作自动注销</td>
</tr>
<tr>
<td>5</td>
<td>新增连续登录失败锁定账号</td>
</tr>
<tr>
<td>6</td>
<td>客户端增加验证码</td>
</tr>
<tr>
<td>7</td>
<td>支持多个接入服务，多个证据接收服务，一定程度上提升性能和可用性。</td>
</tr>
<tr>
<td>8</td>
<td>升级百度地图API至3.0，API Key支持自定义。</td>
</tr>
<tr>
<td>9</td>
<td>更新IOS推送接口，解决IOS APP报警不推送的问题。</td>
</tr>
<tr>
<td>10</td>
<td>自动下载支持子存储器。</td>
</tr>
<tr>
<td>11</td>
<td>自动下载并发由20增加至60</td>
</tr>
<tr>
<td>12</td>
<td>MySQL版本由5.5升级至5.7，Nginx版本升级至1.21.1.1</td>
</tr>
<tr>
<td>13</td>
<td>增加在线回放是否下载黑匣子的选项，兼容MDVR协议类型的设备在线回放。</td>
</tr>
</tbody>
</table>
<p>获取客户端</p>
<p>V2.6.4版本客户端和服务器由于增加了安全性和分布式接入特性，无法兼容历史版本，使用新版本必须安装配套的客户端/服务器。
客户端现在可以从WEB端直接下载，登录后点击version信息中的客户端版本号即可下载客户端。</p>
<blockquote>
<p>服务器版本为264，客户端也必须使用264的版本，不然无法查看视频。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9ca1a0f9454a64ab5871b677f67f43be" alt="" /></p>
<p>端口说明</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5ce3ce6503b6a9df07d706cca1413bcc" alt="" /></p>
<p>datatool备份中数据类型解释</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fd5b660ee1d46a64aa03d239a7873497" alt="" /></p>
<h2>2.6.3.0.80</h2>
<p>修复了之前263版本的问题，且支持直通存储。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1cab869d1f3250a2917475aa428604e7" alt="" /></p></div><h2>3.2、2.6.4.0.26</h2><div style="margin-left:0px;"><h1>新增或修改功能</h1>
<p><strong>必须与产品和研发沟通后才能部署！</strong>
<strong>必须与产品和研发沟通后才能部署！</strong>
<strong>必须与产品和研发沟通后才能部署！</strong>
针对上一个版本修复的bug和优化的功能如下：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b4d9bdd251b30c51349c7479a078e3a6" alt="" /></p></div><h2>3.3、2.6.4.0.18（有bug不建议安装）</h2><div style="margin-left:0px;"><h1>2.6.4.0.18</h1>
<h2>版本更新记录</h2>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>比起2.6.3.0.63的版本变化</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>新增从WEB端直接下载客户端的功能</td>
</tr>
<tr>
<td>2</td>
<td>新增强制校验密码强度功能</td>
</tr>
<tr>
<td>3</td>
<td>新增密码有效期</td>
</tr>
<tr>
<td>4</td>
<td>新增用户长期无操作自动注销</td>
</tr>
<tr>
<td>5</td>
<td>新增连续登录失败锁定账号</td>
</tr>
<tr>
<td>6</td>
<td>客户端增加验证码</td>
</tr>
<tr>
<td>7</td>
<td>支持多个接入服务，多个证据接收服务，一定程度上提升性能和可用性。</td>
</tr>
<tr>
<td>8</td>
<td>升级百度地图API至3.0，API Key支持自定义。</td>
</tr>
<tr>
<td>9</td>
<td>更新IOS推送接口，解决IOS APP报警不推送的问题。</td>
</tr>
<tr>
<td>10</td>
<td>自动下载支持子存储器。</td>
</tr>
<tr>
<td>11</td>
<td>自动下载并发由20增加至60</td>
</tr>
<tr>
<td>12</td>
<td>MySQL版本由5.5升级至5.7，Nginx版本升级至1.21.1.1</td>
</tr>
<tr>
<td>13</td>
<td>增加在线回放是否下载黑匣子的选项，兼容MDVR协议类型的设备在线回放。</td>
</tr>
</tbody>
</table>
<h2>获取客户端</h2>
<p>V2.6.4版本客户端和服务器由于增加了安全性和分布式接入特性，无法兼容历史版本，使用新版本必须安装配套的客户端/服务器。
客户端现在可以从WEB端直接下载，登录后点击version信息中的客户端版本号即可下载客户端。</p>
<blockquote>
<p>服务器版本为264，客户端也必须使用264的版本，不然无法查看视频。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9ca1a0f9454a64ab5871b677f67f43be" alt="" /></p>
<h2>端口说明</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5ce3ce6503b6a9df07d706cca1413bcc" alt="" /></p>
<h2>datatool备份中数据类型解释</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fd5b660ee1d46a64aa03d239a7873497" alt="" /></p></div><h2>3.4、2.6.3.0.90（2.6.3最新最稳定版本推荐安装</h2><div style="margin-left:0px;"><h1>2.6.3.0.90（2.6.3最新最稳定版本推荐安装）</h1>
<p>| 服务器端 | <a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263090/Ceiba2Srv_2.6.3.0.90_CN.exe" title="Ceiba2Srv_2.6.3.0.90_CN.exe">Ceiba2Srv_2.6.3.0.90_CN.exe</a> | 中文 | 2022/09/15 | 与客户端版本2.6.3.0.87搭配使用 |</p>
<p>87版本及以上均支持ADS自动下载数上限增加到60；</p>
<p>90版本中Mangodb服务被弃用，在其他服务均正常的情况下，不需要管当前服务是否启动，不影响业务
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=ac5e3cc3d395253a7abd02a1baf35578" alt="" /></p></div><h2>3.1、定制版本</h2><div style="margin-left:20px;"></div></div><h1>4、业务知识汇总</h1><div style="margin-left:0px;"><h2>4.1、总体架构</h2><div style="margin-left:0px;"><h1>总体架构图</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f9d835b7695cb098e4cf1931b70a8ca8" alt="" /></p>
<h1>模块依赖图</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5a20b9658f8bcfaf931c00a2c7106387" alt="" /></p></div><h2>4.2、车辆上下线</h2><div style="margin-left:0px;"><p>[toc]</p>
<h1>车辆上下线功能</h1>
<h2>1 概述</h2>
<p>对车辆上下线功能的梳理，贯穿前端、后端、设备，方便后续维护。</p>
<h2>2 功能总体设计</h2>
<h3>2.1 业务模型</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/713d54d8edf075f4f2ba5ed7886c4380" alt="" /></p>
<p>用户使用客户端（CB2客户端、WEB客户端）登录后，能查看到具备权限的车辆的在线状态，以及能接收到车辆的状态变化。</p>
<h3>2.2 功能框架</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b07da1a02e83148bc57162c4d7336188" alt="" /></p>
<p>概述：</p>
<ol>
<li>
<p>登录：用户使用账号密码通过客户端登录服务器，客户端接入服务产生一个连接ID并返回给客户端，作为后续通讯的session id</p>
</li>
<li>
<p>订阅在线状态：客户端在登录成功后，发起订阅设备在线状态请求，该请求是通过客户端接入转发到在线服务，在线服务把用户权限范围内的设备状态打包到回复消息中，通过客户端接入转发到客户端</p>
</li>
<li>
<p>设备状态变化推送：在线服务8秒检查一次设备状态；如果当前时间与设备最后一次更新的时间相隔超过30秒则算作下线（15秒会从redis中获取一次所有的在线设备，并更新内存中缓存的最后一次时间），加入推送通知队列；如果设备状态为新上线，则加入推送通知队列；</p>
</li>
<li>定时推送所有设备状态：在线服务30秒检查一次用户列表；如果当前时间与用户最后一次推送时间相隔130秒，则推送一次该用户权限下的所有在线设备列表</li>
</ol>
<p>异常情况：</p>
<p>1.客户端退出时没有发送登出指令，在线服务在定时推送某用户session id对应的设备状态时，客户端接入服务发现该用户已经下线（客户端与客户端接入有心跳），则回复在线服务该用户已不在线，在线服务会清理该用户对应的缓存信息。</p>
<h2>3 功能详细设计</h2>
<h3>3.1 登录</h3>
<h4>3.1.1 UI</h4>
<p>Web端登录界面：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d6a692c9658b1c013f00404822ca3d6b" alt="" /></p>
<p>客户端登录界面：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4fa19bf90a9be2177ad1936778ed99a1" alt="" /></p>
<h4>3.1.2 权限</h4>
<p>每个账户都有权限限制，只能获取到账户权限下的设备列表。</p>
<h4>3.1.3 对应关系</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a3b01a7ee7529c7378722a0ff8c05617" alt="" /></p>
<p>概述：</p>
<ol>
<li>客户端接入与WEB服务的对应关系是1对1的关系，WEB服务通过超级用户登录，即客户端接入后续会把所有车辆的状态变化都推送给WEB服务</li>
</ol>
<p>异常情况：如果WEB服务与客户端接入服务连接异常，则WEB服务默认5分钟后再重新连接登录</p>
<ol>
<li>
<p>WEB服务与WEB端页面是1对多的关系，WEB服务针对用户和车辆做了订阅推送功能；WEB服务在启动的时候订阅1次</p>
</li>
<li>客户顿接入与CB客户端是1对多的关系</li>
</ol>
<h2>4 数据库</h2>
<h3>4.1 redis</h3>
<p>redis管理工具见以下链接：<a href="http://jfwiki.streamax.com:7503/web/#/172/1288">http://jfwiki.streamax.com:7503/web/#/172/1288</a></p>
<p>在线列表：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b352f7c95af3bbe088a66e9f92a7881b" alt="" /></p>
<p>设备信息：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/da086edd5ecd5ef6bd8191105cf3d38b" alt="" /></p>
<h2>5 常见问题</h2>
<h3>5.1 新建账户立即登录，车辆需要过一段时间才能上线</h3>
<p>原因：在线服务默认120秒从mysql同步用户与车辆的映射关系，新建的账户登录后需要过一段时间才能收到上线车辆信息</p>
<h3>5.2 CB客户端车辆在线，WEB车辆不在线</h3>
<p>可能原因：</p>
<p>客户端接入和WCMS5服务同时停掉，然后WCMS5服务比客户端接入服务先启动</p>
<p>客户端接入与WEB服务的对应关系是1对1的关系，WEB服务通过超级用户登录，即客户端接入后续会把所有车辆的状态变化都推送给WEB服务</p>
<p>异常情况：如果WEB服务与客户端接入服务连接异常，则WEB服务默认5分钟后再重新连接登录</p>
<p>如果是该种情况，则5分钟后应该会回复正常，除非在线服务出问题，导致没有再推在线信息</p>
<blockquote>
<p>遇到该情况，可以先重启ClientAccess服务，等该服务成功启动后，再去重启WCMS5服务。</p>
</blockquote>
<h3>5.3 车辆一直无法上线，但是gps在更新</h3>
<p>可能原因：</p>
<p>在241、251版本中存在服务启动顺序的问题，导致在线状态不对。主要涉及两个服务，注册（MessagerServer）服务、redis服务。</p>
<p>设备接入服务会把在线设备列表存入redis中，在线服务会定时到redis中读取在线列表并推送到客户端。如果注册服务在存在线状态的的过程中redis服务还未启动，且之后车辆一直与设备接入服务保持连接，则该辆车的在线状态会一直处于离线状态（原因是注册服务没有改变某辆车的在线状态的机会）。</p>
<p>有gps和实时报警更新的原因是gps和报警都是通过报警服务实时推送的，与在线状态没有任何关系。</p>
<p>解决方法：</p>
<p>将redis的顺序调整到注册服务之前，并重启看门狗服务“DVRRTService”和工具“DVRServerCtrl”。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f20f8236774f9d0b68a8aa74e8fc93b2" alt="" /></p>
<p>或者先重启redis，在重启注册服务。</p>
<p>验证：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c48c78de19a55977fbc26a3913b6164b" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9cff77efaddd56fc8bd898ff89856963" alt="" /></p>
<p>日志打印：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b5ee6b587b553f82761a55a67ece1749" alt="" /></p></div><h2>4.3、证据中心</h2><div style="margin-left:0px;"><h1>证据中心</h1>
<h2>1. 证据中心高频业务数据流</h2>
<h3>1.1 证据上传的3种方式</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/52e6e1fce380250a93e9c73055e5ff4d" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/eab9cbb8b5c38c04c5cce4de0f27589f" alt="" /></p>
<h3>1.2 260之前版本数据流图</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f3a50661e4219e084aa23c5d76312ca8" alt="" /></p>
<h3>1.3 260-263版本数据流图</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/202204bb4f6b38bbf35cfc2748798e22" alt="" /></p>
<h3>1.4 N9M2.0协议版本数据流图</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2efb9933e0ea3000a3fcaa9ec3037ac2" alt="" /></p>
<h3>1.5 证据上传</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a88bbca3ae244e2b56283509c0581e66" alt="" /></p>
<h3>1.6 证据分析</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7888f819a589c4a2277dd8181c1bb79f" alt="" /></p>
<h3>1.7 证据回放</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/aea6d0285a9e3a2757fea2ac6a1cbfb4" alt="" /></p>
<h3>1.8 证据导出</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/244ad108cea5b27280c011b388a86b28" alt="" /></p>
<h3>1.9 证据删除</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8e3d5d0e3b437887ea64b63e9b67a4bb" alt="" /></p>
<h3>1.10 证据迁移</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/56256f1f756a4a3406f965b08200b279" alt="" /></p>
<h2>2. 常见问题分析</h2>
<h3>2.1 检测证据策略服务是否收到报警</h3>
<p>使用redis数据库管理工具连接数据库：<a href="http://jfwiki.streamax.com:7503/web/#/172/1288">http://jfwiki.streamax.com:7503/web/#/172/1288</a></p>
<p>任务队列名：设备ID_ev_task
Size：任务排队总数
当前任务为第一条记录（row为1的那条数据）
任务信息种的lastsendtime为证据指令下发的时间戳，任务未下发时默认为0，不为0时表示证据指令已经下发给设备</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/164076ffe40093304938c55b1437464a" alt="" /></p>
<h3>2.2 检查证据是否已分析入库--针对2.6.3.0.45以及之后版本</h3>
<p>使用mongodb数据库管理工具连接数据库：<a href="http://jfwiki.streamax.com:7503/web/#/172/1289">http://jfwiki.streamax.com:7503/web/#/172/1289</a></p>
<p>首先需要在alarm表里面查询到设备的报警信息，获取到报警ID。</p>
<p>根据获取到的报警ID，打开evidence表进行查询</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3f772379c2b9bbeaf9c1c79888b5be4e" alt="" /></p>
<p>若存在记录，且evidencestatus字段值为0，则证据已经正常分析入库，否则证据未分析或分析失败。</p>
<blockquote>
<p>关于evidencestatus 值对应的证据状态
0--分析完成
1--失败
2--等待下载中
3--下载中
4--下载完成
5--证据转码中
6--代表证据上传过程中设备返回了异常结束错误码(此类证据无法转码了)</p>
</blockquote>
<p><strong>然后检查证据分析的消息队列是否有排队</strong></p>
<p>使用redis数据库管理工具连接数据库：<a href="http://jfwiki.streamax.com:7503/web/#/172/1288">http://jfwiki.streamax.com:7503/web/#/172/1288</a></p>
<p>查看uploadevidence的Size值，当前表示只有1条证据在分析。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/892fe35a2839913b2b787fa5702e011d" alt="" /></p></div><h2>4.4、直通视频</h2><div style="margin-left:0px;"><h1>直通视频</h1>
<h2>直通视频数据流</h2>
<p>（1）数据流</p>
<p>客户端 --> 转发服务器 --> 注册服务器 --> 设备 --> 转发服务器 --> 客户端</p>
<p>（2）端口</p>
<p>客户端 --> 17891端口 --> 5556端口 --> 设备 -->12091（mdvr）/12092（n9m）端口 --> 客户端</p>
<blockquote>
<p>注意：264以上的版本 mdvr/n9m的设备都使用12092端口</p>
</blockquote>
<h2>数据流具体步骤</h2>
<p>①　客户端在登录时，动态均衡(7264端口)将转发服务器ip和端口返回给客户端；如果返回值为空，客户端将取web――基础功能――车辆设备，每台设备配置的转发IP和转发端口；</p>
<p>②　当双击车辆进行直通视频查看时，客户端将视频请求指令发送到转发服务器(第1步获取到的IP和端口)；</p>
<p>③　17891端口收到指令后，同时去读取转发服务器 ip和视频数据接收端口(12092或12091)，将这些信息发一起送给注册服务器5556端口；</p>
<p>④　注册服务器将指令下发给设备；</p>
<p>⑤　设备接收指令，主动上报视频数据到转发服务器的12091（mdvr）/12092（n9m）端口；</p>
<p>⑥　转发服务器将请求信息发送到客户端进行展示。</p>
<blockquote>
<p>注意：
a.客户端清除视频，客户端和服务器之间连接会立即断开，但服务器和设备之间连接30秒内不会断开，再次连接则会秒开视频；
b.视频请求时会进行缓冲，防止在播放过程中出现卡顿；
c.设备类型在发送时传的是mysql数据库wcms4.devicefile表中LinkType中的对应值，n9m类型对应数值124，cms类型对应数值121。（可用Dbgview查看发送的信息）</p>
</blockquote></div><h2>4.5、自动下载</h2><div style="margin-left:0px;"><p>[toc]</p>
<h1>自动下载</h1>
<h2>1.自动下载流程</h2>
<p>客户端添加任务、ads服务器生成任务，设备上线，ADS服务经过注册服务器下发任务指令―>设备返回查询结果―>ads服务对返回结果进行解析、拆分文件―>ads下发具体下载文件的指令―>ads将数据存储到服务器</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/08ab6c879b8faa298be05c60ba034be2" alt="" /></p>
<h2>2.下载配置</h2>
<p>(1) 文件夹为Video：在服务器每个盘符根目录下都存在Video文件夹用来存储Ads下载
的.264文件视频和黑匣子数据，存储的盘符由用户进行勾选选择。</p>
<p>文件夹信息存储在mysql数据库wcms4.ads_config表中，<strong>在客户端自动下载配置界面可以修改</strong></p>
<p>(2) 是否覆盖</p>
<p>①　选择的值存储在mysql数据库wcms4.ads_config表中；</p>
<p>②　不勾选，当磁盘已使用空间大于配置使用率减去3GB时，会停止下载；</p>
<p>③　勾选，ADS下载服务，每60秒或在保存视频数据时，启动磁盘检测，当磁盘已使用空间大于配置使用率减去3GB时，覆盖删除最早的视频数据；删除最小单位为天；</p>
<p>④　例如：现选择两块磁盘存储(C、D盘)，每块磁盘100G,配置磁盘使用率90%，</p>
<p>首先存储在C盘，当C盘使用空间为87G时停止存储，转到D盘进行存储数据；</p>
<p>当D盘使用87G（90-3）时，ADS下载服务会启动覆盖删除策略，覆盖删除C、D盘中最早的视频数据（按天删除），</p>
<p>当C或D盘可用空间大于3GB时就会停止覆盖删除操作；</p>
<p>⑤　覆盖删除时，只会删除ads下载服务下载的数据。不会去删除其它程序产生的数据。</p>
<p>(3) 最大连接数</p>
<p>①　设计目的：防止同一时间，所有在线车辆配置任务后同时下载视频或黑匣子数据，造成网络瘫痪；</p>
<p>②　当下载任务达到最大连接数后，其它车辆排入等待状态，当有车辆执行完任务后，将释放一个连接供其它等待中的车辆下载；</p>
<p>③　一辆车，同时只能执行一个下载任务；</p>
<p>④　最大连接数存储在mysql数据库wcms4.ads_config表中。</p>
<p>(4) AP管理：设置每个路由器(ESSID)最大连接数</p>
<p>①　设备通过WIFI上传数据时，会主动上报ESSID到平台；</p>
<p>②　全部ESSID中连接数之和要小于等于最大连接数；</p>
<p>③　AP管理数据存储在mysql数据库wcms4.ads_apconnection表中。</p>
<p>(5) 磁盘配置</p>
<p>①　磁盘信息存储在mysql数据库wcms4.ads_diskpath表中；</p>
<p>②　用户可以自行对磁盘进行存储大小的配置，磁盘使用率默认为盘符容量的90%；</p>
<p>③　支持磁盘映射，磁盘映射成功后，需要手动执行ADS.CheckDiskPath.exe程序。（C:\Program Files (x86)\CMS Server\TransmitServer\AdsServer\CheckDisk\ADS.CheckDiskPath.exe）</p>
<p>(6) 下载删除数据：</p>
<p>①　删除记录存储在mysql数据库wcms4.ads_deletelog表中；</p>
<p>②　ADS下载的数据，不能直接在video目录进行手动删除。手动删除后，会造成在服务器界面能够进行检索，但是不能进行回放；</p>
<p>③　通过界面删除后，会同时删除视频数据，同时也会删除索引数据。</p>
<h2>3.任务管理</h2>
<p>（1）任务添加</p>
<p>①　添加任务后，会向mysql数据库wcms4.ads_task表中写一条记录；</p>
<p>②　当选择多车进行任务添加时，每辆车都会在wcms4.ads_task表中有一条记录；</p>
<p>③　周期性任务（每天、周、月），ADS下载服务每天00:00或ADS服务重启时，会根据wcms4.ads_task表中的任务创建当天或之前未创建的子任务，存储到 wcms4.ads_detailtask表中；</p>
<p>④　单次任务，在任务添加成功后，ADS下载服务会根据wcms4. ads_task表中的任务创建子任务, 存储到 wcms4.ads_detailtask表中；</p>
<p>⑤　任务监控中的任务，从wcms4.ads_detailtask表读取。</p>
<p>（2）任务信息</p>
<p>①　报警视频：车辆触发报警并且配置了录像功能的视频；</p>
<p>②　事件时间范围视频：车辆触发报警并开始进行配置时间前后多少秒的录像视频，此视频数量大于等于报警视频；事件类型信息存储在mysql数据库wcms4.ads_eventtype表中；</p>
<p>③　任务有效期：是任务未下载完成但可以进行任务下载的有效时间,配置有效期，可以防止一些任务在进行下载时失败，在以后的时间都对任务进行下载，阻塞其他任务进行下载；</p>
<p>④　任务周期：分为单次/每天/每周/每月。</p>
<p>（3）相同任务</p>
<p>下载任务相同或者有相同的部分，则对任务进行分析，在当前磁盘中查找该任务时间内的数据信息，</p>
<p>如果该数据信息已经存在，则不会对重复部分进行下载，如果不存在，则开始下载新数据。</p>
<h2>4.任务监控</h2>
<p>（1）高速低速：选择高速下载，车载设备将停止录像功能, 所有设备资源都用来进行高速任务下载。默认为低速下载。</p>
<p>（2）任务优先级</p>
<p>①　单次任务下载优先级大于周期任务（每天/每周/每月）</p>
<p>②　任务类型相同时，以任务开始时间越小，优先级越大</p>
<p>③　任务开始时间相同，任务结束时间越小，优先级越大</p>
<p>④　任务开始结束时间相同，wcms4.ads_detailtask表任务ID越小，优先级越大</p>
<p>⑤　一辆车，同时只能执行一个下载任务</p>
<p>（3）任务状态</p>
<p>①　任务监控页面的任务状态与wcms4.ads_detailtask表中的对应关系</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e115bd31dc9f2e9ca8b70bbb6304b9a1" alt="" /></p>
<p>（4）视频下载失败处理策略：总的思路：进行三轮，每轮下载3次。共9次下载。</p>
<p>如果9次下载失败就设置任务为任务下载失败。不再对任务进行下载</p>
<p>①　当前下载任务，单个视频文件（每个通道，在任务时间内每30分钟分割）下载失败后，将这个视频文件放到文件队列的最后，等其它文件下载完成后，再来下载失败的的文件；</p>
<p>②　当前下载任务，如果视频文件在循环下载三次还是失败后，会将当下载任务放到任务队列的最后。等于其它任务下载完成后，再来下载失败的任务；</p>
<p>③　失败任务循环下载三次还是失败，会将任务状态设置为任务下载失败，不会再对这个任务进行下载。</p>
<h2>5.ADS数据存储</h2>
<p>（1）ADS下载的黑匣子数据：</p>
<p>①　Ads下载服务下载后，黑匣子文件存储在Video文件夹中（eg：C:\Video\00830007CB\2017-09-01\log）；</p>
<p>②　rbb格式的黑匣子文件下载完成后，ads下载服务会将rbb格式的文件转换为一个json文件存储在（eg：C:\Video\00830007CB\2017-09-01\log\blackbox\ blackbox_2017_09_01_000000000000.json）；</p>
<p>ads下载服务同时会向mysql的wcms4.ads_blackbox表中写入一条记录（设备ID、黑匣子日期、json文件存储的路径，状态为1）。</p>
<p>黑匣子读取服务（12040端口）会定时从wcms4.ads_blackbox表中读取状态为1的记录；</p>
<p>再根据路径去解析这个json文件存储到mongodb中；解析完成后将mysql数据库中的状态修改为2。</p>
<p>（2）ADS下载的视频数据</p>
<p>①　下载的.264文件存储在Video文件夹（eg：C:\Video\00830007CB\2017-09-01\record）；</p>
<p>②　264下载完成后，ADS下载服务会向mysql数据库的wcms4.ads_videocount表中写写一条记录（每车每天一条），用于黑匣子查询服务(12040端口)检索车辆当天是否有视频数据；</p>
<p>③　264下载完成后，ADS下载服务会将当天的264文件生成索引文件，索引文件存放于（eg：C:\Program Files (x86)\CMS Server\WCMS4.0\VideoData\0088004287\ 2017-09-13.db ，此文件可以用SQLite Expert软件打开）。</p>
<p>用于服务器回放服务(12045端口)查询每一个时间点对应的264文件存储的位置。</p>
<h2>6.任务报表</h2>
<p>（1）任务查询：按照任务时间、任务类型、录像文件时间等查询条件进行任务查询，可以查询出全部任务的详细信息。</p>
<p>（2）回放：点击回放按钮，对已下载的任务进行服务器回放。</p>
<h2>7.任务回收站</h2>
<p>任务失败：配置任务下发到设备，设备接收失败或者是设备上传任务数据时失败，则将任务回撤到队尾进入等待状态，</p>
<p>当任务到达队列头则重新进行任务下发，如此三次下发任务，都失败则导致任务失败，可以在任务回收站中查看任务失败详情，也可以对任务进行重新下载以及下载进度查看。</p>
<h2>8.其他数据表</h2>
<p>（1）Ads下载车组列表:mysql数据库wcms4.ads_device表中；</p>
<p>（2）任务排序表：mysql数据库wcms4.ads_tasksort表中。</p></div><h2>4.6、设备名称取名建议</h2><div style="margin-left:0px;"><h2>设备命名常见规则</h2>
<p>采用字母、数字、下划线、汉字组合取名，长度不超过16个字符如：“<code>渝A_123456</code>”</p>
<p>避免采用：引号<code>“ ”</code>，空格<code> </code>，斜杠、反斜杠<code>/ | \</code>等非法字符命名设备</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=c59eba1e988a49de88f54000550f9e22" alt="" /></p></div><h2>4.7、N9M设备1.0与2.0差别</h2><div style="margin-left:0px;"><h1>N9M设备1.0与2.0差别</h1>
<ol>
<li>2.0设备不支持证据流量统计</li>
<li>2.0设备不支持远程设置</li>
<li>2.0设备不被运维1.0Crocus支持</li>
</ol>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=fd368da033bbac6ebc2cc7fe468ba89d" alt="" /></p></div><h2>4.1、端口与使用说明</h2><div style="margin-left:20px;"><h3>4.1.1、263版本端口说明</h3><div style="margin-left:0px;"><h1>263版本端口说明</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8c557e1178651b5272f9e1fa6ff814ae" alt="" /></p></div><h3>4.1.2、CB2产品使用说明书V2.6.4</h3><div style="margin-left:0px;"><h1>CB2产品使用说明书</h1>
<p>请下载以下文档查看：</p>
<p><a href="http://jf.streamax.com:8081/f/cbd39f7aee974d4ebf20/?dl=1" title="[CEIBA2产品使用说明书V2.6.4.docx">CEIBA2产品使用说明书V2.6.4.docx</a></p></div><h3>4.1.3、CB2产品使用说明书V2.6.3</h3><div style="margin-left:0px;"><p>下载地址：
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=05efa69b8acbe81b08a0858abdcb77e5" title="[CEIBA2产品使用说明书-2.6.3.0.63.pdf">CEIBA2产品使用说明书-2.6.3.0.63.pdf</a></p></div><h3>4.1.4、2.6.7版本端口说明</h3><div style="margin-left:0px;"><h3>2.6.7版本端口说明</h3>
<p>端口列表
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=eb538cc0766b0dc53634f2414ac39e57" alt="" /></p></div></div></div><h1>5、历史版本问题解决方法</h1><div style="margin-left:0px;"><h2>5.1、2.6.3版本</h2><div style="margin-left:20px;"><h3>5.1.1、2.6.3.0.90 版本补丁</h3><div style="margin-left:0px;"><h1>2.6.3.0.90 版本补丁</h1>
<p>更新日期：2023-06-01</p>
<h2>补丁说明</h2>
<!-- td { empty-cells:show;line-height:normal;color:#000;vertical-align:middle;outline-width:0;word-wrap:break-word;word-break:normal;white-space:nowrap; text-align:left;font-size:10pt; } table { border-collapse: collapse; } font{ white-space: pre-wrap }-->
<table style="border-collapse:collapse" selecttype="cells"><colgroup><col width="35.66" style="width: 35.66px;"><col width="91" style="width: 91px;"><col width="373" style="width: 373px;"><col width="339.42" style="width: 339.42px;"><col width="168" style="width: 168px;"><col width="107" style="width: 107px;"></colgroup><tbody><tr height="24" style="mso-height-source:auto;height:24px;"><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">编号</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">日期</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">问题描述</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">更新文件</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">关联服务</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">关联缺陷ID</font></td></tr><tr height="24" style="mso-height-source:auto;height:24px;"><td style="font-size:10pt;font-weight:bold;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';">1</td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'yyyy\0022.\0022m\0022.\0022d';">2023.6.1</td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#000000;">N9M2.0远程设置时提示“An error occurred”</font></td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#000000;">ngnix\fastcgi\</font></td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#000000;">FcgiServer</font></td><td style="font-size:10pt;font-weight:bold;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"></td></tr><tr height="24" style="mso-height-source:auto;height:24px;"><td style="font-size:10pt;font-weight:bold;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';">2</td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'yyyy\0022.\0022m\0022.\0022d';">2023.6.1</td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#000000;">设备上传(0,0)点位的GPS时，当天里程计算失败</font></td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#000000;">TransmitServer\StorageService</font></td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#000000;">ARMSStorageServer、</font><font style="font-size:10pt;color:#000000;"><br style="mso-data-placement:same-cell;"></font><font style="font-size:10pt;font-weight:bold;color:#000000;">ARMSRestServer</font></td><td style="font-size:10pt;font-weight:bold;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"></td></tr><tr height="24" style="mso-height-source:auto;height:24px;"><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';">3</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'yyyy\0022.\0022m\0022.\0022d';">2023.3.7</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">车辆管理模糊关键字查询时，会查到权限外车组的车辆</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">WCMS5\root\dbmysql\ceiba2\vehicle\index.js</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">WCMS5</font></td><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';">3228</td></tr><tr height="24" style="mso-height-source:auto;height:24px;"><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';">4</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'yyyy\0022.\0022m\0022.\0022d';">2023.1.16</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">报警服务频繁崩溃，日志显示正在发送邮件</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">TransmitServer/AlarmServer/CSmtp.dll</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">AlarmServer</font></td><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';">2835</td></tr><tr height="24" style="mso-height-source:auto;height:24px;"><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';">5</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'yyyy\0022.\0022m\0022.\0022d';">2023.1.16</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">注册服务(MessagerServer)频繁崩溃</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">TransmiServer/MessagerServer/reg.dll</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">MessagerServer</font></td><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;"></td></tr><tr height="24" style="mso-height-source:auto;height:24px;"><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';">6</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'yyyy\0022.\0022m\0022.\0022d';">2022.12.12</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">设备已有密码，编辑时，不修改设备密码提交，验证不通过</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">WCMS5\root\public\basic\vehicle-device\script\default.js</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">WCMS5</font></td><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:left;mso-number-format: 'General';">2605</td></tr></tbody></table>
<h2>补丁文件</h2>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=419bef7bb00bc252675e19aa39d2b8cc" title="[Ceiba2Srv_2.6.3.0.90_SP20230601.zip">Ceiba2Srv_2.6.3.0.90_SP20230601.zip</a></p></div><h3>5.1.2、2.6.3.0.63版本补丁</h3><div style="margin-left:0px;"><h1>2.6.3.0.63版本补丁</h1>
<h2>补丁说明</h2>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>日期</th>
<th>作者</th>
<th>问题描述</th>
<th>更新文件</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2021.10.29</td>
<td>钟子浩</td>
<td>CB2客户端标准版本，回放>>服务器>>分类检索无反馈数据</td>
<td>1>TransmitServer\StorageService\ARMS.BSearch.Mgo.dll (2.2.2.11) 2>TransmitServer\StorageService\ARMS.RestServer.exe</td>
</tr>
<tr>
<td>2</td>
<td>2021.09.24</td>
<td>王励超</td>
<td>无法打开远程设置</td>
<td>TransmitServer\MessagerServer\reg.dll (15.6.30.46)</td>
</tr>
<tr>
<td>3</td>
<td>2021.09.08</td>
<td>谭博文</td>
<td>报警类型导出报错</td>
<td>WCMS5\root\controllers\report\alarm-count\index.js</td>
</tr>
<tr>
<td>4</td>
<td>2021.09.01</td>
<td>王励超</td>
<td>N9M2.0远程参数设置保存后提示成功，但实际未保存成功</td>
<td>ngnix\fastcgi\fcgi.exe</td>
</tr>
<tr>
<td>5</td>
<td>2021.07.268</td>
<td>王励超</td>
<td>无法远程设置</td>
<td>TransmitServer\n9m_proxy\HttpProxyServerNP.exe (1.0.1.0)</td>
</tr>
<tr>
<td>6</td>
<td>2021.06.23</td>
<td>谭博文</td>
<td>报警报表导出支持20万</td>
<td>1>WCMS5\root\controllers\report\alarm-count\index.js 2>WCMS5\root\public\report\alarm-count\script\default.js</td>
</tr>
<tr>
<td>7</td>
<td>2021.05.08</td>
<td>钟子浩</td>
<td>分布式证据邮件发送失败，N9M2.0证据邮件发送失败</td>
<td>1>TransmitServer\EvidenceAnalyService(1.0.0.45) 2>TransmitServer\EvidenceReport (1.0.0.10)</td>
</tr>
<tr>
<td>8</td>
<td>2023.03.22</td>
<td>钟子浩</td>
<td>basesever log4j漏洞</td>
<td>1>TransmitServer\BaseDataServer</td>
</tr>
</tbody>
</table>
<h2>补丁文件下载</h2>
<h3>1-7的补丁</h3>
<p>点我下载<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e55f109b04ee4b5040805b7916d52d67" title="[Ceiba2Srv_2.6.3.0.63_SP20211029.zip">Ceiba2Srv_2.6.3.0.63_SP20211029.zip</a></p>
<h3>8.BaseDataServer 补丁下载</h3>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=d11ad14f281b82a98b3ec6e8ae8ae848" title="[BaseDataServer.zip">BaseDataServer.zip</a></p></div></div><h2>5.2、2.6.7版本</h2><div style="margin-left:20px;"><h3>5.2.1、2.6.7.0.9版本补丁</h3><div style="margin-left:0px;"><h1>2.6.7.0.9版本补丁</h1>
<p>更新日期：2023-04-10</p>
<h2>补丁说明</h2>
<!-- td { empty-cells:show;line-height:normal;color:#000;vertical-align:middle;outline-width:0;word-wrap:break-word;word-break:normal;white-space:nowrap; text-align:left;font-size:10pt; } table { border-collapse: collapse; } font{ white-space: pre-wrap }-->
<table style="border-collapse:collapse" selecttype="cells"><colgroup><col width="35.66" style="width: 35.66px;"><col width="87" style="width: 87px;"><col width="430" style="width: 430px;"><col width="466" style="width: 466px;"><col width="266.81" style="width: 266.81px;"><col width="107" style="width: 107px;"></colgroup><tbody><tr height="24" style="mso-height-source:auto;height:24px;"><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">编号</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">日期</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">问题描述</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">更新文件</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">关联服务</font></td><td style="background-color:#00b050;font-size:10pt;font-weight:bold;color:#ffffff;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#ffffff;">关联缺陷ID</font></td></tr><tr height="24" style="mso-height-source:auto;height:24px;"><td style="font-size:10pt;font-weight:bold;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:right;mso-number-format: 'General';">1</td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:right;white-space:normal;mso-number-format: 'yyyy\0022.\0022m\0022.\0022d';">2023.5.16</td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#000000;">ADS断点续传问题</font></td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#000000;">1>TransmitServer/AdsServer</font></td><td style="font-size:10pt;font-weight:bold;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;font-weight:bold;color:#000000;">AdsServer</font></td><td style="font-size:10pt;font-weight:bold;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;mso-number-format: 'General';"></td></tr><tr height="24" style="mso-height-source:auto;height:24px;"><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:right;mso-number-format: 'General';">2</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:right;white-space:normal;mso-number-format: 'yyyy\0022.\0022m\0022.\0022d';">2023.4.3</td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">1.转发服务与客户端断连，客户端无法自动重连。<br style="mso-data-placement:same-cell;">2.新增转发服务自愈</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">1>TransmitServer/MonitorService/MonitorService.exe<br style="mso-data-placement:same-cell;">TransmitServer/MonitorService/MonitorService.pdb<br style="mso-data-placement:same-cell;">2>TransmitServer/SimulatorService/SimulatorService.exe<br style="mso-data-placement:same-cell;">TransmitServer/SimulatorService/SimulatorService.pdb<br style="mso-data-placement:same-cell;">3>TransmitServer/BaseDataServer/config/application.properties<br style="mso-data-placement:same-cell;">TransmitServer/BaseDataServer/dist_lib/BaseDataServer.jar<br style="mso-data-placement:same-cell;">4>TransmitServer/proxy.dll<br style="mso-data-placement:same-cell;">TransmitServer/proxy.pdb</font></td><td style="font-size:10pt;color:#000000;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:left;white-space:normal;mso-number-format: 'General';"><font style="font-size:10pt;color:#000000;">MonitorService、SimulatorService、BaseDataServer、DVRGTService</font></td><td style="font-size:10pt;border-left: .5pt solid #000000;border-top: .5pt solid #000000;border-right: .5pt solid #000000;border-bottom: .5pt solid #000000;text-align:right;mso-number-format: 'General';">3532</td></tr></tbody></table>
<h2>补丁文件</h2>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=33e59faca8d9585225826eaa3667ecc3" title="[Ceiba2Srv_2.6.7.0.9_SP20230516.zip">Ceiba2Srv_2.6.7.0.9_SP20230516.zip</a></p></div></div><h2>5.3、263版本通用功能补丁</h2><div style="margin-left:20px;"><h3>5.3.1、AlarmServer-HttpSdkService通用崩溃补丁</h3><div style="margin-left:0px;"><h1>AlarmServer-HttpSdkService通用崩溃补丁</h1>
<p>更新日期：2023-05-19</p>
<h2>适用版本</h2>
<p><strong>2.6.3.0.97以下的263版本</strong>， 只适用于单机版本的服务</p>
<h2>补丁说明</h2>
<p>1.补丁信息，日期：2023.05.19
问题描述：
1>修复报警服务和HttpSdkService频繁崩溃问题</p>
<p>更新文件：
1>TransmitServer\AlarmServer
2>TransmitServer\HttpSdkService</p>
<h2>安装说明</h2>
<ol>
<li>找到CB2服务的安装目录 </li>
<li>备份以下目录
TransmitServer/</li>
<li>在DVR Server Control中停掉所有服务</li>
<li>关闭DVR Server Control工具</li>
<li>拷贝解压后的所有目录及文件，覆盖安装目录（注意目录别搞错了，如果替换不成功，很有可能是某些服务没有停止）</li>
<li>启动DVR Server Control工具</li>
<li>启动所有服务，观察看门狗程序，保证所有服务都启动成功</li>
</ol>
<h2>补丁文件</h2>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5ee2ce92b64f0284d708bfc709e9d301" title="[AlarmService-HttpSdkService.zip">AlarmService-HttpSdkService.zip</a></p></div><h3>5.3.2、单线程监控补丁</h3><div style="margin-left:0px;"><h1>单线程监控补丁 ThreadMonitor</h1>
<p>本补丁适用于处理CB2服务进程出现1线程假死情况，部署完成后会定期监控指定服务进程的线程数，并在线程数为1时强制重启该服务进程。
目前<strong>只支持HttpSdkService和AlarmService</strong></p>
<h1>补丁说明</h1>
<p>补丁记录：</p>
<ol>
<li>补丁信息，日期：2023.05.19
补丁描述：
1> 单线程监控服务
更新文件：
1>TransmitServer\ThreadMonitor</li>
</ol>
<h1>补丁文件</h1>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=fb93b3cc516cf531fdda8a1be50c5b30" title="[ThreadMonitor.zip">ThreadMonitor.zip</a></p>
<h1>安装说明</h1>
<p>本服务不包含在服务器自带的服务内，第一次使用需要额外进行部署。
新服务安装参考如下教程：
<a href="http://jfwiki.streamax.com:7503/web/#/172/4007">http://jfwiki.streamax.com:7503/web/#/172/4007</a></p></div><h3>5.3.3、证据分析EvidenceAnalyService补丁</h3><div style="margin-left:0px;"><h1>证据分析EvidenceAnalyService补丁</h1>
<p>更新日期：2023-05-24</p>
<h1>适用版本</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=9cf47a6e5695a933ccf1ed925e0d65a4" alt="" /></p>
<h1>补丁说明</h1>
<p><strong>替换时需要保存原有配置文件EvidenceAnalyService.json！</strong></p>
<h1>补丁文件</h1>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=ea8172f73b7b11566e32c7fa5878e349" title="[EvidenceAnalyService_通用版本补丁20230524.zip">EvidenceAnalyService_通用版本补丁20230524.zip</a></p></div></div></div><h1>6、安装包下载</h1><div style="margin-left:0px;"><h2>6.1、安装包下载</h2><div style="margin-left:0px;"><h1>安装包下载</h1>
<blockquote>
<p>补充知识：
标准版本是第四位数字为0，比如2.6.3.0.63版本属于标准版本
第4位数字不为0的版本都是定制版本，定制版本与标准版本不可以用数字来比较版本的新旧，比如2.6.3.29.14版本，虽然数字比2.6.3.0.63大，但实际2.6.3.29.14版本没有2.6.3.0.63版本新。</p>
</blockquote>
<p><strong>如果不确定需要安装什么版本，请与产品线的同事联系。
如果不确定需要安装什么版本，请与产品线的同事联系。
如果不确定需要安装什么版本，请与产品线的同事联系。
</strong></p>
<!--
your comment goes here
and here
#CB2标准安装包下载
| 类型  | 点我下载  | 语言  |  发布时间 | 备注  |
| ------------ | ------------ | ------------ | ------------ | ------------ |
| 服务器和客户端 | [Ceiba2Srv_2.6.7.0.9](https://wj.streamax.com:9443/outpublish.html?code=B40567071be2f4b088c02d0319817c3af&lang=zh-cn#view) | 中英文、西语 | 2023/01/17 | 链接密码：169EF71E，需与配套的客户端搭配使用。
-->
<h3>2.6.3.0.97版本更新说明：</h3>
<blockquote>
<p>1、提供ACC状态明细查询接口
2、支持下载主子码流下载接口
3、支持实时网络抓图API
4、支持证据列表条数查询接口
5、支持证据列表明细接口API
6、选择车辆或者批量选择，支持转到其他分组下
7、播放证据，分享证据，邮件证据支持证据ID加密
8、只有管理员权限只是批量删除报警
9、批量删除报警后会有日志记录
10、在报表中支持ACC查询</p>
</blockquote>
<h3>2.6.3.0.94版本更新说明：</h3>
<blockquote>
<p>1、证据完成消息推送
2、对泰语支持
3、增加刷卡功能
4、增加证据ID加密
5、增加对ACC API支持以及报表查询
6、增加客户端登录高级检索服务器
修复：1、合并已经问题并修复</p>
</blockquote>
<h3>2.6.7.0.9版本更新说明：</h3>
<blockquote>
<p>1、新增License控制。
（1）根据授权文件，控制设备接入量。
（2）根据授权文件，控制License 过期时间。
（3）根据授权文件，控制API是否开放。
（4）授权文件支持一机一码，即一个授权文件只能适用一台服务器，此授权码不能给其他服务器使用。
（5）授权文件支持客户级隔离，比如718客户授权是3年，此授权不能给1448服务器使用。
2、安全性升级，针对老旧的三方组件，更新升级。并且针对之前扫描的高危漏洞全部修复。
3、软件优化，针对CPU使用比较高的优化。特别是虚拟机，云服务器，CPU使用率下降30%+
4、自定义语言，Logo，前方技术支持可以根据客户需要自行更换Logo和语言，并根据脚本打包发布，此类需求无需再导入到产品和研发。
5、新增服务监控接口，对主要业务功能进行监控，比如证据，视频等。由原来被动接收服务异常，变为主动监控服务异常。（目前小范围推广，建议选小客户，并且与客户沟通我们可以去获取日志数据，就联系技术专家部先部署后，然后通过日志分析准确度，以便调整精度）
6、增加单机自愈能力，针对本机服务异常，能做自我诊断和修复。保障服务器更高的可用性。</p>
</blockquote>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>类型</th>
<th>点我下载</th>
<th>语言</th>
<th>发布时间</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>客户端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263097/CEIBA2_V2.6.3.0.93_CN.exe" title="CEIBA2_V2.6.3.0.93_CN.exe">CEIBA2_V2.6.3.0.93_CN.exe</a></td>
<td>中文</td>
<td>2023/05/06</td>
<td></td>
</tr>
<tr>
<td>客户端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263097/CEIBA2_V2.6.3.0.93_EN.exe" title="CEIBA2_V2.6.3.0.93_EN.exe">CEIBA2_V2.6.3.0.93_EN.exe</a></td>
<td>中文</td>
<td>2023/05/06</td>
<td></td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263097/Ceiba2Srv_2.6.3.0.97_CN.exe" title="Ceiba2Srv_2.6.3.0.97_CN.exe">Ceiba2Srv_2.6.3.0.97_CN.exe</a></td>
<td>中文</td>
<td>2023/05/06</td>
<td>与客户端版本2.6.3.0.93搭配使用</td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263097/Ceiba2Srv_2.6.3.0.97_EN.exe" title="Ceiba2Srv_2.6.3.0.97_EN.exe">Ceiba2Srv_2.6.3.0.97_EN.exe</a></td>
<td>中文</td>
<td>2023/05/06</td>
<td>与客户端版本2.6.3.0.93搭配使用</td>
</tr>
<tr>
<td>客户端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263094/CEIBA2_V2.6.3.0.91_CN.exe" title="CEIBA2_V2.6.3.0.91_CN.exe">CEIBA2_V2.6.3.0.91_CN.exe</a></td>
<td>中文</td>
<td>2023/04/18</td>
<td></td>
</tr>
<tr>
<td>客户端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263094/CEIBA2_V2.6.3.0.91_EN.exe" title="CEIBA2_V2.6.3.0.91_EN.exe">CEIBA2_V2.6.3.0.91_EN.exe</a></td>
<td>中文</td>
<td>2023/04/18</td>
<td></td>
</tr>
<tr>
<td>客户端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263094/CEIBA2_V2.6.3.0.91_Thai.exe" title="CEIBA2_V2.6.3.0.91_Thai.exe">CEIBA2_V2.6.3.0.91_Thai.exe</a></td>
<td>中文</td>
<td>2023/04/18</td>
<td></td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263094/Ceiba2Srv_2.6.3.0.94_Thai.exe" title="Ceiba2Srv_2.6.3.0.94_Thai.exe">Ceiba2Srv_2.6.3.0.94_Thai.exe</a></td>
<td>中文</td>
<td>2023/04/18</td>
<td>与客户端版本2.6.3.0.91搭配使用</td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263094/Ceiba2Srv_2.6.3.0.94_EN.exe" title="Ceiba2Srv_2.6.3.0.94_EN.exe">Ceiba2Srv_2.6.3.0.94_EN.exe</a></td>
<td>中文</td>
<td>2023/04/18</td>
<td>与客户端版本2.6.3.0.91搭配使用</td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263094/Ceiba2Srv_2.6.3.0.94_CN.exe" title="Ceiba2Srv_2.6.3.0.94_CN.exe">Ceiba2Srv_2.6.3.0.94_CN.exe</a></td>
<td>中文</td>
<td>2023/04/18</td>
<td>与客户端版本2.6.3.0.91搭配使用</td>
</tr>
<tr>
<td>客户端</td>
<td><a href="https://wj.streamax.com:9443/outpublish.html?code=Bf208841dd4d042bab4c5a377809ce677&lang=zh-cn#view" title="CEIBA2_V2.6.3.0.89_CN.exe">CEIBA2_V2.6.3.0.89_CN.exe</a></td>
<td>中文</td>
<td>2023/02/09</td>
<td>链接密码 89BAB3D5</td>
</tr>
<tr>
<td>客户端</td>
<td><a href="https://wj.streamax.com:9443/outpublish.html?code=Bf208841dd4d042bab4c5a377809ce677&lang=zh-cn#view" title="CEIBA2_V2.6.3.0.89_CN.exe">CEIBA2_V2.6.3.0.89_EN.exe</a></td>
<td>英文</td>
<td>2023/02/09</td>
<td>链接密码 89BAB3D5</td>
</tr>
<tr>
<td>服务器端</td>
<td>下载线路1:<a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263090/Ceiba2Srv_2.6.3.0.90_CN.exe" title="Ceiba2Srv_2.6.3.0.90_CN.exe">Ceiba2Srv_2.6.3.0.90_CN.exe</a> 下载线路2:<a href="https://streamax-file02-1304261646.cos.ap-guangzhou.myqcloud.com/STREAMAX/%E5%B9%B3%E5%8F%B0%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E5%8C%85/CB2/Ceiba2Srv_2.6.3.0.90_CN.exe">Ceiba2Srv_2.6.3.0.90_CN.exe</a></td>
<td>中文</td>
<td>2022/09/15</td>
<td>与客户端版本2.6.3.0.87搭配使用</td>
</tr>
<tr>
<td>客户端</td>
<td>下载线路1:<a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263090/CEIBA2_V2.6.3.0.87_CN.exe" title="CEIBA2_V2.6.3.0.87_CN.exe">CEIBA2_V2.6.3.0.87_CN.exe</a> 下载线路2:<a href="https://streamax-file02-1304261646.cos.ap-guangzhou.myqcloud.com/STREAMAX/%E5%B9%B3%E5%8F%B0%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E5%8C%85/CB2/CEIBA2_V2.6.3.0.87_CN.exe" title="1">CEIBA2_V2.6.3.0.87_CN.exe</a></td>
<td>中文</td>
<td>2022/09/15</td>
<td>下载速度缓慢时可切换线路</td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263090/Ceiba2Srv_2.6.3.0.90_EN.exe" title="Ceiba2Srv_2.6.3.0.90_EN.exe">Ceiba2Srv_2.6.3.0.90_EN.exe</a></td>
<td>英文</td>
<td>2022/07/15</td>
<td>与客户端版本2.6.3.0.87搭配使用</td>
</tr>
<tr>
<td>客户端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263090/CEIBA2_V2.6.3.0.87_EN.exe" title="CEIBA2_V2.6.3.0.87_EN.exe">CEIBA2_V2.6.3.0.87_EN.exe</a></td>
<td>英文</td>
<td>2022/07/15</td>
<td></td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/263090/Ceiba2Srv_2.6.3.0.90_EN.exe" title="Ceiba2Srv_2.6.3.0.90_EN.exe">Ceiba2Srv_2.6.3.0.90_EN.exe</a></td>
<td>中文</td>
<td>2022/07/15</td>
<td>与客户端版本2.6.3.0.82搭配使用</td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/JFZJB/ywtools/CB2/2.6.3.0.87/Ceiba2Srv_2.6.3.0.87.exe" title="Ceiba2Srv_2.6.3.0.87.exe">Ceiba2Srv_2.6.3.0.87_EN.exe</a></td>
<td>英文</td>
<td>2022/07/15</td>
<td>与客户端版本2.6.3.0.82搭配使用</td>
</tr>
<tr>
<td>客户端</td>
<td><a href="http://jf.streamax.com:8081/f/158cca043dde4356a856/?dl=1">CEIBA2_V2.6.3.0.82_CN.exe</a></td>
<td>中文</td>
<td>2022/03/08</td>
<td></td>
</tr>
<tr>
<td>客户端</td>
<td><a href="http://jf.streamax.com:8081/f/2dd84d486f7f47a29101/?dl=1">CEIBA2_V2.6.3.0.82_EN.exe</a></td>
<td>英文</td>
<td>2022/03/08</td>
<td></td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="http://jf.streamax.com:8081/f/de39c4280680481bb92b/?dl=1">Ceiba2Srv_2.6.3.0.80_CN.exe</a></td>
<td>中文</td>
<td>2022/03/08</td>
<td>与客户端版本2.6.3.0.82搭配使用  不推荐安装！</td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="http://jf.streamax.com:8081/f/5698a25c7394491fac21/?dl=1">Ceiba2Srv_2.6.3.0.80_EN.exe</a></td>
<td>英文</td>
<td>2022/03/08</td>
<td>与客户端版本2.6.3.0.82搭配使用  不推荐安装！</td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="http://jf.streamax.com:8081/f/dd32aac38d374ddc8bfb/?dl=1">Ceiba2Srv_2.6.4.0.26_cn.exe</a></td>
<td>中文</td>
<td>2022/03/17</td>
<td>必须与客户端版本2.6.4使用，使用2.6.3的客户端版本无法查看实时视频，客户端下载链接、264版本更新的信息可以查看以下文档：<a href="http://jfwiki.streamax.com:7503/web/#/172/1511">http://jfwiki.streamax.com:7503/web/#/172/1511</a></td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="http://jf.streamax.com:8081/f/3c2f0f893212497eaf6d/?dl=1">Ceiba2Srv_2.6.4.0.26_en.exe</a></td>
<td>英文</td>
<td>2022/03/17</td>
<td>同上面中文版本备注</td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="http://jf.streamax.com:8081/f/655662e5b9044bb7974e/?dl=1">Ceiba2Srv_2.6.3.0.63_CN.exe</a></td>
<td>中文</td>
<td>2021/04/21</td>
<td>与客户端版本2.6.3.0.58搭配使用，安装完2.6.3.0.63后需要参考此FAQ更新补丁：<a href="http://jfwiki.streamax.com:7503/web/#/172/1374">http://jfwiki.streamax.com:7503/web/#/172/1374</a></td>
</tr>
<tr>
<td>客户端</td>
<td><a href="http://jf.streamax.com:8081/f/0a40b66da21949fda2b2/?dl=1">CEIBA2_V2.6.3.0.58_CN.exe</a></td>
<td>中文</td>
<td>2021/04/21</td>
<td></td>
</tr>
<tr>
<td>服务器端</td>
<td><a href="http://jf.streamax.com:8081/f/47ab5b737f41492a965c/?dl=1">Ceiba2Srv_E(2.6.3.0.63).exe</a></td>
<td>英文</td>
<td>2021/04/21</td>
<td>同上面中文版本备注</td>
</tr>
<tr>
<td>客户端</td>
<td><a href="http://jf.streamax.com:8081/f/3ebc03ea47524ef185eb/?dl=1">CEIBA2_V263_E(2.6.3.0.58).exe</a></td>
<td>英文</td>
<td>2021/04/21</td>
<td></td>
</tr>
</tbody>
</table></div><h2>6.2、补充知识：安装包命名规范</h2><div style="margin-left:0px;"><h1>补充知识：安装包命名规范</h1>
<h3>1、标准版本是第四位数字为0。</h3>
<p>比如2.6.3.0.63版本属于标准版本</p>
<h3>2、第4位数字不为0的版本都是定制版本。</h3>
<p>定制版本与标准版本不可以用数字来比较版本的新旧，比如2.6.3.29.14版本，虽然数字比2.6.3.0.63大，但实际2.6.3.29.14版本没有2.6.3.0.63版本新。</p>
<p><strong>如果不确定需要安装什么版本，请与产品线的同事联系。！！！</strong></p></div><h2>6.3、APP安装包下载</h2><div style="margin-left:0px;"><h3>Ceiba2 APP 中文版本</h3>
<p>下载地址（请用手机浏览器扫描打开）：
<a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/CB2/CB2_3.1.10%E5%AE%89%E5%8D%93%E5%AE%A2%E6%88%B7%E7%AB%AF/standard_bd_3.1.10_2023020601_R_T20230317_develop.apk" title="Ceiba2Srv_2.6.3.31.31_EN.exe">Ceiba2Srv_2.6.3.31.31_EN.exe</a>
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=51f58361fbf8ad8d85dd80ef9fd2843b" alt="" /></p></div></div><h1>7、系统安装部署</h1><div style="margin-left:0px;"><h2>7.1、服务器配置推荐</h2><div style="margin-left:0px;"><h1>服务器配置推荐</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=3b7b00566273f4dff00bc29505ae022d" alt="" /></p>
<h1>配置计算方法参考</h1>
<h2>参考场景</h2>
<p>5000台车日均在线3000，平均在线时间12小时，GPS上报频率10s一条，
最高有500条证据同时上传（平均每条10M，要求60s传完），
日均产生证据1w条、报警10w条，400路CIF分辨率的直通视频同时观看，黑匣子和视频保存30天。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/615a819f399e6e27d37c09f6f83f1dbf" alt="" /></p>
<h2>磁盘写入性能要求</h2>
<p>假设每条证据10MB，要求60s传完，每条证据写入需求10/60≈0.17MB/s
500条并发需求0.17<em>500≈85MB/s
证据上传之后还需要转码，mp4文件与原始文件大小接近，磁盘写入总需求：85</em>2=170MB/s，加上GPS、报警和系统其他任务，建议磁盘能达到200MB/s的写入速度。</p>
<h2>磁盘容量要求</h2>
<ul>
<li>GPS日均条数(10<em>3600)/10</em>3000≈10000000条，需要占用硬盘空间：10000000*380B≈3.6GB</li>
<li>报警每日需要的硬盘空间：100000*600B≈60MB</li>
<li>证据视频估算：10000*10MB≈100GB</li>
<li>30天磁盘需求：(3.6GB+60MB+100GB)*30≈3.1TB，建议4TB容量硬盘</li>
</ul>
<h2>带宽要求</h2>
<ul>
<li>直通带宽要求：设备侧512kbps<em>400=200Mbps，客户端侧512kbps</em>400=200Mbps，共计400Mbps</li>
<li>证据带宽要求：85MB/s*8=680Mbps</li>
<li>总带宽：400+680=1.08Gbps，加上证据回放、GPS、报警、其他协议交互，建议1100Mbps</li>
</ul>
<h2>场景参考配置</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/980d1e8f5092639b59cf009c789a5b89" alt="" /></p>
<h2>windows服务器性能测试对比</h2></div><h2>7.2、CMS Server部署准备</h2><div style="margin-left:0px;"><h1>服务器部署系统准备</h1>
<blockquote>
<p>如果有杀毒软件，请先退出或者关闭！</p>
</blockquote>
<h2>1、安装.NET3.5</h2>
<p>(1)打开控制面板--程序与功能--启用或关闭Windows功能。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/14ba8f15c49c35cc200fe9d3144a44d6" alt="" /></p>
<hr />
<p>(2)点击到功能--将.NET3.5勾选上，点击安装，等待安装完成即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/967f9bfd36b0df8dd4468cd017d93a47" alt="" /></p>
<hr />
<p>(3)如果安装有异常，可参考文档http://jf.streamax.com:8081/f/db78d7d76a284f3eb3ce/?dl=1</p>
<h2>2、检查服务器版本</h2>
<p>如果服务器版本为2008 R2，需要下载SP1补丁进行安装。
可点击计算机--属性，若如以下截图中有”Service Pack 1“，即表明安装了SP1补丁。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b91364c0ae37755910dcc42cbb28d031" alt="" /></p>
<p>若未安装，请点击以下链接下载SP1补丁进行安装：
<a href="http://download.windowsupdate.com/msdownload/update/software/svpk/2011/02/windows6.1-kb976932-x64_74865ef2562006e51d7f9333b4a8d45b7a749dab.exe">http://download.windowsupdate.com/msdownload/update/software/svpk/2011/02/windows6.1-kb976932-x64_74865ef2562006e51d7f9333b4a8d45b7a749dab.exe</a></p>
<h2>备注：在线安装.NET3.5失败</h2>
<h4>（1）采用离线安装包方式安装</h4>
<p>点击以下链接进入微软官网去下载.NET3.5的完整安装包：
<a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=25150">https://www.microsoft.com/zh-cn/download/details.aspx?id=25150</a></p>
<p>点击下载即可
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3137416fa2abc63327ede3b2b358f100" alt="" /></p>
<p>下载完成后双击该exe进行安装。</p>
<h3>提示安装.NET3.5找不到源文件</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6477c6e1f21f88c68d9850330a7e3aee" alt="" /></p>
<h4>（2）采取备用源文件方式安装</h4>
<p><strong>针对2016版本的源文件下载链接：</strong>
<a href="http://jf.streamax.com:8081/f/4395c400f8154c17859a/?dl=1">http://jf.streamax.com:8081/f/4395c400f8154c17859a/?dl=1</a></p>
<p><strong>针对2019版本的源文件下载链接：</strong>
<a href="http://jf.streamax.com:8081/f/6daf042642e74d8b8e07/?dl=1">http://jf.streamax.com:8081/f/6daf042642e74d8b8e07/?dl=1</a></p>
<p>源文件下载后，请将该源文件放到C:\Windows\路径下，且目录不要包含中文名</p>
<p>然后再次点击打开控制面板--程序与功能--启用或关闭Windows功能</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/14ba8f15c49c35cc200fe9d3144a44d6" alt="" /></p>
<p>点击到功能--将.NET3.5勾选上，点击下一步
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/967f9bfd36b0df8dd4468cd017d93a47" alt="" /></p>
<p>点击指定备用源路径，将上一步下载的文件夹的路径的sys文件夹全路径填写到这里，比如
E:\Wechat\WeChat Files\WeChat Files\wxid_5f373hh96unk21\FileStorage\File\2021-11\sources\sources\sxs（根据自己的实际路径来）
然后点击安装即可
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9624a5be25096ce1e01f2c51f189f0bb" alt="" /></p>
<h4>（3）采取命令行方式安装</h4>
<p>点击以下链接下载需要的文件：
<a href="http://jf.streamax.com:8081/f/e42de3c28f8249a7b172/?dl=1">http://jf.streamax.com:8081/f/e42de3c28f8249a7b172/?dl=1</a></p>
<p>将该源文件放到C:\Windows\路径下：</p>
<p>点击“开始”找到“Windows PowerShell”右击“以管理员身份运行”，</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ececc870582dd18c9b011bee690ab2ac" alt="" /></p>
<p>输入如下命令：
dism.exe /online /add-package /packagepath:C:\WINDOWS\netfx3.caB</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4874349c5e63f12f93a2645d9bcb1044" alt="" /></p>
<p>等待安装到100%即可。</p></div><h2>7.3、CMS Server安装</h2><div style="margin-left:0px;"><h1>CMS Server部署</h1>
<h2>配置推荐</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=41d88ac370d43e7819551f231b944093" alt="" />
详情请参考以下链接的文档：<a href="http://jfwiki.streamax.com:7503/web/#/172/1278">http://jfwiki.streamax.com:7503/web/#/172/1278</a></p>
<h2>1、下载软件</h2>
<p>访问以下链接：<a href="http://jfwiki.streamax.com:7503/web/#/172/1509">http://jfwiki.streamax.com:7503/web/#/172/1509</a></p>
<h2>2、安装</h2>
<h5>（1）完成安装前的服务器准备工作安装.NET3.5，参考以下链接的文档安装：</h5>
<p><a href="http://jfwiki.streamax.com:7503/web/#/172/1280">http://jfwiki.streamax.com:7503/web/#/172/1280</a></p>
<h5>（2）可以点击第一步下载完成的安装包进行安装，选择定制安装。</h5>
<h5>（3）选择安装路径后点击确定，点击下一步，等待安装完成即可。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/31cc0950d228a9b3f68859c24cbf91b0" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/59e0099650552342225712cc870f617d" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/73ccfe714baac4e365e98addbf8cfb19" alt="" /></p>
<h5>（4）安装完成后，在弹出的网络配置工具中，将流媒体IP修改为外网ip，注意服务器外网IP就是0.0.0.0，最后点击修改配置等待服务重启完成即可。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/07a28c89e3bca4719d86347585b7ba9e" alt="" /></p></div><h2>7.1、windows服务器性能测试</h2><div style="margin-left:20px;"><h3>7.1.1、服务器性能摸底</h3><div style="margin-left:0px;"><p>以下是从网络、磁盘，内存等方面做的分析。</p>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=288a67e886ebcfa9b2c016edd2719701" title="[windows服务器性能测试对比.zip">测试软件</a></p>
<h3>一、 服务器承载能力</h3>
<p>浏览器打开<a href="http://www.speedtest.net">测速网</a> ，选择当前项目运营商的节点进行多次测速即可。说明：比如项目用的移动卡，那么服务器测速节点用当前城市或者就近城市的移动服务器。</p>
<p>上下行100Mbps起步，低于这个测速结果，需要给客户提出风险预警。</p>
<p>带宽使用说明：</p>
<p>1000台及以内: 实时GPS/报警上传约占用5Mbps，实时/回放视频D1画质需要占用1Mbps/1路，CIF 画质占用0.5Mbps/路。</p>
<p>可以根据客户对视频的需求量评估带宽。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=fb90a480435ee3db3d239f630c2f77f0" alt="" /></p>
<h3>二、 硬盘读写速度测试</h3>
<p>（1） 测试工具：HD Tune Pro 5.70</p>
<p>磁盘读速度至少150M/S。</p>
<p>某服务器测试结果：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=bea52e58d0838a1decacd170bde0562e" alt="" /></p>
<p>磁盘读速度极其不稳定，不推荐。</p>
<p>（2）  测试工具：AS SSD Benchmark</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=c68222aeefa3541424b718acf6c60175" alt="" /></p>
<h3>三、 内存交换能力测试</h3>
<p>（1）测试工具：redis,前提是要先部署了CB2之后。</p>
<p>测试方式：登录服务器后进入redis路径执行命令：</p>
<p>X:\Program Files (x86)\CMS Server\TransmitServer\redis_service</p>
<p>替换下：<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=cd77a0bfc0a02e49c5f2508fef4b4216" alt="" /></p>
<table width='100%' class='codestyle'><pre><code>redis-benchmark -h 127.0.0.1 -p 12004 -a cqrm123151qaz2WSX  -c 50 -n 10000 -q</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=aa89daea49bbb7c74b9b3558fa1d275b" alt="" /></p>
<p>参考测试服务器：腾讯服务器 （2C 4G）测试结果：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=a73b8337073c8972bc46e7760a291152" alt="" /></p>
<p>参考测试服务器：移动云服务器 2C4G测试结果：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=bb5fa5122507d72991df503ce23b2e52" alt="" /></p>
<p>参考磐石云实际测试：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=acdeef275ce8110aa4a59c7f731fd864" alt="" /></p>
<p>（2）回环口网速测试</p>
<p>在服务器上部署一个服务器和客户端，尽最大能力发送和接收数据</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=4c2b901a9c9401ab40f23ee6a2814154" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=873d20bd2cec0bf32f31141c24b4a98f" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=0406936bbc51708d20ec39dc4e4c387c" alt="" /></p>
<p>（1）测试工具：NetSpeedTestClient</p>
<p>服务器1：这种测速结果不满足</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5794c808596032913d64b983e7b3b624" alt="" /></p>
<p>服务器1：这种测速结果满足</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6cedf7d8c4300a6f1c71d70ef52407cc" alt="" /></p></div><h3>7.1.2、服务器案例对比测试</h3><div style="margin-left:0px;"><h2>服务器案例对比测试</h2>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>测试项</th>
<th>服务器1测试结果</th>
<th>服务器2测试结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>系统配置1</td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f852d3d4216343f7a7364505ecafe18b" alt="" /></td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=12fa2458c347172a0facb7fa966a7518" alt="" /></td>
</tr>
<tr>
<td>系统配置2</td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=36ad6d38405409d23252b79efed1db73" alt="" /></td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=598a2dd5ece8c6ccfa9d486dc02a8233" alt="" /></td>
</tr>
<tr>
<td>网页speedtest测速</td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=655c3654b4f621062dae04b535514bb8" alt="" /></td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5b3f2ab6a866b35a6ad8d9e091067fde" alt="" /></td>
</tr>
<tr>
<td>硬盘读写速度测试</td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=8feb9f612b28bf3d6257019a4c89dded" alt="" /></td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=cc2745e9bd706586fffa8d96c8059a1a" alt="" /></td>
</tr>
<tr>
<td>内存交换能力测试</td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e455f89b8b90741ee41da0bb210a8e39" alt="" /></td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5d013802c201653f11723ced77a40ac5" alt="" /></td>
</tr>
<tr>
<td>回环口网速测试</td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f1d1f83bed4c4bbf46566c8ae849f203" alt="" /></td>
<td><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=60debbc91781d600f091f0035d7ad494" alt="" /></td>
</tr>
</tbody>
</table></div></div></div><h1>8、平台服务升级</h1><div style="margin-left:0px;"><h2>8.1、升级前模板</h2><div style="margin-left:0px;"><p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=70f80c24b200fbefb158aa44f1aea816" title="[数据迁移或者是版本升级信息收集模板.xlsx">数据迁移或者是版本升级信息收集模板.xlsx</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=3f579d5b690eea626ccb183186cd2f45" alt="" /></p></div><h2>8.2、备份数据升级必看!!!</h2><div style="margin-left:0px;"><h1>备份数据</h1>
<h5>（1）进入CMS Server/MySql5.5/DataTool，双击运行WCMS.DataTool.exe程序。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/399c6b7cf0d8b1b7e307bffb4fee1a88" alt="" /></p>
<h5>（2）点击开始备份，选择文件的备份路径，点击保存，等待进度条到达100%时备份成功。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/af040e0e8989e0cb7b7790eabd78e99b" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ba1f9c7a210d90062e5445541e31c780" alt="" /></p>
<hr />
<h2><font color=#FF0000 > <strong>（3）备份完成后，进入备份文件的文件夹，查看备份的sql文件的大小以及检查文件备份是否正常。如果sql文件的大小为0kb或1kb，则备份异常！！！需要重新备份！！！（可采用登录navicat，然后点击wcms4，右键选择转储sql文件。）</strong></font></h2>
<p><strong><em>如果备份失败，可以更换如下工具http://jfwiki.streamax.com:7503/web/#/172/3253</em></strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a0db1ad67379be73298e4cc1a5dbd8e8" alt="" /></p>
<h5>(4) 如果使用ceiba自带的datatool无法成功备份sql文件，建议使用navicat直接备份整个wcms4库（建议无论datatool是否备份成功，都使用navicat备份一次）。</h5>
<p>参考以下文档使用navicat进入数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a></p>
<h6>进入数据库后，选择wcms4，右键选择转储sql文件，选择结构和数据，选择存储的位置，等待出现success即可，如果出现unsuccess，请咨询平台技术支持。备份完成后，也需要去对应目录下检查 备份出来的sql文件的大小，为okb或1kb即备份异常。</h6>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e32e601f0793ec3f6180de3b4bec2353" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ab9e23c702b9faf1d1ecee63bf5c8d56" alt="" /></p>
<h2>备注：检查备份的sql数据是否完整</h2>
<p>1.新建wcms4test数据库
2.找到备份的基础数据sql文件，在wcms4test库中运行
3.修改WCMS5/root/config/app.josn 中dbName 这段的值为wcms4test
4.重启WCMS5，然后登录验证</p></div><h2>8.3、卸载CMS Server</h2><div style="margin-left:0px;"><h1>卸载CMS Server</h1>
<h2>一、正常卸载</h2>
<blockquote>
<p>注意：卸载之前请一定记得备份数据！！！</p>
</blockquote>
<p><strong>点击控制面板--点击程序与功能--找到CMS Server，右键点击，选择卸载，等待卸载完成，删除对应目录的文件夹即可。</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/95de2516d11a4359bd7daf2bf2f4938b" alt="" /></p>
<h2>二、非正常卸载</h2>
<blockquote>
<p>注意：卸载之前请一定记得备份数据！！！非正常卸载针对通过正常卸载的操作步骤无法卸载！！！</p>
</blockquote>
<h5>1、打开DVRServerCtl,点击卸载所有服务</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fee343797d3180b04d1e19d187ab7c6c" alt="" /></p>
<h5>2、进入注册表</h5>
<p>（1）win+R，打开运行界面，并输入regedit，回车，进入注册表。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8f018248ea0fa0cbe8f5060f73c01f56" alt="" /></p>
<p>（2）注册表所在位置：HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\</p>
<p>v2.4以下：{FE771A5C-A722-4604-93A3-22706BAFAADD}
v2.4.1：{ 4E6660C3-7D53-48CA-8E92-0358867FDAB5}
v2.5.2：{4E6660C3-7D53-48CA-8E92-0358867FDAB5}
v2.6及以上：{D74BE91C-145C-4948-A8AC-252D4E835E93}</p>
<p>找到对应的注册表后，点击删除即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/af3ff95d3a3cfbea830ba4d1dbb7c3ce" alt="" /></p></div><h2>8.4、CMS Server升级</h2><div style="margin-left:0px;"><h1>CMS Server升级</h1>
<h2>1、备份数据</h2>
<p>请参考备份数据文档链接：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1283">http://jfwiki.streamax.com:7503/web/#/172/1283</a></p>
<h2>2、卸载</h2>
<blockquote>
<p>请先完成第一步备份数据后再进行卸载操作！！！否则在卸载过程中备份有可能会出现sql备份完成为0kb的情况，即会丢失所有基础数据。</p>
</blockquote>
<p>（1）打开控制面板--程序与功能--卸载程序，找到CMS Server，右键点击卸载，等待卸载完成，把之前所在的文件夹删除。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0e2af763882e506d920bff9137c36777" alt="" /></p>
<p>若无法卸载请参考xie</p>
<h2>3、升级</h2>
<p>请参考安装文档：<a href="http://jfwiki.streamax.com:7503/web/#/172/1282">http://jfwiki.streamax.com:7503/web/#/172/1282</a></p>
<h2>4、还原数据</h2>
<h4>方法一：datatool（推荐）</h4>
<p>（1）该方式只能还原备份的时候使用datatool备份的数据，进入CMS Server\MySql5.5\DataTool文件夹下，双击WCMS.DataTool.exe。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f056135f4bd7420404337246d21c9d0f" alt="" /></p>
<p>（2）点击开始还原，选择之前备份的以数字名字的文件夹，最后点击确定，等到进度条到100%，提示还原完成即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/83c52d3f1023774f47cebb16aad98160" alt="" /></p>
<h4>方法二：直接还原sql数据</h4>
<p>（2）使用navicat备份出来的数据，需进入数据库后，执行source才可以将备份出来的wcms.sql还原。
参考以下文档进入数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a>
进入数据库后，执行以下语句：(这里的D盘路径对应为当初使用navacat备份出来的路径)</p>
<table width='100%' class='codestyle'><pre><code>use wcms4;
source D:/wcms4.sql</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/532242d489ff5c15c4be17cb5b5b62e4" alt="" /></p></div><h2>8.5、2.6.3.26.04升级2.6.3.0.63</h2><div style="margin-left:0px;"><h1>2.6.3.26.04升级2.6.3.0.63</h1>
<h2>背景</h2>
<h3>1、确认证据文件是存储在mysql还是mongodb里面</h3>
<p>使用以下FAQ进入mongodb：<a href="http://jfwiki.streamax.com:7503/web/#/172/1289">http://jfwiki.streamax.com:7503/web/#/172/1289</a></p>
<p>并且确认constabulary数据库下面是否有evidencefile表。</p>
<p>如果没有该表，则证明升级完成后需要使用证据迁移工具迁移</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/bb72ada033bf307404bc5161d6a93454" alt="" /></p>
<p><strong>2.6.3.26.04版本的constabulary数据库没有evidencefile表，即升级完成后需要使用证据工具迁移</strong></p>
<h2>升级操作</h2>
<h3>1、使用navicat先进行基础数据备份。</h3>
<p>参考以下FAQ的第四点进行：<a href="http://jfwiki.streamax.com:7503/web/#/172/1283">http://jfwiki.streamax.com:7503/web/#/172/1283</a></p>
<h3>2、重命名Evidencedata文件的名字。</h3>
<h3>3、打开datatool，备份选择项均需要勾选上，点击备份。</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/953046990b9bec405d243e270fcff67f" alt="" /></p>
<h3>4、datatool备份完成后，检查文件夹大小，如无误，即可开始卸载旧版本CMS Server。</h3>
<h3>5、打开控制面板--程序与功能，找到CMS Server并卸载，之前确认备份的数据没有问题的话这次就不用备份了。</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e6d4ae68040b17e7cee75833407b05a4" alt="" /></p>
<h3>5、卸载完成后，安装新版本，安装完成后，打相应的版本补丁，还原数据，修改流媒体ip，重启所有服务。</h3>
<h3>6、数据还原完成后，将evidecnedata文件夹名字还原。</h3>
<h3>7、开始证据迁移</h3>
<p>（1）找到CB2服务器目录下的TransmitServer/EvidenceMigrateTool.exe，使用管理员权限启动该工具（如果不用管理员权限启动，可能会报错）。迁移工具界面如下：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/22d5149762b680b8a5edcc006ace9a39" alt="" /></p>
<p>（2）选择需要迁移的时间段，点击重新加载，等待需要迁移的证据加载完成。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b36bd251b8b5b1ebeb04abf38144371d" alt="" /></p>
<p>（3）点击开始分析，直到所有证据迁移完成。迁移完成的证据会显示在下图右边表里。证据迁移是按天迁移的，迁移完当天的证据后会自动往后继续迁移，直到迁移完设定时间段内的所有证据。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7357d6a57c8e55abe40dd25a3d303caf" alt="" /></p></div><h2>8.6、单机252升级263操作手册</h2><div style="margin-left:0px;"><h1>单机252升级263操作手册</h1>
<p>单机252及之前的版本升级263操作手册</p>
<h2>1. 背景描述</h2>
<p>252及之前的版本已经非常久远，维护困难。越来越多的客户倾向于将服务器升级到263。为此需要一份操作手册记录升级的方法。</p>
<h3>1.1 版本描述</h3>
<p>升级前版本：2.5.2
预计升级版本：2.6.3.0.63及以上版本</p>
<h3>1.2 升级限制条件</h3>
<p>1、252及之前的版本升级263版本<strong>只支持mysql基础数据升级，不支持历史数据迁移。</strong>
2、若使用镜像服务器方式进行升级，可以保留老服务器用作历史数据查询。
3、若直接在本机升级，则不会保留历史数据</p>
<h3>1.3 升级方法</h3>
<p>镜像升级方法：见2
本机升级方法：见3</p>
<h2>2. 镜像升级方法</h2>
<h3>2.1 镜像操作</h3>
<p>镜像老服务器，之后操作均在镜像的新服务器上进行。</p>
<h3>2.2 备份操作</h3>
<h4>2.1.1 备份mysql数据库</h4>
<p>参考以下文档使用navicat进入数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a>
进入数据库后，选择wcms4，右键选择转储sql文件，选择结构和数据，选择存储的位置，等待出现success即可，如果出现unsuccess，请咨询平台技术支持。备份完成后，也需要去对应目录下检查备份出来的sql文件的大小，为okb或1kb即备份异常。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/30f217466dece447aeabf702036fc3a6" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/47c757d8cfe22419ff725e4d86ec2ab8" alt="" /></p>
<h3>2.3  卸载服务器</h3>
<p>以下操作在镜像的新服务器上进行。
备份完成后，卸载服务器。卸载完成后检查CMS Server目录是否为空，若不为空，手动清空该目录。</p>
<h3>2.4  安装新服务器</h3>
<p>以下操作在镜像的新服务器上进行。
安装新版本CB2服务器。</p>
<h3>2.5 还原操作</h3>
<h4>2.5.1 使用navicat工具执行还原操作</h4>
<p>以下操作在镜像的新服务器上进行。</p>
<p>使用navicat备份出来的数据，需进入数据库后，执行source才可以将备份出来的wcms.sql还原。
参考以下文档进入数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a>
进入数据库后，执行以下语句：(这里的D盘路径对应为当初使用navacat备份出来的路径)</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">use wcms4;
source D:/wcms4.sql</code></pre></table>
<h3>2.6 切换服务器ip</h3>
<p>将新服务器的ip切为老服务器的ip</p>
<h2>3. 本机升级方法</h2>
<h3>3.1 备份操作</h3>
<h4>3.1.1 备份mysql数据库</h4>
<p>参考以下文档使用navicat进入数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a>
进入数据库后，选择wcms4，右键选择转储sql文件，选择结构和数据，选择存储的位置，等待出现success即可，如果出现unsuccess，请咨询平台技术支持。备份完成后，也需要去对应目录下检查备份出来的sql文件的大小，为okb或1kb即备份异常。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7a174a55a83d3269e77142324c7f8b40" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a6d366255ca8b2b02dba75b6135d2a42" alt="" /></p>
<h2>3.2  卸载服务器</h2>
<p>备份完成后，卸载服务器。卸载完成后检查CMS Server目录是否为空，若不为空，手动清空该目录。</p>
<h2>3.3  安装新服务器</h2>
<p>安装新版本CB2服务器。</p>
<h2>3.4 还原操作</h2>
<h3>3.4.1 使用navicat工具执行还原操作</h3>
<p>使用navicat备份出来的数据，需进入数据库后，执行source才可以将备份出来的wcms.sql还原。
参考以下文档进入数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a>
进入数据库后，执行以下语句：(这里的D盘路径对应为当初使用navacat备份出来的路径)</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">use wcms4;
source D:/wcms4.sql</code></pre></table>
<h2>3.5 检查服务运行状态</h2>
<p>检查服务运行状态是否正常。</p></div><h2>8.7、单机262升级263操作手册</h2><div style="margin-left:0px;"><h1>单机262升级263操作手册</h1>
<h2>1. 背景描述</h2>
<p>262的版本已经非常久远，维护困难。越来越多的客户倾向于将服务器升级到263。为此需要一份操作手册记录升级的方法。</p>
<h3>1.1 版本描述</h3>
<p>升级前版本：2.6.2
预计升级版本：2.6.3.0.63及以上版本</p>
<h3>1.2 升级限制条件</h3>
<p>1、262版本升级263版本<strong>只支持mysql基础数据升级，且支持历史数据迁移，但证据数据需要在升级完成后做证据迁移操作。</strong>
2、若使用镜像服务器方式进行升级，可以只升级基础数据，保留老服务器用作历史数据查询。
3、若直接在本机升级，则需要做好历史数据迁移</p>
<h3>1.3 升级方法</h3>
<p>镜像升级方法：见2
本机升级方法：见3</p>
<h2>2. 镜像升级</h2>
<h3>2.1 备份操作</h3>
<h4>2.1.1 停止老服务器的业务服务</h4>
<p>在老服务器的看门狗中停止除了Mysql5.5、MongoDB_3.2和Redis外所有的业务服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/55366dd5a0a9f1445192d94eb1694513" alt="" /></p>
<h4>2.1.2 镜像老服务器</h4>
<p>镜像老服务器的数据到新服务器，<strong>之后的升级操作在新服务器上进行。注意，此时老服务器应当处于停摆状态</strong>，待到新服务器升级完成，再将新服务器的ip切为老服务器的ip，升级期间产生的数据会补传到新服务器上。</p>
<h4>2.1.3 重命名证据文件夹</h4>
<p>以下操作在镜像的新服务器上进行。
找到各个磁盘根目录下的evidencedata目录，重命名evidencedata目录为evidencedata_bak。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/41720051a355b84fb69d247be39feccf" alt="" /></p>
<h4>2.1.4 拷贝mongoDB的数据文件夹</h4>
<p>以下操作在镜像的新服务器上进行。
看门狗中停止MongoDB_3.2服务后，拷贝CMS Server\mongodb_3.2\data\db目录到桌面</p>
<blockquote>
<p>注意：拷贝后的mongo目录不能在CMS Server目录下，否则会在服务器卸载时被删除</p>
</blockquote>
<h4>2.1.5 拷贝Redis的数据文件夹</h4>
<p>以下操作在镜像的新服务器上进行。
看门狗中停止Redis Service服务后，拷贝CMS Server\TransmitSever\redis_service\data目录到桌面</p>
<blockquote>
<p>注意：拷贝后的redis目录不能在CMS Server目录下，否则会在服务器卸载时被删除</p>
</blockquote>
<h4>2.1.6 使用备份还原工具执行备份操作</h4>
<p>以下操作在镜像的新服务器上进行。
使用备份还原工具，备份老服务器，勾选项如下：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b9e46dd4ff4218133a239e54e66e4b2f" alt="" />
勾选完成后点击Start backup，等待备份完成提示框弹出后，检查备份目录下的sql文件大小，若为0，则备份失败。详情可参考CB2FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1283">http://jfwiki.streamax.com:7503/web/#/172/1283</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3be18f601bd6285bdaf4c0fca9be0a8b" alt="" /></p>
<h3>2.2  卸载服务器</h3>
<p>以下操作在镜像的新服务器上进行。
备份完成后，卸载服务器。卸载完成后检查CMS Server目录是否为空，若不为空，手动清空该目录。</p>
<h3>2.3  安装新服务器</h3>
<p>以下操作在镜像的新服务器上进行。
安装新版本CB2服务器。</p>
<h3>2.4 还原操作</h3>
<h4>2.4.1 证据文件夹名还原</h4>
<p>以下操作在镜像的新服务器上进行。
找到2.1.3节中重命名的证据文件夹，将他们的文件名还原为EvidenceData</p>
<h4>2.4.2 使用备份还原工具执行还原操作</h4>
<p>以下操作在镜像的新服务器上进行。
使用datatool备份的数据，打开datatool，点击开始还原，选择之前备份的文件夹，点击确定，等待还原完成即可。</p>
<h4>2.4.3  mongo旧数据还原</h4>
<p>以下操作在镜像的新服务器上进行。
1.在看门狗中停止DVRRTService和MongoDb_3.2服务。
2.拷贝2.1.4节中备份的mongodb的db数据目录，覆盖替换CMS Server\mongodb_3.2\data\db目录。
3.重启DVRRTService和MongoDb_3.2服务。
4.确保所有服务都正常运行。</p>
<h4>2.4.4  redis旧数据还原</h4>
<p>以下操作在镜像的新服务器上进行。
1.在看门狗中停止DVRRTService和redis_service服务。
2.拷贝2.1.5节中备份的redis的data数据目录，覆盖替换CMS Server\TransmitSever\redis_service\data目录。
3.重启DVRRTService和redis_service服务。
4.确保所有服务都正常运行。</p>
<h4>2.4.4 保证所有服务正常运行</h4>
<p>以下操作在镜像的新服务器上进行。
保证看门狗中所有服务正常运行。</p>
<h3>2.5 证据迁移操作</h3>
<p>本次证据迁移使用新的证据迁移工具，以下操作在镜像的新服务器上进行。</p>
<p>点击下载新工具：<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/55c98ba0dad1f2c0200dd41f1128db54" title="[writeEvFile.zip">writeEvFile.zip</a></p>
<h4>2.5.1配置需要迁移的证据目录</h4>
<p>打开迁移工具目录下的WriteEvidenceFileInfo.ini文件，修改EvidencePath为证据文件夹所在目录（注意：目录最后不要带/），在BeginDay配置项按示例格式输入开始迁移的证据日期。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3f418de72c16754dc051e5e52326126a" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f673f457af27e35e0024b84dc45cf273" alt="" /></p>
<h4>2.5.2 运行迁移工具</h4>
<p>找到迁移工具目录下的WriteEvidenceFileInfo.exe，以管理员权限运行。
当看到如下提示时，迁移结束。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0326d786c3a1e4a194c827610851d1f8" alt="" /></p>
<h3>2.6 切换服务器ip</h3>
<p>将新服务器的ip切为老服务器的ip</p>
<h2>3. 本机升级</h2>
<h3>3.1 备份操作</h3>
<h4>3.1.1 停止老服务器的业务服务</h4>
<p>在老服务器的看门狗中停止除了Mysql5.5、MongoDB_3.2和Redis外所有的业务服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/38a7e11ac645b35f55b801e9b7578a9a" alt="" /></p>
<h4>3.1.2 重命名证据文件夹</h4>
<p>找到各个磁盘根目录下的evidencedata目录，重命名evidencedata目录为evidencedata_bak。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b0aaed551d223485894c31470d3b8880" alt="" /></p>
<h4>3.1.3 拷贝mongoDB的数据文件夹</h4>
<p><strong>看门狗中停止MongoDB_3.2服务后</strong>，（请确保该服务完全停止侯，再进行拷贝）拷贝CMS Server\mongodb_3.2\data\db目录到桌面</p>
<blockquote>
<p>注意：拷贝后的mongo目录不能在CMS Server目录下，否则会在服务器卸载时被删除。</p>
</blockquote>
<h4>3.1.4 拷贝Redis的数据文件夹</h4>
<p>看门狗中停止Redis Service服务后，拷贝CMS Server\TransmitSever\redis_service\data目录到桌面</p>
<blockquote>
<p>注意：拷贝后的redis目录不能在CMS Server目录下，否则会在服务器卸载时被删除</p>
</blockquote>
<p>3.1.5 使用备份还原工具执行备份操作
使用备份还原工具，备份老服务器，勾选项如下：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c38b8c8702a82d49d153f4c2762b5209" alt="" /></p>
<p>勾选完成后点击Start backup，等待备份完成提示框弹出后，检查备份目录下的sql文件大小，若为0，则备份失败。详情可参考CB2FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1283">http://jfwiki.streamax.com:7503/web/#/172/1283</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/12ee382c8caa7ed3f3a29c55c252b41f" alt="" /></p>
<h3>3.2  卸载服务器</h3>
<p>备份完成后，卸载服务器。卸载完成后检查CMS Server目录是否为空，若不为空，手动清空该目录。</p>
<h2>3.3  安装新服务器</h2>
<p>安装新版本CB2服务器。</p>
<h3>3.4 还原操作</h3>
<h4>3.4.1 证据文件夹名还原</h4>
<p>找到3.1.2节中重命名的证据文件夹，将他们的文件名还原为EvidenceData</p>
<h4>3.4.2 使用备份还原工具执行还原操作</h4>
<p>使用datatool备份的数据，打开datatool，点击开始还原，选择之前备份的文件夹，点击确定，等待还原完成即可。</p>
<h4>3.4.3  mongo旧数据还原</h4>
<p>以下操作在镜像的新服务器上进行。
1.在看门狗中停止DVRRTService和MongoDb_3.2服务。
2.拷贝2.1.4节中备份的mongodb的db数据目录，覆盖替换CMS Server\mongodb_3.2\data\db目录。
3.重启DVRRTService和MongoDb_3.2服务。
4.确保所有服务都正常运行。</p>
<h4>3.4.4  redis旧数据还原</h4>
<p>以下操作在镜像的新服务器上进行。
1.在看门狗中停止DVRRTService和redis_service服务。
2.拷贝3.1.4节中备份的redis的data数据目录，覆盖替换CMS Server\TransmitSever\redis_service\data目录。
3.重启DVRRTService和redis_service服务。
4.确保所有服务都正常运行</p>
<h4>3.4.5 保证所有服务正常运行</h4>
<p>保证看门狗中所有服务正常运行。</p>
<h3>3.5 证据迁移操作</h3>
<p>本次证据迁移使用新的证据迁移工具，以下操作在镜像的新服务器上进行。</p>
<p>点击下载新工具：<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/55c98ba0dad1f2c0200dd41f1128db54" title="[writeEvFile.zip">writeEvFile.zip</a></p>
<h4>3.5.1配置需要迁移的证据目录</h4>
<p>打开迁移工具目录下的WriteEvidenceFileInfo.ini文件，修改EvidencePath为证据文件夹所在目录（注意：目录最后不要带/），在BeginDay配置项按示例格式输入开始迁移的证据日期。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/16131dced231fa02926e6b986181b5e2" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/23ce6cdad53e22c5bafa0d4941d324c2" alt="" /></p>
<h4>3.5.2 运行迁移工具</h4>
<p>找到迁移工具目录下的WriteEvidenceFileInfo.exe，以管理员权限运行。
当看到如下提示时，迁移结束。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0be88345615a3c2de6f95179d0548f0e" alt="" /></p>
<h3>3.6 切换服务器ip</h3>
<p>将新服务器的ip切为老服务器的ip</p></div><h2>8.8、单机263升级263操作手册</h2><div style="margin-left:0px;"><h1>单机263升级新版本263操作手册</h1>
<h2>1. 背景描述</h2>
<p>距离最早的263发布已经有了两年时间，这期间263版本迭代优化了很多问题，整个平台更加稳定，有越来越多的老263客户希望升级到最新的263版本。</p>
<h3>1.1 版本描述</h3>
<p>升级前版本：2.6.3
预计升级版本：版本>=2.6.3.0.63</p>
<h3>1.2 升级说明</h3>
<p>在做升级操作前，<strong>需要判断报警和证据是否进行了分库分表操作，并判断证据文件记录存放在mongo还是mysql</strong>。支持分库分表与否升级的操作会有差别。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/74742fee2afc862a73996ea22fe4ba22" alt="" /></p>
<p> </p>
<h4>1.2.1 鉴别分库分表</h4>
<p>通过robomongo连接服务器的mongodb，查看alarmreal数据库下，若只有alarm表，则没分库分表，若alarm表按月分表，则代表已经分库分表。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e2e4f59b28a3339556361a3e9f4b6f38" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6ee88aa9b8112956eb7f50a981f022b2" alt="" /></p>
<h4>1.2.2 鉴别证据文件记录存放位置</h4>
<p>通过robomongo连接服务器的mongodb，查看constabulary数据库下，若只有evidence_yyyymm表，没有evidence_file表，则代表证据文件存放在mysql，反之存放在mongo。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a03f5e65b7e5526e040e727b0f781c6a" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c3571712c6ca78780105fac4dd678154" alt="" /></p>
<h3>1.3 升级方法</h3>
<p>镜像升级方法：见2
本机升级方法：见3</p>
<h2>2. 镜像升级</h2>
<h3>2.1 备份操作</h3>
<h4>2.1.1 停止老服务器的业务服务</h4>
<p>在老服务器的看门狗中停止除了Mysql5.5、MongoDB_3.2和Redis外所有的业务服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ed65e5c30dba9db71f33ce161f1b5872" alt="" /></p>
<h4>2.1.2 镜像老服务器</h4>
<p>镜像老服务器的数据到新服务器，之后的升级操作在新服务器上进行。<strong>注意，此时老服务器应当处于停摆状态</strong>，待到新服务器升级完成，再将新服务器的ip切为老服务器的ip，升级期间产生的数据会补传到新服务器上。</p>
<h4>2.1.3 重命名证据文件夹</h4>
<p>以下操作在镜像的新服务器上进行。
找到各个磁盘根目录下的evidencedata目录，重命名evidencedata目录为evidencedata_bak。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0fdcd6f8973a572196c8e2fb5cbd9093" alt="" /></p>
<h4>2.1.4 拷贝mongoDB的数据文件夹</h4>
<p>以下操作在镜像的新服务器上进行。
看门狗中停止MongoDB_3.2服务后，拷贝CMS Server\mongodb_3.2\data\db目录到桌面</p>
<blockquote>
<p>注意，拷贝后的mongo目录不能在CMS Server目录下，否则会在服务器卸载时被删除。</p>
</blockquote>
<h4>2.1.5拷贝Redis的数据文件夹</h4>
<p>以下操作在镜像的新服务器上进行。
看门狗中停止Redis Service服务后，拷贝CMS Server\TransmitSever\redis_service\data目录到桌面</p>
<blockquote>
<p>注意，拷贝后的redis目录不能在CMS Server目录下，否则会在服务器卸载时被删除</p>
</blockquote>
<h4>2.1.6 使用备份还原工具执行备份操作</h4>
<p>以下操作在镜像的新服务器上进行。
使用备份还原工具，备份老服务器，勾选项如下：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/84a92c60d632c8b3634130dbb04fe2f5" alt="" />
勾选完成后点击Start backup，等待备份完成提示框弹出后，检查备份目录下的sql文件大小，若为0，则备份失败。详情可参考CB2FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1283">http://jfwiki.streamax.com:7503/web/#/172/1283</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d78549581979b56c83b2510f5b70327b" alt="" /></p>
<h3>2.2  卸载服务器</h3>
<p>以下操作在镜像的新服务器上进行。
备份完成后，卸载服务器。卸载完成后检查CMS Server目录是否为空，若不为空，手动清空该目录。</p>
<h3>2.3  安装新服务器</h3>
<p>以下操作在镜像的新服务器上进行。
安装新版本CB2服务器。</p>
<h3>2.4 还原操作</h3>
<h4>2.4.1 证据文件夹名还原</h4>
<p>以下操作在镜像的新服务器上进行。
找到2.1.3节中重命名的证据文件夹，将他们的文件名还原为EvidenceData</p>
<h4>2.4.2 使用备份还原工具执行还原操作</h4>
<p>以下操作在镜像的新服务器上进行。
使用datatool备份的数据，打开datatool，点击开始还原，选择之前备份的文件夹，点击确定，等待还原完成即可。</p>
<h4>2.4.3  mongo旧数据还原</h4>
<p>以下操作在镜像的新服务器上进行。
1.在看门狗中停止DVRRTService和MongoDb_3.2服务。
2.拷贝2.1.4节中备份的mongodb的db数据目录，覆盖替换CMS Server\mongodb_3.2\data\db目录。
3.重启DVRRTService和MongoDb_3.2服务。
4.确保所有服务都正常运行。</p>
<h4>2.4.4  redis旧数据还原</h4>
<p>以下操作在镜像的新服务器上进行。
1.在看门狗中停止DVRRTService和redis_service服务。
2.拷贝2.1.5节中备份的redis的data数据目录，覆盖替换CMS Server\TransmitSever\redis_service\data目录。
3.重启DVRRTService和redis_service服务。
4.确保所有服务都正常运行。</p>
<h4>2.4.5 保证所有服务正常运行</h4>
<p>以下操作在镜像的新服务器上进行。
保证看门狗中所有服务正常运行。</p>
<h3>2.5 证据迁移操作</h3>
<p>如果升级前版本报警已经分库分表，且证据文件信息存放在mongo中，则直接进行2.6节操作。
本次证据迁移使用新的证据迁移工具，以下操作在镜像的新服务器上进行。</p>
<p>点击下载新工具：<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a89583043ddd32cfb3add320b97083f3" title="[writeEvFile.zip">writeEvFile.zip</a></p>
<h4>2.5.1配置需要迁移的证据目录</h4>
<p>打开迁移工具目录下的WriteEvidenceFileInfo.ini文件，修改EvidencePath为证据文件夹所在目录（注意：目录最后不要带/），在BeginDay配置项按示例格式输入开始迁移的证据日期。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/65c1e40e4c440250b005b49e2db547cd" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/398331f95d10005a5a53788912562173" alt="" /></p>
<h4>2.5.2 运行迁移工具</h4>
<p>找到迁移工具目录下的WriteEvidenceFileInfo.exe，以管理员权限运行。
当看到如下提示时，迁移结束。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6a8484fd5881cca3ac1f10e1e572de74" alt="" /></p>
<h3>2.6 切换服务器ip</h3>
<p>将新服务器的ip切为老服务器的ip</p>
<h2>3. 本机升级</h2>
<h3>3.1 备份操作</h3>
<h4>3.1.1 停止服务器的业务服务</h4>
<p>在老服务器的看门狗中停止除了Mysql5.5、MongoDB_3.2和Redis外所有的业务服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ed450fa1c17c3e704ebb2152d498618b" alt="" /></p>
<h4>3.1.2 重命名证据文件夹</h4>
<p>找到各个磁盘根目录下的evidencedata目录，重命名evidencedata目录为evidencedata_bak。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/734901209113c46a144a5715dde63f42" alt="" /></p>
<h4>3.1.3 拷贝mongoDB的数据文件夹</h4>
<p>看门狗中停止MongoDB_3.2服务后，拷贝CMS Server\mongodb_3.2\data\db目录到桌面</p>
<blockquote>
<p>注意，拷贝后的mongo目录不能在CMS Server目录下，否则会在服务器卸载时被删除。</p>
</blockquote>
<h4>3.1.4 拷贝Redis的数据文件夹</h4>
<p>看门狗中停止Redis Service服务后，拷贝CMS Server\TransmitSever\redis_service\data目录到桌面</p>
<blockquote>
<p>注意，拷贝后的redis目录不能在CMS Server目录下，否则会在服务器卸载时被删除</p>
</blockquote>
<h4>3.1.5 使用备份还原工具执行备份操作</h4>
<p>使用备份还原工具，备份老服务器，勾选项如下：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ac70eb6ae07cc40ad17f73acfb3969c9" alt="" />
勾选完成后点击Start backup，等待备份完成提示框弹出后，检查备份目录下的sql文件大小，若为0，则备份失败。详情可参考CB2FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1283">http://jfwiki.streamax.com:7503/web/#/172/1283</a>
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/895eb8d84cbb22e0adef1c1c005265fc" alt="" /></p>
<h3>3.2  卸载服务器</h3>
<p>备份完成后，卸载服务器。卸载完成后检查CMS Server目录是否为空，若不为空，手动清空该目录。</p>
<h3>3.3  安装新服务器</h3>
<p>安装新版本CB2服务器。</p>
<h3>3.4 还原操作</h3>
<h4>3.4.1 证据文件夹名还原</h4>
<p>找到3.1.3节中重命名的证据文件夹，将他们的文件名还原为EvidenceData</p>
<h4>3.4.2 使用备份还原工具执行还原操作</h4>
<p>使用datatool备份的数据，打开datatool，点击开始还原，选择之前备份的文件夹，点击确定，等待还原完成即可。</p>
<h4>3.4.3  mongo旧数据还原</h4>
<p>1.在看门狗中停止DVRRTService和MongoDb_3.2服务。
2.拷贝3.1.3节中备份的mongodb的db数据目录，覆盖替换CMS Server\mongodb_3.2\data\db目录。
3.重启DVRRTService和MongoDb_3.2服务。
4.确保所有服务都正常运行。</p>
<h4>3.4.4  redis旧数据还原</h4>
<p>1.在看门狗中停止DVRRTService和redis_service服务。
2.拷贝3.1.4节中备份的redis的data数据目录，覆盖替换CMS Server\TransmitSever\redis_service\data目录。
3.重启DVRRTService和redis_service服务。
4.确保所有服务都正常运行</p>
<h4>3.4.5 保证所有服务正常运行</h4>
<p>保证看门狗中所有服务正常运行。</p>
<h3>3.5 证据迁移操作</h3>
<p>如果升级前版本报警已经分库分表，且证据文件信息存放在mongo中，则直接进行跳过本小节操作。
本次证据迁移使用新的证据迁移工具，以下操作在镜像的新服务器上进行。</p>
<p>点击下载新工具：<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a89583043ddd32cfb3add320b97083f3" title="[writeEvFile.zip">writeEvFile.zip</a></p>
<p>3.5.1配置需要迁移的证据目录
打开迁移工具目录下的WriteEvidenceFileInfo.ini文件，修改EvidencePath为证据文件夹所在目录（注意：目录最后不要带/），在BeginDay配置项按示例格式输入开始迁移的证据日期。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f84d80d9d873e885079dbc1543c129ed" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a40224e8ef87f4cb375d110655d4d5c9" alt="" /></p>
<p>3.5.2 运行迁移工具
找到迁移工具目录下的WriteEvidenceFileInfo.exe，以管理员权限运行。
当看到如下提示时，迁移结束。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8be25c044c0477effb179876883e5ce3" alt="" /></p></div><h2>8.9、使用新DataTool进行升级</h2><div style="margin-left:0px;"><h1><strong>使用新DataTool进行升级</strong></h1>
<h1>1. <strong>备份</strong></h1>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=dce172a887984a7473eabe77c62dbf24" title="[DataTool.zip">DataTool.zip</a>
<strong>使用最新的datatool进行数据备份</strong></p>
<h2><strong>1.1替换最新的备份还原工具</strong></h2>
<p>1.1.1 重命名服务器目录下的Mysql5.5/DataTool文件夹为DataTool_Old。<br />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2c42b68105977f750e2b1b2df79eca5b" alt="" /></p>
<p>2、拷贝新的DataTool文件夹至Mysql5.5目录下，新的备份还原工具在备份时新增了备份后基础数据准确性校验功能。<br />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=dc3029045975352edc24bccd2d4c7e60" alt="" /></p>
<p>3、将之前DataTool_Old目录下的WCMS.DataTool.exe.config文件拷贝至DataTool文件夹。<br />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=963029c4c93aae6b0b91c7128656348a" alt="" />
4、之后所有的备份操作使用新的备份还原工具进行。</p>
<h2><strong>1.2使用备份还原工具进行备份操作</strong></h2>
<p><strong>右键管理员启动</strong>CMS Server\MySql5.5\DataTool目录下的备份还原工具WCMS.DataTool.exe。勾选项如下：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=87c67b068835ed33546b25983c6f1277" alt="" />
勾选完成后点击Start backup，<strong>等待备份完成提示框弹出后</strong>，备份完成。数据量大的话，备份时间会比较长。</p>
<h2><strong>1.3备份数据检查</strong></h2>
<p>1、备份目录下的sql文件大小，若为0，则备份失败。详情可参考CB2FAQ：<a href="#/17?page_id=121"><a href="http://cqfaq.streamax.com:7503/web/#/17?page\_id=121">http://cqfaq.streamax.com:7503/web/#/17?page\_id=121</a></a><br />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=c3c50f4032e2da060e589057f93e9db2" alt="" />
2、打开备份目录下的mongodb_3.2\data\log\MongoDB.log文件，拉到文件底部，查看是否有如下提示，则表明mongo备份成功，为了安全起见，接下来检查备份出来的mongodb data文件夹数据与原monogdb data文件夹数据大小是否一致。<br />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=c9aa78778e97b509db45f208c28b0746" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=fe431ff93113f8c5ecc06a7a3c792608" alt="" /></p>
<h1>2. <strong>卸载服务器</strong></h1>
<p>备份完成后，卸载服务器。卸载完成后检查CMS Server目录是否为空，若不为空，检查是否有进程未杀掉，然执行removedir.bat脚本再次对程序文件进行清理。</p>
<h1><strong>3. 安装新服务器</strong></h1>
<p>安装指定版本</p>
<h1><strong>4.还原操作</strong></h1>
<h2><strong>4.1 使用备份还原工具执行还原操作</strong></h2>
<p><strong>右键管理员权限</strong>打开datatool，点击还原，选择之前备份的文件夹，点击确定，等待还原完成即可。</p>
<h2><strong>4.2 保证所有服务正常运行</strong></h2>
<p>保证看门狗中所有服务正常运行。</p></div></div><h1>9、基础运维操作</h1><div style="margin-left:0px;"><h2>9.1、服务的启动、停止、重启、卸载</h2><div style="margin-left:0px;"><h1>服务的启动、停止、重启、卸载</h1>
<h2>1、基于Windows服务器</h2>
<h4>1、1 打开任务管理器</h4>
<p>点击服务器的任务栏，点击任务管理器。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/bae06a2fbc30f7e0138cc945010dc296" alt="" /></p>
<h4>1、2 点击服务--打开服务</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fd433eb15957a9b8ac461adc8e417e65" alt="" /></p>
<h4>1、3 找到自己需要操作的服务</h4>
<p>点击自己需要操作的服务，点击左上角的停止或者重启动。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3c6608287d02ddddcea1ae1e9bfb7fb7" alt="" /></p>
<p>如果没有启动的服务，点击启动即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fcab8347810414505eeecb240dcc8d4f" alt="" /></p>
<h2>2、基于CMS Server的看门狗服务</h2>
<h4>2、1 打开看门狗界面</h4>
<p>（1）一般在服务器的右下角可以找到看门狗服务的进程，点击打开窗口即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/709f8e703c27024d202e1317b12ed693" alt="" /></p>
<p>（2）如果在右下角找不到该看门狗服务的进程，可以进入CMS Server\TransmitServer目录，单击DVRServerCtrl.exe，选择以管理员身份运行，然后到服务器的右下角去找即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ba1cc7f3f2d422b111ebdbdf6ee309c8" alt="" /></p>
<p>（3）如果以管理员身份运行提示Other user run program，请参考以下FAQ处理：
xxxxx</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4ebe864b6897d0d740b1caa1b794d96d" alt="" /></p>
<p>（4）正常打开看门狗界面以后，点击单个服务进行开始和停止即可，也可以点击停止所有服务和开始所有服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2285bf48704ff71f6e6c7225eccd553c" alt="" /></p>
<p>（5）点击安装服务器，还可以选择安装、卸载服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5c81acb6161e4624996ca4f1944b31a0" alt="" /></p></div><h2>9.2、查看端口监听</h2><div style="margin-left:0px;"><h1>查看端口监听</h1>
<p>(1)按下win + r，输入cmd，点击回车。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6cb6824a31a69641029965ccddb12e04" alt="" /></p>
<p>进入到如下界面：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ce39904f26e1151cb962b3785ea2fa66" alt="" /></p>
<p>（2）查看某个端口是否监听，比如12020端口</p>
<table width='100%' class='codestyle'><pre><code>netstat -ano | findstr 12020</code></pre></table>
<p>没有打印任何信息，就是未监听。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cc976a17fc271ad8eab3fb59ef7e9402" alt="" /></p>
<p>有打印信息，且状态为LISTENING表示端口处于监听状态，最后一个数字为该端口对应进程的pid信息，可以通过任务管理器的详细信息中查看。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/da9670d9bf6441d3ca47190d289fbe0e" alt="" /></p></div><h2>9.3、检查端口映射</h2><div style="margin-left:0px;"><h1>检查端口映射</h1>
<p>比如我们要确定8081这个端口是否映射</p>
<p>（1）首先需要确认服务器本地的8081端口是否监听。
可以参考FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1286">http://jfwiki.streamax.com:7503/web/#/172/1286</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6d12a0bd7f42a775ea9fe188a291d581" alt="" /></p>
<p>（2）<strong>确认了服务器本地的8081是正常监听</strong>，那么需要在<strong>自己的电脑上或者服务器上</strong>打开cmd。</p>
<p>使用win + r 输入cmd 回车即可打开。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6b764ad5a87c94a568cfae9527821063" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/805c50264f50f35e1192335b859fdb8b" alt="" /></p>
<p>（3）在cmd里面去输入telnet 你要测试的服务器的外网ip  8081
然后回车。</p>
<blockquote>
<p>注意前提：一定是服务器本地的8081是正常监听，如果本地都没有正常监听，那么不管端口是否开放，都会返回连接失败。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a9146f6306063b16a7ce249fa8eb0a12" alt="" /></p>
<p>如果出现以下的界面，则表示端口是正常映射。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/db4420f2a87d0b3639e492c7fd4be537" alt="" /></p>
<p>如果出现以下界面，则表示端口未映射，联系客户映射即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5e0363dfe766e20af20d316c5e9f2193" alt="" /></p>
<h1>补充知识</h1>
<p>如果你发现端口正常监听，而且也能telnet通，但是访问还是存在问题。
那么可能是端口映射错误。</p>
<p>例如以下情况：
（1）首先在自己的电脑上打开cmd窗口，并去telnet 你需要访问的端口，这里是8090.</p>
<p>（2）然后进入服务器端，使用nestat -ano | findstr 8090，观察8090建立连接的情况。</p>
<p>如下图所示，虽然telnet是通的，服务器本地的8090也正常监听，但是却没有建立以我电脑网络的连接，即可得知，8090端口映射错误。
即我们telnet 通的8090端口 对应的服务器内网端口不是8090，所以才没有任何连接建立。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a1800d8e5bf97318db392fe0bd0141a9" alt="" /></p>
<p>正常的建立连接如下：</p>
<p>这个192.168.153.238就是此时我电脑的内网ip，正常情况下大家telnet都是外网，所以建立连接这里会是外网ip。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3fda4e1efc9e4de53bf6f9acbd6cca1f" alt="" /></p></div><h2>9.4、定时备份</h2><div style="margin-left:0px;"><h1>定时备份</h1>
<h2>背景</h2>
<p>为了避免基础数据丢失，定期备份基础数据并发送到指定邮箱。</p>
<h2>使用方法</h2>
<h3>1、下载文件</h3>
<p>点击以下链接下载sendmail.exe与config.ini，注意showdoc下载下来的文件名字是当天时间加英文，请将文件下载下来后重命名为正常的文件名。</p>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/304a512c739c0e3fee7a3ed9cb3489cf" title="[config.ini">config.ini</a></p>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2d09be95d37d5e0752b589810c2f5d06" title="[sendmail.exe">sendmail.exe</a></p>
<h3>2、将下载的文件上传到服务器</h3>
<p>将第一步下载的文件放置到对应服务器的CMS Server/Mysql5.5/bin目录下</p>
<h3>3、修改配置文件</h3>
<p>配置文件里面需要修改部分如下：</p>
<p>收件箱(inbox)：配置为客户的收件箱即可，暂时只支持配置一个收件箱！！（后续有多个收件箱的需求在修改）</p>
<p>serverip：服务器的公网ip和内网ip都可以，主要是为了发邮件的时候说明是哪台服务器的备份文件</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5afc17928bcbf5acf42fd47052a22738" alt="" /></p>
<p>tables：需要备份的表，一般情况下请不要动！！</p>
<p>isautomail：为0表示需要自己填写发件箱（即填写以下的smtpserver、sender、password），为1使用公司的默认邮箱发送(smtpserver、sender、password这几项可以不动)。</p>
<p>smtpserver：发件箱的smtp服务器，注意发件邮箱必须开启smtp服务，如下所示。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/71af8d5fd0cae56ca588d1288e377854" alt="" /></p>
<p>sender：发件人邮箱地址</p>
<p>password：发件人邮箱密码，注意某些发件箱必须使用授权码才可以正常登录邮箱，授权码也是在对应的邮箱的设置里面，如下所示。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e1b12f5121770cd68597ea5f1fcf83db" alt="" /></p>
<h3>4、测试备份是否正常</h3>
<p>点击以下链接查看操作视频：</p>
<p><a href="https://streamja.com/9ovGJ">https://streamja.com/9ovGJ</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e098f70504a96fcf078a156d9e1f28f9" alt="" /></p>
<h3>5、配置计划任务</h3>
<h4>5、1 打开任务计划程序</h4>
<p>找到服务器上的任务计划程序并打开</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/32a404dc36d79e9269a6ecd6bd9cafdc" alt="" /></p>
<h4>5、2 创建计划任务</h4>
<p>点击创建任务</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/59c6838d40af17926d3df9a85c7641c7" alt="" /></p>
<p>名称随意，选择不管用户是否登录都要运行，选择使用最高权限运行</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8830fb3564c9ed89abfe1c862187ad4b" alt="" /></p>
<p>设置触发器，每周六</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/eeb66dc4bebc710adef52b3632715139" alt="" /></p>
<p>新建操作</p>
<p>程序或脚本："E:\Program Files (x86)\CMS Server\MySql5.5\bin\sendmail.exe"
起始于：E:\Program Files (x86)\CMS Server\MySql5.5\bin\</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/92bf06e47fffd4558ff6deeb59ca3d02" alt="" /></p>
<p>最后点击确定，输入服务器的密码即可</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/85e16f799f1e35753889aafe837d1c96" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e0de92ced16d7a16066d6d6d1a2697e0" alt="" /></p></div><h2>9.5、web自动跳转https端口</h2><div style="margin-left:0px;"><h1>诉求</h1>
<p>客户CB2 已经开启HTTPS，已经可以通过https://域名:22056 方式访问了，客户诉求是希望能够通过http自动跳转到https。</p>
<h1>操作说明</h1>
<p>目前推荐是用80端口跳转到22056 https端口上，也就是在浏览器输入http：//域名，能够自动跳转到https://域名:22056/ .
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=874e15a4586c14669d7860fb035c0575" alt="" />
增加红框的配置</p>
<table width='100%' class='codestyle'><pre><code>server
{
    listen 80;
    server_name httphost;
    return 301 https://$host:22056$request_uri;
}</code></pre></table>
<h1>为什么不能用12056跳转22056</h1>
<p>12056端口本身是由CB2平台 WCMS5服务监听，实现nginx代理跳转，如果Nginx再监听12056端口则会端口冲突。
如果要改动12056，涉及内部服务端口调整，工作量非常大，<strong>非签署SLA合同的客户不响应该诉求。</strong></p>
<h1>原理说明</h1>
<p>http状态码 301:redirect 代表永久性转移(Permanently Moved)
详细来说，301和302状态码都表示重定向，就是说浏览器在拿到服务器返回的这个状态码后会自动跳转到一个新的URL地址，这个地址可以从响应的Location首部中获取（用户看到的效果就是他输入的地址A瞬间变成了另一个地址B）——这是它们的共同点。他们的不同在于。301表示旧地址A的资源已经被永久地移除了（这个资源不可访问了），搜索引擎在抓取新内容的同时也将旧的网址交换为重定向之后的网址；302表示旧地址A的资源还在（仍然可以访问），这个重定向只是临时地从旧地址A跳转到地址B，搜索引擎会抓取新的内容而保存旧的网址。
1、什么是重定向啊？</p>
<p>​ 就是地址A跳转到地址B啦。百度百科的解释：重定向就是通过各种方法将各种网络请求重新定个方向转到其它位置（如：网页重定向、域名的重定向、路由选择的变化也是对数据报文经由路径的一种重定向）。</p></div></div><h1>10、常用运维工具</h1><div style="margin-left:0px;"><h2>10.1、WireShark抓包工具及使用</h2><div style="margin-left:0px;"><p>[toc]</p>
<h1>wireshark抓包</h1>
<h2>1、下载wireshark</h2>
<p>下载链接如下：<a href="http://jf.streamax.com:8081/f/cb888e84256d4a9eb659/?dl=1">http://jf.streamax.com:8081/f/cb888e84256d4a9eb659/?dl=1</a></p>
<h2>2、使用方法</h2>
<h4>（1）安装winpcp</h4>
<p>打开下载文件夹的目录，双击WinPcap_4_1_2.exe，根据提示安装即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7cccf93d3e1a3b32a9f03ac21f6a23ff" alt="" /></p>
<h4>（2）找到需要抓包的设备的ip</h4>
<p>1)打开DVRServerCtl，双击MessagerServer，等待出现MessagerLogView.</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/af75d8e746f56c349121e4f6c276c417" alt="" /></p>
<p>2)右键点击设备端列表区域，然后点击查找。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4139a0b21dacf2965eaeb11a32b1dc2a" alt="" /></p>
<p>3）查询自己想要抓包的设备芯片号，获取到该设备的设备ip，当前我需要抓包的设备ip为117.61.0.247
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1b07c65b0126e2944fce2f4a4b060885" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ccf4705be86a9ea764512a8849317002" alt="" /></p>
<h4>（3）开始抓包</h4>
<p>1）双击wireshark.exe</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a751b1491479d4c54c655dd21a639c67" alt="" /></p>
<p>2)选中需要抓包的网卡</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/176036a54cc0ecdcab6683d97f122dec" alt="" /></p>
<p>3）先停止，然后输入过滤条件，在重新开始抓包。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ce92c7bf2752ae2da230290b1e83c42a" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/bfacd3c65f8bf96d86e0d16df9f77e11" alt="" /></p>
<p>4）抓一段时间后，停止当前抓包，点击另存为，输入文件名后，点击保存。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/168a680f143782844750284f3895432e" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6ebcbbe04096444e0976014c6d12e1a8" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5a4c7723492ac44726db29dfcb8335ea" alt="" /></p>
<p>5）最后将抓取的文件发给研发分析即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/79258ac84c40888ea629f74898562b00" alt="" /></p>
<h2>3、复杂问题分析</h2>
<h3>3.1) 直通视频请求失败， 或者卡顿</h3>
<p>tcp.port==17891 or tcp.port==12092  and  tcp.analysis.flags
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=36e69c4e124f8073a450435483a6f021" alt="" />
每个状态介绍 <a href="https://blog.csdn.net/ynchyong/article/details/109110028">https://blog.csdn.net/ynchyong/article/details/109110028</a>
到12092端口的数据包有异常，设备上行或者服务器下行有问题。 </p></div><h2>10.2、DebugView打印工具</h2><div style="margin-left:0px;"><h1>debugview打印工具</h1>
<h2>1、debugview链接</h2>
<p>debugview链接如下，点击链接即可下载：<a href="http://jf.streamax.com:8081/f/33f883fe149a4ed8a7d8/?dl=1">http://jf.streamax.com:8081/f/33f883fe149a4ed8a7d8/?dl=1</a></p>
<h2>2、打开debugview</h2>
<p><strong>请打开刚刚下载的debugview文件夹，右键选中Dbgview.exe，选中以管理员身份运行。</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fb3d87f1786912b3710b2dc101c54607" alt="" /></p>
<p><strong>在弹出的提示框include里面输入自己需要过滤的信息，我这里是过滤“DeviceRecordInfo;DeviceRecordErr”，然后点击ok。若没有弹出提示框，点击蓝色的图标也可以打开</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0073bd25e0d30c57f905fb8512c89591" alt="" />
或者是从任务管理器查看客户端的PID，例如下图
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=77b4d753152e76aeb3f2d2b9ad872baa" alt="" />
将27624输入，再确定
<strong>方法二：</strong>
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4fa660b5656a0e1c43d05074de387b5c" alt="" /></p>
<p><strong>进入debugview的页面后，点击Capture,将除了Log Boot以外的选项都勾上，如下图所示。</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7a42add7f64288484d5c5032949da1ba" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b61b0e4c66f12b6272d134a71e9ce9b1" alt="" /></p>
<h2>然后等待程序打印信息即可。</h2>
<p>左上角file -save， 保存日志文件通过RDMS提交即可。 </p></div><h2>10.3、Redis数据库管理工具</h2><div style="margin-left:0px;"><h1>Redis数据库管理工具使用</h1>
<h2>1、安装RedisDesktopManager</h2>
<p>RedisDesktopManager下载链接如下：
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2e73e9ef5400dd02d02da413738e524f" title="[api-ms-win-crt-runtime-l1-1-0.zip">api-ms-win-crt-runtime-l1-1-0.zip</a>
<a href="http://jf.streamax.com:8081/f/fd3544c32437470f8302/?dl=1">http://jf.streamax.com:8081/f/fd3544c32437470f8302/?dl=1</a>
直接在服务器上双击安装即可。</p>
<h2>2、使用方法：</h2>
<h4>（1）双击安装完成的RedisDesktopManager，点击左下角的connect to redis Server。</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/794bc79ef5847c5d221002063678568b" alt="" /></p>
<h4>（2）输入name任意，host：127.0.0.1，port：12004， Auth：cqrm123151qaz2WSX，点击ok，双击左上角的刚刚添加的名字打开数据库，只需要看db0即可。</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1ae69190031f8980c00409d768363085" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/be184a0d08fc71e378115f03bf5ffc2b" alt="" /></p>
<h2>3、问题示例</h2>
<h3>3.1 证据堆积</h3>
<h3>3.2 单一队列数据量过大导致redis性能下降</h3></div><h2>10.4、Mysql数据库管理工具</h2><div style="margin-left:0px;"><h3>1、使用navicat连接数据库。</h3>
<p>navicat下载链接如下：
<a href="http://jf.streamax.com:8081/f/7553c992f064433e8b90/?dl=1">http://jf.streamax.com:8081/f/7553c992f064433e8b90/?dl=1</a></p>
<h3>2、打开navicat.exe，点击左上角的连接，所有信息输入完成后，点击连接测试，提示连接成功后，点击确定即可成功连接。</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=d0f81b85055635d67961c1a65c44f894" alt="" /></p>
<p>注意事项：
具体的数据库端口配置查看CB2端口配置工具
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=38148b9500b5659d82d34289062db0f2" alt="" />
mysql数据库端口为：3307
密码可通过查看：..\CMS Server\TransmitServer\HttpSdkService中的HttpSdkConfig.ini 的配置文件</p>
<blockquote>
<p>切记不要对配置文件进行修改</p>
</blockquote>
<h3>3、如果连接异常，则参考还原密码。</h3>
<blockquote>
<p>参考专家部门意见</p>
</blockquote></div><h2>10.5、DataTool自动备份工具</h2><div style="margin-left:0px;"><h1>DataTool自动备份工具</h1>
<p>（1）进入CMS Server\MySql5.5\DataTool目录下，双击WCMS.DataTool.exe打开备份还原工具。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/291b12b48158ab61713a524fcba3d7d3" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/12762e68eac052bd925573ee11227411" alt="" /></p>
<p>（2）自动备份配置
首先开启自动备份，选择覆盖策略，这里选择的是永不覆盖。
之后选择备份频率，可以选择每天/每周/每月，这里选择每周星期天的凌晨3点半。
然后选择数据备份的路径，最后点击保存即可。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7bfa37d6e3f2f268dfe7893810d0a23c" alt="" /></p></div><h2>10.6、Mongodb数据库管理工具</h2><div style="margin-left:0px;"><h1>Mongodb数据库管理工具</h1>
<h2>1、安装Mongodb</h2>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=c4eaa651af729cc67b0abadc844af262" title="[robomongo-1.0.0-windows-x86_64.zip">robomongo-1.0.0-windows-x86_64.zip</a></p>
<h2>2、使用方法</h2>
<h4>（1）点击Create</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6a9baf57be1a4667b2a9bdb7cc43c224" alt="" /></p>
<h4>（2）将端口修改为27018，点击save</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b5ecc7bc6a9cb6b2df72bf5cc6136b31" alt="" /></p>
<h4>（3）选中刚刚建立的连接，点击connect</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e1d8d4a12da53eb0ad5d0fcf6b0ee89e" alt="" /></p>
<h4>（4）evidence相关的表在constabulary数据库里面，点开Collections即可看到。</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/dbc3330c28ebc67270b9197635bfae6f" alt="" /></p>
<h4>（5）若要手动删除历史GPS数据</h4>
<p>在数据库上点击右键，选择drop database即可
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b8c85339d574d90a9491d05ee9c0036b" alt="" /></p></div><h2>10.7、PostMan接口测试工具</h2><div style="margin-left:0px;"><h1>postman接口测试</h1>
<h2>1、下载postman</h2>
<p>下载链接如下：<a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/JFZJB/ywtools/CB2/PostMan/Postman-win64-Setup.exe">[PostMan]</a></p>
<h2>2、使用方法</h2>
<p>（1）打开下载文件夹的目录，双击Postman.exe,安装后自动打开。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=973b8b1df8e56cfa58d3ee91bcf19de2" alt="" /></p>
<p>（2）点击左下角 <u>Skip and go to app</u> ，跳过登录。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=8c888d597b241f904830167549850123" alt="" /></p>
<p>（3）新建一个项目+，右键<u> Add Request </u></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=cbe3bdefb4338b17e220973d318a779f" alt="" /></p>
<p>（4）选择需要发送请求类型，填入API地址。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=36838f20ef8a038b4eac823e729c5481" alt="" /></p>
<p>（5）例子</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6a0030c889b1d7f065cf4f7213be2bce" alt="" /></p></div><h2>10.8、N9M模拟上线工具</h2><div style="margin-left:0px;"><p>[toc]</p>
<h1>N9M模拟器</h1>
<h2>1、下载</h2>
<p>下载安装包：<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=1389b9ae244a92e208f1e4d9dc097630" title="[N9M.zip">N9M.zip</a></p>
<h2>2、使用方法如下</h2>
<h4>（1）、安装N9M</h4>
<p>下载文件过后解压即可</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=4443817b95fd189a5f30f9d5c4c4da63" alt="" /></p>
<h4>（2）、找到ceiba2服务器的ip</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=76b0466debf64dfe257de5029df3e77d" alt="" /></p>
<h4>（3）、打开N9M模拟器</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=eb2b8c136c6eb9fab3e990085a767849" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=98ccf2c74b83b656ffc17b1fd4328317" alt="" /></p>
<h4>（4）、添加视频来源</h4>
<ul>
<li>
<p>打开选项选择视频文件路径
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=c89b9ce4ca983f893f0aaa055be052d3" alt="" /></p>
</li>
<li>添加压缩包内置视频
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=7d995c0098aebcf9eca9a6b08f79dc9f" alt="" /></li>
</ul>
<h4>（5）、添加模拟器设备</h4>
<ul>
<li>单击右键选择添加，IP为服务器ip</li>
</ul>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5d3c8aed396ae6ede0a02b6a3103eaa0" alt="" /></p>
<h4>（6）、调整设备属性</h4>
<ul>
<li>选择设备单击右键选择属性
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f689cb3121d8689faecdcf24fb10e0c5" alt="" /></li>
</ul>
<h4>（7）、设备上线</h4>
<ul>
<li>选择设备单击右键选择上线
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=230c10d1eec42c68093cef6791b7edd0" alt="" /></li>
</ul>
<h4>（8）、进入客户端查看是否上线成功</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e1bbfd63606ee71eda61db8f63184285" alt="" /></p></div><h2>10.9、新DataRool自动备份工具</h2><div style="margin-left:0px;"><h1>备份还原工具备份数据完整性校验版本及使用说明</h1>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=8503e1efa88229ed89396cc403833023" title="[DataTool.zip">DataTool.zip</a></p>
<h3>1. 适用范围</h3>
<p>     基线2.6.2以后版本。</p>
<h3>2. 本机升级</h3>
<p><font color=red size = 5>注意，整个升级过程中，业务将处于不可使用状态！
升级前确认备份的磁盘剩余空间充分。
</font></p>
<h3>2.1 备份操作</h3>
<h4>2.1.1  替换最新的备份还原工具</h4>
<p>1. 重命名服务器目录下的Mysql5.5/DataTool文件夹为DataTool_Old。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=9df6bfdb81ef7705967ef4fa48316ece" alt="" /></p>
<p>2. 拷贝新的DataTool文件夹至Mysql5.5目录下，新的备份还原工具在备份时新增了备份后基础数据准确性校验功能。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=4738f4558b2b272e55f01661da8e138c" alt="" /></p>
<p>3. 将之前DataTool_Old目录下的WCMS.DataTool.exe.config文件拷贝至DataTool文件夹。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=103671b06c938d9a5569756e7efa20bd" alt="" />
之后所有的备份操作使用新的备份还原工具进行。</p>
<p> </p>
<h4>2.1.2 使用备份还原工具执行备份操作</h4>
<p>右键管理员启动CMS Server\MySql5.5\DataTool目录下的备份还原工具WCMS.DataTool.exe。勾选项如下：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=a6ca17981b360f125372cd80657d5ad7" alt="" /></p>
<p>勾选完成后点击Start backup，等待备份完成提示框弹出后，备份完成。数据量大的话，备份时间会比较长。</p>
<h4>2.2.3备份数据检查</h4>
<p>1、备份目录下的sql文件大小，若为0，则备份失败。详情可参考CB2FAQ：<a href="http://cqfaq.streamax.com:7503/web/#/17?page_id=121">http://cqfaq.streamax.com:7503/web/#/17?page_id=121</a>
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f145f938c22415e27841537ab2e5fac0" alt="" />
2、打开备份目录下的mongodb_3.2\data\log\MongoDB.log文件，拉到文件底部，查看是否有如下提示，则表明mongo备份成功，为了安全起见，接下来检查备份出来的mongodb data文件夹数据与原monogdb data文件夹数据大小是否一致。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=fe8d71c0dafa66e5477a0e1275b1b4b0" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f38046ed3a7a916211b07a250702e018" alt="" /></p>
<h3>2.2  卸载服务器</h3>
<p>备份完成后，卸载服务器。卸载完成后检查CMS Server目录是否为空，若不为空，检查是否有进程未杀掉，然执行removedir.bat脚本再次对程序文件进行清理。</p>
<h3>2.3  安装新服务器</h3>
<p>安装指定版本</p>
<p> </p>
<h3>2.4 还原操作</h3>
<h4>2.4.1 使用备份还原工具执行还原操作</h4>
<p>右键管理员权限打开datatool，点击还原，选择之前备份的文件夹，点击确定，等待还原完成即可。</p>
<h4>2.4.2 保证所有服务正常运行</h4>
<p>保证看门狗中所有服务正常运行。</p>
<p> </p>
<p> </p>
<p> </p></div><h2>10.10、端口监听工具</h2><div style="margin-left:0px;"><h1>端口监听工具-sokit</h1>
<p>路径：<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5f863ba1d44d3814140f15e95f6e0f8c" title="[sokit.zip">sokit.zip</a></p></div><h2>10.11、iperf 工具的使用</h2><div style="margin-left:0px;"><h1>背景</h1>
<p>CB2 常常遇到视频请求失败，或者卡顿的情况，证据上传慢等和网络相关的问题。 </p>
<h1>使用方式</h1>
<h2>下载地址，或者百度即可</h2>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=0616f60bef39385ab5c17d454b957104" title="[iperf-3.1.3-win64.zip">iperf-3.1.3-win64.zip</a></p>
<h2>服务器端操作——解压，在地址栏输入cmd 回车</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=7c2caa26aab94b68af521276c5d83969" alt="" />
输入  iperf3.exe -s -p 8400 , 该端口需要提前联系客户开通， 操作系统防火墙也需要开启。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=0ba516b56d39ffddb815a0ee7f79cdd8" alt="" /></p>
<h2>客户端操作---解压，在地址栏输入cmd 回车</h2>
<p>输入  iperf3.exe -c 服务器公网IP  -p 8400
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6c95df0aac735341f219f2a2756640d5" alt="" />
测试完成后，服务端界面如下。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=799b0a15f8e592dd63616833e2fc4693" alt="" /></p></div></div><h1>11、系统对接</h1><div style="margin-left:0px;"><h2>11.1、28181对接</h2><div style="margin-left:0px;"><h1>28181对接</h1>
<h2>1、服务安装</h2>
<p>参考以下faq：<a href="http://jfwiki.streamax.com:7503/web/#/172/1343">http://jfwiki.streamax.com:7503/web/#/172/1343</a></p>
<h2>2、对接中遇到问题</h2>
<p>请参考以下文档排查：
1、<a href="http://jf.streamax.com:8081/f/59d2909ece104dc59d78/?dl=1" title="[GB28181国标网关服务常见问题排查及解决说明2019.docx">GB28181国标网关服务常见问题排查及解决说明2019.docx</a>
2、<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f276520cac65d43c3508c4058fe4db19" title="[GB28181国标网关服务对接说明20190702.docx">GB28181国标网关服务对接说明20190702.docx</a></p></div><h2>11.2、809对接</h2><div style="margin-left:0px;"><h1>809对接</h1>
<p>新旧809协议对比
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c1843913b894007a0d2f9fd37f0dc551" title="[JT809协议变化汇总.docx">JT809协议变化汇总.docx</a>
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3d7ce98f37a7998e7443da16595b9994" title="[新旧809差异.pptx">新旧809差异.pptx</a></p>
<h2>1、安装服务</h2>
<p>此处可参考国标服务的安装，仅仅只是安装包不同而已，安装包找BU或者产品线拿：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1343">http://jfwiki.streamax.com:7503/web/#/172/1343</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f37d61b5f47be2bf79784705d90a35c8" alt="" /></p>
<p>错误案例：
服务的path路径应该指向对应的EXE，而不是目录。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6a94dd0079084bd60fee78565300b390" alt="" /></p>
<h2>2、配置</h2>
<p>路径CMS server\TransmitServer\gpsserver\config\GpsConfig.ini
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a135c567b1a376fa041e1df2cf703e23" alt="" /></p>
<p>address: CMS/CEIBA2服务器地址
username: CMS/CEIBA2服务器用户名
password: CMS/CEIBA2服务器密码
otherserver: 客户提供的IP
otherport: 客户提供的端口</p>
<p>如果客户需要有选择性的转发GPS,那么首先得在平台上增加这个车牌号,设备ID,然后在MDB文件中加入相关信息, 添加完成之后,重启GPS服务生效.</p>
<h2>3、FAQ</h2>
<p>1、目前只能全部所有车辆GPS，不能指定转发。（190527确认）</p>
<p>2、如果发现不转发GPS，可以在注册服务器配置文件加一个参数 UseUpServer=1 重启注册</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6f8bf36a7073f0dc1e376c7c5f8087bb" alt="" /></p>
<p>3、用debugview 查看转发日志，关键字Runyuan809</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3feba29064c244024dc3258c9174341f" alt="" /></p>
<h2>备注</h2>
<p>如果还有问题请联系技术专家部同事</p></div><h2>11.3、H5对接</h2><div style="margin-left:0px;"><p>1.H5 API接口说明
（1）使用谷歌浏览器登录如下API地址：
<a href="http://ip:12056/help/api/default.html">http://ip:12056/help/api/default.html</a>
首次登录需要输入ceiba2客户端用户名密码
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/316603869d8e7452b02a1c45fc752d77" alt="" />
（2）登录成功后，再次到浏览器输入上述地址，即可跳转到如下API说明界面：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/338c00e9c41e72d57bccc66ad01cd7a4" alt="" />
2.视频功能调试及测试DEMO使用说明
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c256901db9639fde8704a564bc4ea4b7" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cc42b3386eeccf9259538d1ccdb29367" alt="" />
3.重要提示
调用方（客户平台）如果使用的https，那么CB2必须配置为HTTPS（导入证书等，<a href="http://jfwiki.streamax.com:7503/web/#/172/1345">http://jfwiki.streamax.com:7503/web/#/172/1345</a>）
有个前端开发知识点：如果调用方是https，将无法调用http的资源（例如API），浏览器会默认阻止。</p>
<p><strong>如果客户连这个都不知道，请慎重同意对接需求。
如果客户连这个都不知道，请慎重同意对接需求。
如果客户连这个都不知道，请慎重同意对接需求。</strong>
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2fc70bac32fbfeeb16a05e24be73bef6" alt="" />
2.1实时视频调用
Demo视频url参考地址：
<a href="http://ip:12060/live.flv?devid=002B017A83&chl=1&st=1&isaudio=1（指的是读取002B017A83设备第一通道带音频的子码流，需要设备在线">http://ip:12060/live.flv?devid=002B017A83&chl=1&st=1&isaudio=1（指的是读取002B017A83设备第一通道带音频的子码流，需要设备在线</a>）
<a href="http://ip:12060/live.flv?devid=002B0169FD&chl=3&st=0&isaudio=1（指的是读取002B0169FD设备第三通道带音频的主码流，需要设备在线">http://ip:12060/live.flv?devid=002B0169FD&chl=3&st=0&isaudio=1（指的是读取002B0169FD设备第三通道带音频的主码流，需要设备在线</a>）</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d561f45c511c8225ce4888745f223ae7" alt="" /></p>
<p>录像回放
视频url参考地址：
<a href="http://ip:8090/play/002B0169FD/3/20210512090000_20210512093000_main.m3u8">http://ip:8090/play/002B0169FD/3/20210512090000_20210512093000_main.m3u8</a>
<a href="http://ip:8090/play/002B017A83/3/20210512090000_20210512093000_main.m3u8">http://ip:8090/play/002B017A83/3/20210512090000_20210512093000_main.m3u8</a>
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a159b12f314c308246a14a5c802c6d63" alt="" /></p>
<p>问题列表：
1、demo中视频打不开
首先检查PC客户端/WEB上上能否打开。
否则检查相应端口是否打开，8090,12060-12063(N9M),12198-12202(mdvr)
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9c2c874b5cf66fb727d26b0387445a3d" alt="" />
https端口应该是如下图所示：重点检查22060-22063,28090,28091
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=91bffcf29a043dc909039fb3f2abbde9" alt="" /></p></div><h2>11.4、809新（2022.12.26更）</h2><div style="margin-left:0px;"><h1>一、安装包</h1>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=80a79d7d4fbc07ae9f75ce0454905ad5" title="[RunYuan809.zip">RunYuan809.zip</a></p>
<h1>二、说明</h1>
<p>由于新版CB2服务器是messageprocess服务推送的，老的809服务还没兼容这种情况</p>
<h1>三、使用方法</h1>
<p>功能点：
1.登录连接809上级平台
2.连接WCMS服务器，接收服务器推送设备数据
3.以809协议格式转发服务器转发的证据信息（润缘项目）、GPS数据、报警数据和串口信息（浩文项目）到上级平台
4.809上级平台地址、WCMS服务器地址和809登录相关参数在config.ini中配置
4.1 UpIp-809上级平台IP地址<br />
4.2 UpPort-809上级平台端口号
4.3 ServerIp-WCMS服务器IP地址
4.4 ServerPort-WCMS服务器端口号（默认为12012，带有MessageProcessService服务时该端口号为12135）
4.5 809UserName-809下级平台登录上级平台用户名
4.6 809PassWord-809下级平台登录上级平台密码
4.7 PlatformNum-809下级平台登录上级平台平台接入码
4.8 DownIp-809下级平台发给上级平台用来建立从链路的IP地址（该程序没建立从链路）
4.9 DownPort-809下级平台发给上级平台用来建立从链路的IP端口（该程序没建立从链路）
4.10 ServerName-连接的注册服务名称（默认为dg1，带有MessageProcessService服务时该名称为dgp）
5.该服务功能需要打开注册服务的上传GPS开关
5.1 当ServerName为dg1时，开关位置为TransmitServer\MessagerServer\regsvr.ini->setting.UseUpServer改为1，重启MessagerServer服务
5.2 当ServerName为dgp时，开关位置为TransmitServer\MessageProcessService\MessageProcessService.json->use_up_server改为1，重启MessageProcessService服务</p></div></div><h1>12、拓展知识</h1><div style="margin-left:0px;"><h2>12.1、zabbix监控</h2><div style="margin-left:20px;"><h2>12.1.1、致命问题及快速恢复</h2><div style="margin-left:0px;"><h3>12.1.1.1、CB2致命监控</h3><div style="margin-left:30px;"><h1>CB2致命监控</h1>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>监控项</th>
<th>影响范围</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Ads服务状态异常</td>
<td>自动下载功能无法正常使用</td>
<td>基础监控</td>
</tr>
<tr>
<td>2</td>
<td>AlarmServer服务状态异常</td>
<td>客户端不产生报警，车辆的经纬度与时间不更新</td>
<td>基础监控</td>
</tr>
<tr>
<td>3</td>
<td>Apache2.2服务状态异常</td>
<td>运维平台无法同步CB2数据</td>
<td>基础监控</td>
</tr>
<tr>
<td>4</td>
<td>ARMSRestServer服务状态异常</td>
<td>无法查询车辆轨迹信息和操作日志等</td>
<td>业务监控</td>
</tr>
<tr>
<td>5</td>
<td>ARMSStorageServer服务状态异常</td>
<td>无法写入车辆轨迹信息和操作日志等</td>
<td>基础监控</td>
</tr>
<tr>
<td>6</td>
<td>ClientAccessService服务状态异常</td>
<td>无法登录客户端</td>
<td>基础监控</td>
</tr>
<tr>
<td>7</td>
<td>ClientBalance服务状态异常</td>
<td>无法登录客户端</td>
<td>基础监控</td>
</tr>
<tr>
<td>8</td>
<td>DVRGTService服务状态异常</td>
<td>无法查看实时视频</td>
<td>基础监控</td>
</tr>
<tr>
<td>9</td>
<td>DVRRTService服务状态异常</td>
<td>服务挂了无法自动拉起</td>
<td>基础监控</td>
</tr>
<tr>
<td>10</td>
<td>MessagerServer服务状态异常</td>
<td>车辆不在线</td>
<td>基础监控</td>
</tr>
<tr>
<td>11</td>
<td>MongoDB_3.2服务状态异常</td>
<td>无法写入/读取车辆轨迹信息和操作日志等</td>
<td>基础监控</td>
</tr>
<tr>
<td>12</td>
<td>MySql5.5服务状态异常</td>
<td>整个业务平台功能无法使用</td>
<td>基础监控</td>
</tr>
<tr>
<td>13</td>
<td>n9m_proxy服务状态异常</td>
<td>远程设置无法打开</td>
<td>基础监控</td>
</tr>
<tr>
<td>14</td>
<td>OnlineServer服务状态异常</td>
<td>车辆不在线</td>
<td>基础监控</td>
</tr>
<tr>
<td>15</td>
<td>Redis Service服务状态异常</td>
<td>车辆不在线，证据不写入证据中心等</td>
<td>基础监控</td>
</tr>
<tr>
<td>16</td>
<td>rm_media_service服务状态异常</td>
<td>web端视频无法查看</td>
<td>基础监控</td>
</tr>
<tr>
<td>17</td>
<td>WCMS5服务状态异常</td>
<td>12056web端无法打开</td>
<td>基础监控</td>
</tr>
<tr>
<td>18</td>
<td>WCMSWebCenterService服务状态异常</td>
<td>无法自动加车</td>
<td>基础监控</td>
</tr>
</tbody>
</table></div><h3>12.1.1.2、CB2应对措施</h3><div style="margin-left:30px;"><h1>应对措施</h1>
<table>
<thead><tr style='background-color: rgb(0, 136, 204); color: rgb(255, 255, 255);'>
<th>序号</th>
<th>告警信息</th>
<th>应对措施</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Ads服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>2</td>
<td>AlarmServer服务状态异常</td>
<td>重启该服务或检查mysql是否正常</td>
</tr>
<tr>
<td>3</td>
<td>Apache2.2服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>4</td>
<td>ARMSRestServer服务状态异常</td>
<td>检查mongodb和mysql是否正常</td>
</tr>
<tr>
<td>5</td>
<td>ARMSStorageServer服务状态异常</td>
<td>重启该服务或检查mongodb是否正常</td>
</tr>
<tr>
<td>6</td>
<td>ClientAccessService服务状态异常</td>
<td>重启该服务或检查mysql是否正常</td>
</tr>
<tr>
<td>7</td>
<td>ClientBalance服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>8</td>
<td>DVRGTService服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>9</td>
<td>DVRRTService服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>10</td>
<td>MessagerServer服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>11</td>
<td>MongoDB_3.2服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>12</td>
<td>MySql5.5服务状态异常</td>
<td>重启该服务或检查日志信息</td>
</tr>
<tr>
<td>13</td>
<td>n9m_proxy服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>14</td>
<td>OnlineServer服务状态异常</td>
<td>重启该服务或检查mysql是否正常</td>
</tr>
<tr>
<td>15</td>
<td>Redis Service服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>16</td>
<td>rm_media_service服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>17</td>
<td>WCMS5服务状态异常</td>
<td>重启该服务</td>
</tr>
<tr>
<td>18</td>
<td>WCMSWebCenteService服务状态异常</td>
<td>重启该服务</td>
</tr>
</tbody>
</table></div><h3>12.1.1.3、快速恢复</h3><div style="margin-left:30px;"><h1>快速恢复</h1>
<h4>windows如何重启服务</h4>
<p>打开任务管理器--服务--找到对应的服务，点击重启或者先停止再启动。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a3ae5a10bcb0414e5c932c2d12e96587" alt="" /></p>
<h4>服务启动失败通用解决方法</h4>
<p>参考此FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1333">http://jfwiki.streamax.com:7503/web/#/172/1333</a></p>
<h4>服务对应的端口列表</h4>
<p><a href="http://jfwiki.streamax.com:7503/web/#/172/1277">http://jfwiki.streamax.com:7503/web/#/172/1277</a></p>
<h4>1、ADS服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务</p>
<h4>2、AlarmServer服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ替换补丁：<a href="http://jfwiki.streamax.com:7503/web/#/172/1308">http://jfwiki.streamax.com:7503/web/#/172/1308</a></p>
<h4>3、Apache2.2服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ替重新安装apache：<a href="http://jfwiki.streamax.com:7503/web/#/172/1427">http://jfwiki.streamax.com:7503/web/#/172/1427</a></p>
<h4>4、ARMSRestServer服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/172/1340">http://jfwiki.streamax.com:7503/web/#/172/1340</a>
（4）检查mongodb是否启动，若未启动，参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/172/1337">http://jfwiki.streamax.com:7503/web/#/172/1337</a></p>
<h4>5、ARMSStorageServer服务状态异常</h4>
<p>同4</p>
<h4>6、ClientAccessService服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务</p>
<h4>7、ClientBalance服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务</p>
<h4>8、DVRGTService服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/172/1336">http://jfwiki.streamax.com:7503/web/#/172/1336</a></p>
<h4>9、DVRRTService服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务</p>
<h4>10、MessagerServer服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/172/1339">http://jfwiki.streamax.com:7503/web/#/172/1339</a></p>
<h4>11、MongoDB_3.2服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/172/1337">http://jfwiki.streamax.com:7503/web/#/172/1337</a></p>
<h4>12、MySql5.5服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/172/1341">http://jfwiki.streamax.com:7503/web/#/172/1341</a></p>
<h4>13、n9m_proxy服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务</p>
<h4>14、OnlineServer服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）检查mysql状态，以及mysql登录密码是否正常，参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/172/1341">http://jfwiki.streamax.com:7503/web/#/172/1341</a>
<a href="http://jfwiki.streamax.com:7503/web/#/172/1330">http://jfwiki.streamax.com:7503/web/#/172/1330</a></p>
<h4>15、Redis Service服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/172/1623">http://jfwiki.streamax.com:7503/web/#/172/1623</a></p>
<h4>16、rm_media_service服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/17/145">http://jfwiki.streamax.com:7503/web/#/17/145</a></p>
<h4>17、WCMS5服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务
（3）参考此FAQ解决：<a href="http://jfwiki.streamax.com:7503/web/#/172/1665">http://jfwiki.streamax.com:7503/web/#/172/1665</a>
（4）杀毒软件杀了nssm，将其还原后添加信任区，并在看门狗界面重装该服务。</p>
<h4>18、WCMSWebCenteService服务状态异常</h4>
<p>（1）参考服务启动失败通用解决方法
（2）重启该服务</p></div></div><h2>12.1.2、windows业务监控</h2><div style="margin-left:0px;"><h3>12.1.2.1、CB2业务监控部署文档</h3><div style="margin-left:30px;"><h1>CB2业务监控部署文档</h1>
<h2>1. 实现效果</h2>
<p>对CB2
业务数据：车辆在线数、在线率、在线总数，进行监控数据分析
服务数据：相关服务进程数；
功能数据：Evidenceupload即证据待分析数的统计；
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2462e9fa5c2586c9e7f8120852f3b246" alt="" /></p>
<h2>2. zabbix-agent及业务脚本部署</h2>
<p>agent部署参照：<a href="http://jfwiki.streamax.com:7503/web/#/52/2405">http://jfwiki.streamax.com:7503/web/#/52/2405</a>
业务脚本：<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=94a1c8088c1f41bc1a755e84e3b7a622" title="[CEIBAⅡ_zabbix3.0.zip">CEIBAⅡ_zabbix3.0.zip</a>
解压后将文件夹以及conf配置文件防止与<code>zabbix——agentd.d</code>路径下</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b3ee7404a9264faec444bff686a13a9d" alt="" /></p>
<h4>配置文件路径信息根据实际情况做修改</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=156e2ec657686548a91abc2a2b2159ff" alt="" />
并从任务管理器重启zabbix服务
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=ae66e72c02c5810d5362a34041671cf3" alt="" /></p>
<h2>3. web监控模板配置</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=41292324ea8b3590ee5bc7b47d9b4e9e" alt="" /></p>
<h2>4. 查看上报数据、</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2462e9fa5c2586c9e7f8120852f3b246" alt="" /></p></div></div></div><h2>12.2、CB2定制化打包</h2><div style="margin-left:20px;"><h3>12.2.1、客户端替换图片流程</h3><div style="margin-left:0px;"><h1>客户端替换图片流程</h1>
<p><a href="https://streamax-flie-1304261646.cos.ap-hongkong.myqcloud.com/STREAMAX/JFZJB/ywtools/CB2/CB2%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9A%E5%88%B6%E6%89%93%E5%8C%85/CEIBA2-LanguageTool%26logo-Tool-v6.zip" title="CEIBA2-LanguageTool&logo-Tool-v6.zip">CEIBA2-LanguageTool&logo-Tool-v6.zip</a></p>
<h3>1、 获取模版文件夹下的LoginTitle.png、startLogin.gif、logoButton.png、MainLogo.png、SvMain.ico模版文件，这些文件在CEIBA2客户端中对应关系如下：</h3>
<p>LoginTitle.png-登录页面logo，分辨率450*120,32位深，透明</p>
<p>startLogin.gif-加载页面和logo，分辨率450*317，8位深</p>
<p>logoButton.png-左上角logo，分辨率688<em>77，32位深，1</em>4</p>
<p>MainLogo.png-关于界面logo，分辨率91*38，32位深，透明</p>
<p>SvMain.ico-客户端快捷方式的桌面图标，分辨率128*128，32位深
示例：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b65d14bd76a9bea4fc5251fe5f4b2a5d" alt="" /></p>
<h3>2、 将LoginTitle.png、startLogin.gif、logoButton.png、MainLogo.png、SvMain.ico修改或重新制作成客户定制图片（尺寸、样式、名称和现有的保持一致）.  然后将新LoginTitle.png、startLogin.gif、logoButton.png、MainLogo.png图片拷贝覆盖到CEIBA2客户端安装目录的theme\sv文件夹下，示例：</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e24584d3edacfa7ceec2a0eea3e1d931" alt="" /></p>
<h3>3、 拷贝CEIBA2客户端安装目录下的CEIBA2.exe（可执行文件，各客户端名称可能不一样）文件，拷贝到桌面</h3>
<p>示例：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b701f833853178fa5ebd1ae2079af69c" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b1462c38df5e13b4f66b8a7c2b55afd2" alt="" /></p>
<h3>4、 启动resource_hacker\ResourceHacker.exe软件并打开拷贝出来的CEIBA2.exe文件，替换新制作的桌面图标SvMain.ico，示例：</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=645897b3558b54afac5f287da7a4438b" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f96d42f8d6deae896713054db396b83a" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6310a8e43325cf4ba8c6764e299c00c7" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=bc7387b63ab421e04a5cb642a69789f5" alt="" /></p>
<h3>5、 将新生成的CEIBA2.exe文件拷贝覆盖到客户端安装目录（原拷贝目录）下.</h3>
<h3>6、 安装Inno Setup软件（网上下载）</h3>
<h3>7、 将CEIBA2客户端安装目录整体拷贝到打包目录下的CEIBA文件夹（unins000.exe和unins000.dat除外）</h3>
<h3>8、 用Inno Setup软件打开CB2_2.6.3_STD_CN.iss（中文）或CB2_2.6.3_STD_EN.iss（英文）脚本文件，填入自定义信息，示例：</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=701bd870b45e0d0280231bf9c478da36" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=7024305ca9a76b6e3656c99f60d04228" alt="" /></p>
<h3>9、安装包路径</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=7ddbee42175e4ff5bdb456750c649e0f" alt="" /></p></div></div></div><h1>13、FAQ</h1><div style="margin-left:0px;"><h2>13.1、客户端--PC</h2><div style="margin-left:20px;"><h2>13.1.1、登录</h2><div style="margin-left:0px;"><h3>13.1.1.1、客户端登录失败</h3><div style="margin-left:30px;"><p>[toc]</p>
<h1>客户端登录失败</h1>
<h4>1、外网无法登录，内网可以正常登录</h4>
<h5>（1）服务器端口未做映射，需要映射的端口请参考以下链接的文档：</h5>
<p><a href="http://jfwiki.streamax.com:7503/web/#/172/1277">http://jfwiki.streamax.com:7503/web/#/172/1277</a></p>
<h5>在<font color=Red>非服务器主机</font>测试端口是否正常：</h5>
<p>如果检测端口有无法telnet的通的，请检查对应的服务是否正常，如果服务正常，但是telnet不通，请在<font color=Red>服务器</font>上检查端口的监听情况，将占用端口连接的进程杀掉以后，重启对应的服务；</p>
<table width='100%' class='codestyle'><pre><code>a.使用windows+R键打开运行窗口，输入cmd，进入cmdline。
b.输入以下内容，检查和登录有关的3个端口（7264/12020/12040）:

telnet 114.119.9.161（对应服务器的外网ip）12020</code></pre></table>
<p>7264：对应ClientBlance服务
12020：对应ClientAccess服务
12040：对应ARMSRestService服务</p>
<h5>出现连接失败即端口未映射或者服务器上无程序监听该端口。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7639228d3d14feb54759debbe4dfb368" alt="" /></p>
<h5>出现以下图片的黑色界面即端口映射，且服务器上有程序监听该端口。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/04bc864474b6b9c4dc8d4373bdf76129" alt="" /></p>
<h5>（2）配置填写错误</h5>
<p>打开CMS Server/TransmitServer/ConfigToolPro.exe，检查画红框的服务器外网ip是否填写的0.0.0.0，若不是，请将其修改为0.0.0.0，然后再点击最下面的修改配置。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/89145ae0cdb65f4168dc5cb299f40b7b" alt="" /></p>
<h5>（3）登录客户端的电脑网络异常</h5>
<p>打开IE浏览器检查是否可以正常访问百度。
如果不能正常访问，根据浏览器提示的信息进行修改即可。</p>
<h4>2、可以使用debugview抓取登录的打印信息，过滤内容选择Ceiba2程序的pid即可。</h4>
<p>参考Debug使用 <a href="http://jfwiki.streamax.com:7503/web/#/172/1291">http://jfwiki.streamax.com:7503/web/#/172/1291</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d73dd8e2d2b04768cc6f7bc595dd05f8" alt="" /></p>
<p>根据打印信息再排查错误。</p>
<h2>案例1</h2>
<h3>背景</h3>
<p>客户端、app均无法正常登录。
测试了7264、12020、12040、12056端口均是通的。</p>
<blockquote>
<p>注意：12056是APP登录会使用到的端口而非客户端。</p>
</blockquote>
<h3>排查过程</h3>
<p>（1）先打开CB2客户端，输入服务器的登录信息。<strong>先不要点击确定去登录！！！！</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cfdc6ff92b09737ee7fdbeb870501acf" alt="" /></p>
<p>（2）打开任务管理器--详细信息，找到Ceiba2.exe的PID，这里是15260.</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7c1572166a31f1e9529eba241def4ffb" alt="" /></p>
<p>（3）可以参考上面的第二步，debug使用的链接。
也可以按照如下操作操作步骤。</p>
<p>1）先下载debugview：<a href="http://jf.streamax.com:8081/f/33f883fe149a4ed8a7d8/?dl=1">http://jf.streamax.com:8081/f/33f883fe149a4ed8a7d8/?dl=1</a></p>
<p>2）<strong>请打开刚刚下载的debugview文件夹，右键选中Dbgview.exe，选中以管理员身份运行。</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fb3d87f1786912b3710b2dc101c54607" alt="" /></p>
<p>3）在include这里填入15260，然后点击ok
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/629876a74e750195912f3616141578a8" alt="" /></p>
<p>如果点开的dbgview.exe的时候没有该窗口提示，可以等进入页面的时候点击这个蓝色的图标，然后填写Ceiba2.exe的pid就可以。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b5640cb9cf078f1ab775b16bf4d6d857" alt="" /></p>
<p>4）<strong>进入debugview的页面后，点击Capture,将除了Log Boot以外的选项都勾上，如下图所示。</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7a42add7f64288484d5c5032949da1ba" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b61b0e4c66f12b6272d134a71e9ce9b1" alt="" /></p>
<p>（4）这个时候点击Ceiba2客户端的确定，即登录Ceiba2客户端。可以看到，当Ceiba2客户端开始登录的时候，bebugview的页面就会开始打印信息。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2473b2a0cfb7d539478e27dadede4b38" alt="" /></p>
<p>（5）根据打印的信息，可以发现这台服务器有很多端口修改过。那么与登录有关的7264、12020、12040这三个端口中，发现12040 不存在，而返回的是22040.</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/dc7c5d3c540d8d20556314f466bab252" alt="" /></p>
<p>但测试22040端口并不通，联系前面的12040端口是通的，怀疑客户是在configtool工具里将这个12040端口修改为了22040，但是实际还是开放的12040.</p>
<p>即外网的12040对应的内网的22040.</p>
<blockquote>
<p>注意：12040端口内外网必须一致，即内网使用的22040，外网也必须开放22040.（所以告诉Cb2需要开放的端口均开放的内外网一致就行）</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/17d0ab312d7373d2d954b00ddea7fa04" alt="" /></p>
<h3>解决方法</h3>
<p>（1）开放外网的22040端口</p>
<p>（2）将configtool里面的22040重新修改为12040，点击修改配置，重启所有服务。</p>
<h2>例2：</h2>
<p>服务器上的IE浏览器开启了脱机模式，恢复即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7dd16c6dd90134dc14ef433751790849" alt="" /></p>
<h2>例3：</h2>
<p>客户电脑无法登录客户端，其余电脑都可以正常登录客户端。</p>
<h3>排查过程</h3>
<p>（1）参考案例1的debug使用方法，获取Ceiba2.exe的打印信息。</p>
<p>（2）获取到打印后，发现连接12056返回key提示了网络问题。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c37a5bbf167acb0f609b5ee5d4c61f1d" alt="" /></p>
<p>（3）复制打印中的这个链接http://191.252.1.133:12056/api/v1/inner/key?username=admin&password=ospncdg2022%24&random=304446796&lang=English
在客户的电脑上打开浏览器请求，发现无法正常返回key。但在其余的电脑上都能返回key值。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9ecf4ed976ec07060640ed0c77f59808" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0294193c6fe8255cefcdba1a5d4273c9" alt="" /></p>
<p>（4）根据返回的提示，在客户电脑上找到了Bitdefender的软件，应该就是这个软件阻止了请求的链接返回。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b327fd1e5737fc766023eb8a54636c1f" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a8db7a62dd4c77a5cad9496a9ceb45bf" alt="" /></p>
<p>（5）客户卸载了该软件后，登录一切正常。</p></div><h3>13.1.1.2、客户端登陆提示load错误</h3><div style="margin-left:30px;"><h1>备注</h1>
<p>提示   load libProviderRmCMS.dvrplus fail!</p>
<h1>原因</h1>
<p>使用了盗版系统导致</p>
<h1>解决方法</h1>
<p>装正版windows系统或者根据实际情况出补丁或者直接升级客户端最新版本试试。</p></div><h3>13.1.1.3、客户端登录界面显示问号</h3><div style="margin-left:30px;"><h1>客户端登录界面显示问号</h1>
<h2>现象</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/23915d8f03dac599247a724642339283" alt="" /></p>
<h2>问题原因</h2>
<p>客户端语言包问题</p>
<h2>解决方法</h2>
<p>（1）打开控制面板</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/249bf65cbad88e8856aded96706ab3da" alt="" /></p>
<p>（2）查找区域并打开</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/35922e02e7e6e972b3fa787b1f42f964" alt="" /></p>
<p>（3）如果是英文，改成简体中文，重启电脑生效</p>
<p>如果本来就是中文，可以先改成英文，点击保存，重启电脑
然后再改成简体中文，点击保存，观察是否恢复，如果不行再重启下电脑</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d0bc5751003250abe5553c6c415ec0a8" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/48fed179a095ab7e1aa774b5bd7347d2" alt="" /></p></div></div><h2>13.1.2、实时视频</h2><div style="margin-left:0px;"><h3>13.1.2.1、实时视频无法查看</h3><div style="margin-left:30px;"><h1>实时视频无法查看</h1>
<h5>1、    检查DVRGTService服务是否正常启动。</h5>
<p>如果未正常启动，可以替换今年的授权文件尝试解决。</p>
<h5>2、    检查17891、12092、12091三个端口是否正常监听和映射，如果正常请重启一下DVRGTService服务。</h5>
<p>参考以下faq测试端口监听：<a href="http://jfwiki.streamax.com:7503/web/#/172/1301">http://jfwiki.streamax.com:7503/web/#/172/1301</a></p>
<h5>3、    服务器端的配置流媒体IP是否填写为外网IP，具体情况可查看以下文档中的第二点配置错误进行解决。</h5>
<p><a href="http://jfwiki.streamax.com:7503/web/#/172/1293">http://jfwiki.streamax.com:7503/web/#/172/1293</a></p>
<h5>4、设备使用VPN或者内网上报</h5>
<blockquote>
<p>如何判断设备是使用VPN或者内网上报？
首先查看数据库里面的Vehicledevice表中的RegisterIP和TransmitIP是不是内网IP，总之不是外网IP。
再查看双击MessagerServer打开可以查看设备上报的IP是不是VPNIP。</p>
</blockquote>
<p>例如下面这个服务器：</p>
<p>内网IP为172.16.1.200,设备上报的IP均为10.40（双击MessagerServer打开可以查看设备上报的IP）</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f87e23dfa6b24808b70bd21987fe7e34" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/683f6bb1c64bbc6b54dd643119ddd70a" alt="" /></p>
<h5>解决办法如下:</h5>
<h5>针对N9M设备：</h5>
<p>（1）下载内外网补丁：<a href="http://jf.streamax.com:8081/f/7335f09dfc3746c3b976/?dl=1">http://jf.streamax.com:8081/f/7335f09dfc3746c3b976/?dl=1</a></p>
<p>（2）备份服务器上E:\Program Files (x86)\CMS Server\TransmitServer\MessagerServer整个文件夹，</p>
<p>备份服务器上E:\Program Files (x86)\CMS Server\TransmitServer\dvrplus整个文件夹。</p>
<p>（3）停止DVRGTService和MessagerService两个服务。</p>
<p>（4）将内外网补丁里面2.2.2及以后版本文件夹下（根据具体版情况）的dvrplus/providerrmdvr/下的两个文件替换进服务器里面的\CMS Server\TransmitServer\dvrplus\providerrmdvr文件夹内。</p>
<p>将内外网补丁里面的2.2.2及以后版本文件夹下（根据具体版本情况）的MessagerServer下的reg.dll拷贝进CMS Server\TransmitServer\MessagerServer文件夹内。</p>
<p>（5）修改E:\Program Files (x86)\CMS Server\TransmitServer\dvrplus\providerrmdvr\init.ini的配置。</p>
<p>新增属性LanIP，值为服务器的内网IP。</p>
<table width='100%' class='codestyle'><pre><code>[LocalRouterAddr]
ip=外网ip
LanIP=内网IP</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7dc188cff391717f7fbd5c9231f5ae3a" alt="" /></p>
<p>（6）修改E:\Program Files (x86)\CMS Server\TransmitServer\MessagerServer的配置，增加一条VpnIp的属性，值为刚刚打开MessagerServerLogView看到的设备上报IP的前两位，比如这里是10.40，那VpnIp=10.40</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/13b96882f6674ed5a49802494a1a2021" alt="" /></p>
<p>（7）以上步骤修改完以后，重启DVRGTService和MessagerServer。</p>
<h5>针对MDVR设备（需先将N9M设备方法先操作完）：</h5>
<p>例如下面这个服务器：</p>
<p>内网IP为192.168.0.248，打开设备设置（mdvr设备设置密码为8个8）
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e5a671f848299993fce2c63c652bd42b" alt="" /></p>
<p>可以查看到设置设备上报的网关是10.10.0.2，客户反馈的数据转发ip是10.10.0.5</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5762d7ca050b0e6b29795d4c38c17da3" alt="" /></p>
<p>进入CMS Server\TransmitServer\dvrplus\providerrmmpeg4文件夹（该文件是针对mdvr设备的配置）</p>
<p>打开init文件，将IP由内网IP修改为10.10.0.5。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1e799243d715bda39b77ebe7c376675a" alt="" /></p>
<p>如果由最老版本的CMS 升级到现在的2.6.3版本，端口需要从12091改为7263.</p>
<p>然后重启DVRGTService即可。</p>
<h2>例2：</h2>
<p>新服务器安装CMS Server，还原数据后，无法查看实时视频</p>
<p>（1）首先检测端口是否正常映射，通过客户端右上角设置--服务器测试，发现端口都是连接成功。使用telnet测试，检测发现端口通，但部分端口没有在内网服务器上建立连接，比如7264、12092，且服务器停止了7264以后，外网仍可以登录。且使用外网登录客户端时，发现服务器版本为2.6.2.0.33，使用内网登录时发现服务器版本为2.6.3.0.63，判断内网与外网登录进客户端的是两台服务器，即部分端口映射存在问题。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7da57df3640a8d2eeaf231f4c5fd8742" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b51460d20cacfc7987eea52f3770dee8" alt="" /></p>
<p>（2）将上述信息反馈至客户后，客户修改了映射，再次登录客户端验证7264端口正常。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/be698c282b8e8c1eb049cc350a2d459c" alt="" /></p>
<p>（3）使用deugview抓取客户端打印信息，发现点开实时视频时，该车辆的设备类型为123，123对应的类型是其它，所以导致无法查看实时视频，另外发现所有车辆由于数据迁移的关系数据里的转发ip都是之前旧服务器的ip。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6d7a7401d45b69ec68a30af473338209" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b4a1ed9e0069b158122c99598c2cce90" alt="" /></p>
<p>（4）连接CB2数据库，点击查询--新建查询，</p>
<p>update devicefile set LinkType = 124 where LinkType =123;</p>
<p>update vehicledevice set RegistIP ="对应的外网IP";</p>
<p>update vehicledevice set TransIP = "对应的外网IP";</p>
<p>（5）更新完毕后，再次登录CB2客户端，查看实时视频正常。</p>
<h2>例3</h2>
<h3>背景：</h3>
<p>服务器版本为2.6.4以上，客户端版本未使用2.6.4以上的版本</p>
<h3>解决方法：</h3>
<p>目前服务器2.6.4以上的版本，客户端必须使用2.6.4以上的版本才可以正常查看实时视频。</p></div><h3>13.1.2.2、实时视频花屏</h3><div style="margin-left:30px;"><h1>客户端查看实时视频花屏</h1>
<p>1）  打开对应计算机上CEIBA的安装目录（可以在桌面上找到CEIBA—右键点击打开文件位置即可），找到set.ini，双击编辑该文件，将drawmode的值改为0，重新启动客户端即可。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ae3f331ef2160ae285c26bee65b507b4" alt="" /></p></div><h3>13.1.2.3、实时/直通视频无法观看【初步检查】</h3><div style="margin-left:30px;"><h2>1. 服务器端口测试</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=544d3a48caee6cc5167c459bce9f47fd" alt="" /></p>
<h2>2. 检查看门狗页面服务状态</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=a96a9c1ff96ed433dc800aebeceb97f5" alt="" /></p>
<h3>情况说明：如果服务状态都正常，端口测试均没有问题，CB2客户端上报警证据等业务正常，设备回放正常，一切都表现得正常，唯独实时/直通视频看不了，一直加载转圈圈；</h3>
<h3>检查ConfigTool中填写的ip与服务器外网ip是否一致</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=31e0d1ad703a324c33b307ce22fd4046" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e308f138f94f57cac624e5a8d6abcd71" alt="" /></p>
<h3>外网ip查看：<code>curl ip.me</code></h3>
<blockquote>
<p>windows与linux通用</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=9f18457215cbd633eceb7c806ef4f452" alt="" /></p></div><h3>13.1.2.4、客户端某通道实时视频加载</h3><div style="margin-left:30px;"><h1>客户端某通道实时视频加载</h1>
<h3>问题背景：</h3>
<p>客户端上观看直通视频某通道处于一直加载的状态，但是Web以及App能正常观察通道直通，客户端设备回放中也能正常查阅该通道视频；</p>
<table width='100%' class='codestyle'><pre><code>Web</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=23fcd1077d52f2720ab77077a91ca8cf" alt="" /></p>
<table width='100%' class='codestyle'><pre><code>客户端</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=4c2e0065b3e344af350b41c293fa4cc0" alt="" /></p>
<h3>排查过程：</h3>
<p>Web页面打开设备通道编辑，发现出问题的通道命名结尾有很多空格，删除末尾空格并保存后客户端通道直通恢复正常；</p>
<blockquote>
<p>客户端需重新登录，发现闪退请重新安装服务器对应客户端</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6c111abbf92e4b4eb5dc51fac732d596" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=78fd46cca61c0df21a0cd74b9e8c4f46" alt="" /></p></div><h3>13.1.2.5、mdvr无法打开视频</h3><div style="margin-left:30px;"><h1>一、背景</h1>
<p>客户从老版本升级到263090版本后无法打开MDVR设备的直通视频；</p>
<h1>二、临时解决方法</h1>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=3c97c812672f9c45b91372d0645f0710" title="[providerrmmpeg4.zip">providerrmmpeg4.zip</a></p>
<p>1）找一台能够打开mdvr设备直通视频的服务器，复制他的~\CMS Server\TransmitServer\dvrplus\providerrmmpeg4文件夹；或者使用本文档提供的文件夹也可；</p>
<p>2）停止守护进程和视频转发服务；</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2789fa374723de02270514e220a5bbe4" alt="" /></p>
<p>3）备份服务器上面的~\CMS Server\TransmitServer\dvrplus\providerrmmpeg4文件夹；</p>
<p>4）拷贝步骤一的文件夹至服务器对应位置，并参照备份的providerrmmpeg4文件夹进行修改init.ini文件；</p>
<p>5）启动步骤2挺停止的守护进程和视频转发服务；</p>
<h1>三、彻底解决方法</h1>
<p>待补充，夏老师和召哥暂未发现原因；</p></div></div><h2>13.1.3、设备回放</h2><div style="margin-left:0px;"><h3>13.1.3.1、客户端回放无法查看</h3><div style="margin-left:30px;"><h1>回放无法查看</h1>
<h3>一、参数或硬盘本身的问题</h3>
<h5>1、设备的媒体服务器地址填写错误或者未填，比如实际为外网，但填写成了内网，可以修改媒体服务器地址点击保存后，重新登录客户端再尝试查看回放。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6ada27c185ad971e79d8dc0f775036f8" alt="" /></p>
<h5>2、设备的媒体服务器端口填写错误或者未填写，跟第一种错误类似，修改为正确的端口后，重新登录客户端再查看即可。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2a8195a7af4486f079e1ec780214811d" alt="" /></p>
<h5>3、设备硬盘异常，需要更换硬盘。</h5></div><h3>13.1.3.2、回放无法下载</h3><div style="margin-left:30px;"><h1>回放无法下载</h1>
<h3>一、设备硬盘异常，需要更换硬盘。</h3>
<h3>二、车牌号超过了16个字符的限制</h3>
<p>车牌号限制16个字符，小于等于16个字符都可以正常下载。
如下所示：
鲁HG7706邹城-临沂 下载录像失败 原因是车牌号有17个字符
改成鲁HG7706邹城临沂后可以正常下载。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/95f8e4599cee366a9a2015e08b6cd8f0" alt="" /></p>
<h3>三、车牌号含有非法字符限制</h3>
<p>车牌号限制，采用非法字符导致设备回放上传服务区失败。
如下所示：
修改车牌号的引号后可以正常下载。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=042a2df16065a1d31c05d15d259c15ea" alt="" /></p></div><h3>13.1.3.3、Admin账户没有权限看回放</h3><div style="margin-left:30px;"><h1>Admin账户没有权限看回放</h1>
<h3>问题背景：</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=19d80546bad39444cdade63ab725ff43" alt="" /></p>
<h3>解决手段：</h3>
<p>连接数据库执行：</p>
<table width='100%' class='codestyle'><pre><code>insert into commandinfo(code) select '308-ag' from DUAL where not exists(select code from commandinfo where code='308-ag');
insert into commandpower(roleid,ccode) select 1,'308-ag' from DUAL where not exists(select ccode from commandpower where ccode='308-ag' and roleid=1);
insert into moduleinfo(code) select '308' from DUAL where not exists(select code from moduleinfo where code = '308');
insert into modulepower(roleid,mcode) select 1,'308' from DUAL where not exists(select mcode from modulepower where mcode = '308' and roleid=1);</code></pre></table></div></div><h2>13.1.4、证据中心</h2><div style="margin-left:0px;"><h3>13.1.4.1、触发告警较多但证据存在漏传</h3><div style="margin-left:30px;"><h1>触发告警较多，但证据存在漏传</h1>
<h2>1、问题背景</h2>
<h4>该设备一共配置了以下四种报警证据上传的策略。</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1ec42509c29115ef6919753a0df86300" alt="" /></p>
<h4>9月8日触发的行人检测告警如下所示。</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c7a2b8299e476490a97fc83411d5160c" alt="" /></p>
<h4>证据中心只有一部分行人检测的证据，11：51触发的报警证据与12：53触发的报警证据都不曾上传。</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b58e135a518b98e67c3cc996d5ed5a47" alt="" /></p>
<h2>2、排查过程与解决方法</h2>
<h4>（1）连接redis数据库</h4>
<p>参考FAQ链接：<a href="http://jfwiki.streamax.com:7503/web/#/17/879">http://jfwiki.streamax.com:7503/web/#/17/879</a></p>
<h4>（2）打开db0，根据实际情况找到对应车辆的证据任务，一般命名为设备芯片号_ev_task.</h4>
<blockquote>
<p>此处我们找的是008802D72D的证据任务，双击008802D72D_ev_task,可以看到size为1268，证明有1268条证据还未补传完毕。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e30a0bb3d5cad6e7ba10227f8b63fda1" alt="" /></p>
<h4>（3）还是db0数据库，找到需要查询的车辆，比如这里是008802D72D，双击打开查看ev字段值。</h4>
<blockquote>
<p>这里看到ev字段值为V1.1：表示根据平台之类上传证据的N9M1.0设备。
另外还有V1.0：表示主动上传的N9M1.0设备。
V2.0：对应N9M2.0设备</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ad951631dc91958d05b445287de92c91" alt="" /></p>
<h4>（4）通过以上几步的排查，发现是证据任务存在积压，连接mongodb数据库</h4>
<p>参考以下链接连接mongodb：<a href="http://jfwiki.streamax.com:7503/web/#/17/880">http://jfwiki.streamax.com:7503/web/#/17/880</a></p>
<blockquote>
<p>发现任务都存在，是补传上来的报警产生的任务，所以会出现中间报警证据没上来，后来的报警证据上来的情况，平台会优先下发最新的证据任务。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b49576c9befaec817257dd89e0314f77" alt="" /></p>
</blockquote>
<h4>（5）根据实际情况，修改了证据上传时间。</h4>
<blockquote>
<p>当前服务器总车辆较少，且在线车辆只有30多台，经过沟通，将证据上传的间隔改为了20s，默认为15分钟。</p>
</blockquote>
<p>打开CMS Server/TransmistServer/EvidenceReportService的EvidenceReportService.ini,将RepeatSendTaskTime的值改为20，然后重启EvidenceReportService服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b3773130314b321fe55247b39ffb541d" alt="" /></p>
<h4>（6）设备在线后就会快速补传</h4>
<blockquote>
<p>大概等待了一天后，证据都已经补传完了，查看证据中心已经有了之前未传的证据。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/960de487061fe1a09df7bddc14ad9110" alt="" /></p></div><h3>13.1.4.2、打开证据中心提示服务器错误</h3><div style="margin-left:30px;"><h1>打开证据中心提示Server Error</h1>
<h2>一、现象</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cfaa1af65687dffc5e4d7c0a7412451c" alt="" /></p>
<h2>二、排查过程与解决方法</h2>
<h3>（1）查看日志</h3>
<p>进入服务器，查看CMS Server/WCMS5/root/logs/app.log.</p>
<p>发现提示连接12047失败，12047对应的是HTTPSDKService。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/14a43ad1c0e6e232d7bf5a893f649d91" alt="" /></p>
<h3>（2）根据日志进行解决</h3>
<p>上一步排查出来是HTTPSDKService服务的问题，重启该服务，再次进入证据中心，等待一段时间后恢复正常。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8884cddc2f6359f638f3a58ef1f74cba" alt="" /></p></div><h3>13.1.4.3、服务器有证据文件，但证据中心未更新</h3><div style="margin-left:30px;"><h1>服务器有证据文件，但证据中心未更新</h1>
<h2>一、现象：</h2>
<p>打开证据中心，某一天以后，不再有证据的记录。</p>
<h2>二、排查与解决方法</h2>
<blockquote>
<p>遇到此类情况即有可能是证据转mp4的时候卡住了，导致证据未更新</p>
</blockquote>
<h3>（1）寻找卡住的证据文件</h3>
<p>通过文件:</p>
<p>进入服务器CMS Server\TransmitServer\EvidenceAnalyService\,找到EvidenceAnalyService.data，以记事本的方式打开，可以看到卡住的那条证据。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/684d9ab558aca3d41dcb49e4064d11ff" alt="" /></p>
<p>通过日志：</p>
<p>进入服务器CMS Server\TransmitServer\EvidenceAnalyService\EvidenceAnalyService下，查看最新打印的日志信息，如果没有特别明显的日志，可以先重启EvidenceAnalyService服务，然后再到这个目录下查看相关日志。</p>
<blockquote>
<p>查看最新的日志发现就是卡在了画红框的这条证据这里。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/197ced353315a835d9aadb3b96016f10" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5169fa9afecf21175a48681cbdf01812" alt="" /></p>
<blockquote>
<p><strong>部分日志还会提示Mysql数据库的问题，提示这种信息或者告诉你mysql中的evidence_data需要修复，请使用一下navicat工具连接mysql数据库，然后找到evidence_data表，右键点击，选择--维护--修复表--快速即可。</strong></p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/57bd3d4cba6d238ed8923f12a0b66a76" alt="" /></p>
<h3>（2）删除卡住的证据文件夹</h3>
<p>进入服务器存放证据的目录，找到上一步日志提示的那个文件夹，点击进去后发现该条证据未成功转为mp4，该文件夹之前的均转成功了。</p>
<p>可以把该文件夹拷贝回来，让研发分析卡住的原因。
然后停止EvidenceAnalyService服务或者直接结束EvidenceAnalyService.exe的进程，再把文件夹删除掉，因为这个文件夹一直在被EvidenceAnalyService使用。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ec67804fef20959b6c3a8bea2145b5df" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6a788a8d6d31bd9c95dd8cf63c75f268" alt="" /></p>
<h2>三、替换文件</h2>
<blockquote>
<p>若删除该卡住的证据文件夹无用，将最新版本的证据分析服务下的avapi.dll拷贝到自己的服务器替换即可，注意替换之前记得备份。</p>
</blockquote>
<p>看门狗停止证据分析服务，解压下列补丁替换到文件夹下
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2bad6cbb93db041986d0943adc490409" alt="" />
最新版本黑匣子补丁：<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=c591b42f3fee2c3f54ef625ac18e3563" title="[AnalysisN9MBlackBox.zip">AnalysisN9MBlackBox.zip</a></p></div><h3>13.1.4.4、邮箱推送的链接可以打开证据，但证据中心无法查询</h3><div style="margin-left:30px;"><h1>邮箱推送的链接可以打开证据，但证据中心无法查询</h1>
<h2>问题原因</h2>
<p>（1）mongodb里的evidence分表，查询对应证据id的记录的evidencestatus字段
值为4，为4表示下载完成，为0才表示分析完成。</p>
<p>（2）出现这种情况的原因是因为证据上传完成后，会在通知策略服务证据下载完
成的同时通知分析服务分析。分析操作和修改证据状态为下载完成两个操作是异步的，
可能会出现证据已分析完成但是策略服务还未来得及将状态改为下载完成的情况。
解决方案：出策略服务补丁包，让策略服务在证据下载完成入库前先判断证据的状态，
如果为0，则不修改证据状态。</p>
<h2>排查方法</h2>
<h3>（1）进入mongodb数据库</h3>
<p>参考以下链接的文档进入mongodb：<a href="http://jfwiki.streamax.com:7503/web/#/172/1289">http://jfwiki.streamax.com:7503/web/#/172/1289</a></p>
<h3>（2）查询相关数据</h3>
<p>先点击constabulary数据库，点开Collections即可看到evidence相关的数据。点开当前月的evidence，然后再顶上查询，可以查通过查证据ID查到相关数据。</p>
<blockquote>
<p>发现evidencestatus字段的值为4，为4是下载完成，为0才是分析完成，该状态需要为0才会在证据中心显示。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cff52bd6ce382f92b83c270d5791c806" alt="" /></p></div><h3>13.1.4.5、证据点开的通道顺序与实时视频顺序不一致</h3><div style="margin-left:30px;"><h1>证据点开的通道顺序与实时视频顺序不一致</h1>
<h2>一、现象</h2>
<p>直通：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5a452f33b1276cfe258d610aa91efebb" alt="" /></p>
<p>证据链接：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/aef42f52818cc391b79c5cf009bd78e1" alt="" /></p>
<h2>二、排查方法</h2>
<h3>1、查看报警配置</h3>
<p>发现报警配置里并不存在这个harsh braking，理论上属于acc配置，但是acc的证据只配置了两个通道，实际证据有4个通道。</p>
<blockquote>
<p>还可能存在之前设置的4个通道，但后面重新设置了2个通道，但策略下发是需要事件，在新策略还未生效的时候，触发了报警上传上传了证据，但这个时候还是上传了4个通道。</p>
</blockquote>
<p>针对上述情况，查了这个车过往的证据记录，发现其余都能对的上通道和证据名字，只有这条harsh braking 是属于4通道。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6df97408c93f950d7666231b4dd69844" alt="" /></p>
<h3>2、数据库查询该证据的明细</h3>
<p>参考以下文档链接mongodb：<a href="http://jfwiki.streamax.com:7503/web/#/17/880">http://jfwiki.streamax.com:7503/web/#/17/880</a></p>
<p>打开constabulary数据库里面，点开Collections，然后找到当前月的表，比如evidence_202109，输入证据id，点击左上角的绿色小三角执行，查询到证据的相关信息。</p>
<blockquote>
<p>这里alarmtype的字段的值为0，表示手动剪辑上传，不属于报警配置里面的acc alarm，所以看到的会有所差异。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/209e241b8a57a20ee8978beb708fcc71" alt="" /></p></div><h3>13.1.4.6、设备从某个日期后无证据文件</h3><div style="margin-left:30px;"><h1>10月17日后在证据中心无证据，但服务器本地证据文件夹10月19日的证据文件都正常转码</h1>
<h2>一、现象</h2>
<p>客户端：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f67e67b5047a6d8abe56ee534a6a8e1b" alt="" /></p>
<p>服务器本地：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5d37c107ce5c1984a44615778e4606da" alt="" /></p>
<h2>二、排查过程与解决方法</h2>
<p>通过客户端证据到10月17日，服务器端19日的证据都转码正常，且该服务器版本为2.6.3.0.45，怀疑可能是eid重复导致。</p>
<p>检查Mysql数据库里面的evidence_data表的引擎是否为innodb。</p>
<p>（1）连接数据库，参考faq：<a href="http://jfwiki.streamax.com:7503/web/#/17/96">http://jfwiki.streamax.com:7503/web/#/17/96</a> 方法二</p>
<p>（2）点击wcms4，展开表，找到evidence_data表，右键点击，选择设计表，点击选项，可以查看到该表对应的引擎。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1f1264d5c5f05da6b49c72262a97d669" alt="" /></p>
<p><strong>通过这里可以查看到该表的引擎为InnoDB，即表示eid重复，需要进行以下操作来修改。</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9f340063c01be59a1291a147b66579e4" alt="" /></p>
<p>（3）依次执行以下sql语句，点击查询--新建查询</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">alter table evidence_file drop foreign key FK_Evidence_Data_ID;
alter table evidence_log drop foreign key FK_Evidence_Log_ID;
alter table evidence_data ENGINE = MyIsam;</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/37ca701c17df726c6e516b053f8c8995" alt="" /></p>
<blockquote>
<p>注：第一条和第二条语句执行失败可以略过，但需要保证第三条sql执行成功。</p>
</blockquote>
<p>(4)设置evidence_data表的自增id，须保证其大于当前最大的证据eid（比如已知最大eid的值为15w，可以设置自增id为100w）。</p>
<p>点击右键evidence_data，点击设计表，点击选项，将自动递增的值改为1000000，然后点击左上角的保存。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8cc8eafd3f507e1bfb34e35d40e5c111" alt="" /></p>
<p>（5）重启mysql服务，检查evidence_data表里的数据库引擎和自增id是否修改成功，以及观察客户端证据中心的证据是否刷新。</p></div><h3>13.1.4.7、查看当前还有多少证据未转码</h3><div style="margin-left:30px;"><h1>查看当前还有多少证据未转码</h1>
<h2>1、使用redis工具连接redis数据库</h2>
<p>参考以下FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1288">http://jfwiki.streamax.com:7503/web/#/172/1288</a></p>
<h2>2、找到数据库</h2>
<p>首先双击db0，展开。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/88f938e363c6815e9455dd3be6ab5203" alt="" /></p>
<p>拉到db0的最后，找到uploadevidence，双击打开。</p>
<p>右上角的size为还未转码的证据数量。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6c94c73951021b9330c3a7100334d32c" alt="" /></p></div><h3>13.1.4.8、查看当前转码的证据</h3><div style="margin-left:30px;"><h1>查看当前转码的证据</h1>
<p>进入服务器CMS Server\TransmitServer\EvidenceAnalyService\,找到EvidenceAnalyService.data，以记事本的方式打开，可以看到当前转码的那条证据。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c2bc67550b6e9faca117a8b8f691d93b" alt="" /></p></div><h3>13.1.4.9、设备部分报警的证据未上传</h3><div style="margin-left:30px;"><h1>设备部分报警的证据未上传</h1>
<h2>排查方法</h2>
<h3>1、先确认某一台设备的某一条报警需要上传证据，但是没上传，建议在web端寻找</h3>
<blockquote>
<p>针对海外有时差的情况下，web端的证据是与海外服务器同步的，客户端查询出来的时间会转换为当前你所在地区的时间，比如在中国，则会转换为东八区的时间</p>
</blockquote>
<p>确定的设备为0099023049 报警则为服务器当前时区的2月14日20:08:33</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5be68ed66994b591eb084c936f452039" alt="" /></p>
<h3>2、在mongodb数据库里面查找该条报警</h3>
<p>首先参考以下链接连接mongodb数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1289">http://jfwiki.streamax.com:7503/web/#/172/1289</a></p>
<p>连接成功后，展开alarmreal，展开Collections，找到当月对应的报警表，比如现在是2022年2月，双击alarm_202202展开这张表。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a71f3d19536407d040d47800f49476d2" alt="" /></p>
<p>展开后开始查询以设备芯片号开始查询
在find的括号里面输入'tid':'你想要查询的芯片号'，点击左上角的绿色三角形进行查询。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3aeb71abc963a4fc8dc1fab3668fa0f1" alt="" /></p>
<blockquote>
<p>注意：报警存储的时间都是按照零时区来存储的，如果服务器的时区与零时区有时差，请把第1步里面查找到的报警时间转换为0时区的时间。</p>
</blockquote>
<h3>3、查看同一台车证据上传间隔时间</h3>
<p>间隔时间是否为15分钟；</p>
<h3>4、案例</h3>
<p>案例1）没有产生证据，所有的设备，大约有40%的报警都没有产生报警，在警报统计中，有报警记录，但是相应的证据并没有上传到证据中心，大概300条报警，只有96条有证据视频记录。</p>
<p>案例2）客户服务器证据存在一些漏传，总共应该有243个报警证据的但是却只上传了92个证据视频。 CEIBA2的客户端和网页版发现都收到8/16日的报警记录。然后8/16之后同一台设备的其他日期的证据视频他们都有正常上传。 就是缺了8/16那一天的部分证据视频。</p>
<h3>5、结论</h3>
<p>1）设备不支持证据短连接，导致相邻两条证据的上传间隔>=15mins，一天最多能传60x24/15 = 96条。而设备一天上传的配置了证据策略的报警远大于96，大概是300一天，造成了证据任务积压。同时设备只能保存两天的录像，两天过去后，很多积压证据会因为没有录像而“丢掉”。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f5d3e75923b20dc0b84cc8a9bf1a637c" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=47f404499ebc06ff5bb058c9302f0ee9" alt="" />
关于证据短连接：
为了优化证据并发上传的性能，我们的证据接收服务会在设备上传完一条证据后断开与设备的连接，并从证据队列中下发另一条证据任务给设备。设备收到任务后，应该重新建立与证据接收服务的连接并上传证据。
但是不支持这个逻辑的设备，在收到一条新任务时，未判断连接的有效性，继续使用之前那条被平台终止过的连接，管道破裂，证据任务就丢失了。直到平台第二次下发这个任务时，才重新建立新连接上传证据。
平台重复下发当前正在执行但未完成任务的间隔是15分钟，所以这也是为什么设备相邻两条证据上来的时间为15分钟。</p>
<h4>解决方案：</h4>
<p>1、平台将重复下发任务间隔的时间改小
2、设备支持短连接
注：方案1不是根本解决方案，只能临时解决，要根本解决还是得设备支持短连接。</p>
<h4>平台将重复下发任务间隔的时间改小</h4>
<p>打开<code>CMS Server/TransmistServer/EvidenceReportService</code>目录下的<code>EvidenceReportService.ini</code>,将<code>RepeatSendTaskTime</code>的值修改，然后重启<code>EvidenceReportService</code>服务。</p>
<p>该字段<code>RepeatSendTaskTime      = 900</code>单位为秒，具体修改数值请按照研发建议；</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=3f317522590da03e184ed9a3aa472ae3" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=fea4b96ccc7f7132c3178ac5a8db49f5" alt="" /></p></div><h3>13.1.4.10、更改证据文件路径</h3><div style="margin-left:30px;"><h1>更改证据文件路径</h1>
<h2>操作方法</h2>
<p>（1）进入服务器CMS Server\TransmitServer\config，打开文件EvidenceConfig.json</p>
<p>把C改成其余的盘符，然后点击保存</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/61f81dc832f735e0dccccff6d7475c94" alt="" /></p>
<p>（2）重启证据相关的服务，Evidence开头的服务均需要重启。</p>
<blockquote>
<p>注意：修改以后仅仅只针对于以后产生的证据有效，之前的证据该放在哪里还是放在哪里，证据存放路径是入了数据库的，所以之前的证据如果你挪到了别的盘，仍然也无法读取，请不要动之前的证据。</p>
</blockquote></div><h3>13.1.4.11、将今天之前的证据停止转码</h3><div style="margin-left:30px;"><h1>将今天之前的证据停止转码</h1>
<h2>1、使用redis工具连接redis数据库</h2>
<p>参考以下FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1288">http://jfwiki.streamax.com:7503/web/#/172/1288</a></p>
<h2>2、找到数据库</h2>
<p>首先双击db0，展开。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/88f938e363c6815e9455dd3be6ab5203" alt="" /></p>
<p>拉到db0的最后，找到uploadevidence，双击。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=3a3e93e41560cc53d2a8a0040ce95966" alt="" /></p>
<p>重命名uploadevidence_bak，点击rename。</p>
<p>等待生成另外一个uploadevidence即可。</p>
<p>如果不想备份，也可以选中uploadevidence，右键点击remove key即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=24f989a32031791abaeee9423b36cb02" alt="" /></p></div><h3>13.1.4.12、证据中心的视频标题和内容不一致</h3><div style="margin-left:30px;"><h1>1.问题背景</h1>
<p><code>该问题为老版本的问题，2.6.3.0.55以后的版本没有该问题</code>
客户服务器的证据中心部分证据，打开后内容不匹配，例如下图中，证据中心中最新的两条证据
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=724862f176eefa4cef158d5139825ba9" alt="" />
从标题上来看，这两条证据分别来自KX15NEO_C6D和AY17SXX_DL1，时间为5月12日，但实际预览证据视频时，看到的内容如下：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=eee5cdbaa7b7b16a863f862dee1e492d" alt="" />
打开后，实际显示的证据视频来自另外一个车辆，并且证据的时间为7月4日，此车辆并不属于这个用户下的任何车组，看起来证据中心的证据视频匹配出现问题，需要平台部协助进行排查。</p>
<h1>2.排查过程与解决方法</h1>
<p>打开这两条证据，发现EID相同：EID都为32
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=edf16687807b68cd80cb5e220251ae68" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=021453936cc5bc492198c6014f143fd8" alt="" />
所以该问题为EID相同导致
<strong>解决方案</strong>
1.连接数据库
查看连接：<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a>
2.修改表引擎
检查Mysql数据库evidence_data表的引擎，若为InnoDB，则继续按照文档操作，否则不适用此文档的情况。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=3901d3950e58be4564de54dea03f988e" alt="" />
3.执行一下sql语句</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">alter table evidence_file drop foreign key FK_Evidence_Data_ID;
alter table evidence_log drop foreign key FK_Evidence_Log_ID;
alter table evidence_data ENGINE = MyIsam;</code></pre></table>
<p><code>注：第一条和第二条语句执行失败可以略过，但需要保证第三条sql执行成功。</code>
4.修改<code>evidence_data</code>表的自增ID，须保证其大于当前最大的证据eid（比如已知最大eid的值为15w，可以设置自增id为100w）。
其中，可以在mongoDB->constabulary->evidence_yyyymm表里寻找最大的eid值。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=59c686af76869bdf1e8fcad8e16683f0" alt="" />
<code>注：Mongodb数据库管理工具连接：http://jfwiki.streamax.com:7503/web/#/172/1289</code>
5.重启mysql服务，检查evidence_data表里的数据库引擎和自增id是否修改成功</p></div><h3>13.1.4.13、报警证据上传慢、多证据分析服务部署</h3><div style="margin-left:30px;"><h2>背景情况：</h2>
<p>客户反馈：报警证据上传太慢，需要等到时长在一天左右时长才能在客户端看到证据详情，</p>
<h2>排查过程：</h2>
<h3>1. 检查所有车辆一天报警情况</h3>
<p>1）已分析证据情况
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=c9b922ecf21ec03e7e4e9d2657b71ccf" alt="" />
2）检查所有证据情况
磁盘根目录，Evidencedata目录查看一天数据量；
Ceiba2分析服务，大小5mb的证据，一天分析速率大概是7000-8000条，当前情况已超过分析服务承担限度
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e13f48d0a104b453ba53f0fb86db3793" alt="" />
3）查看当前还有多少证据未转码
参考文档：<a href="http://jfwiki.streamax.com:7503/web/#/172/1392">http://jfwiki.streamax.com:7503/web/#/172/1392</a>
通过redis工具查看redis数据库里的uploadevidence队列；
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=a341814420a68efef5f97b029d1c8a99" alt="" />
同样有很多需要解析的证据，并且已经产生挤压；</p>
<h2>2. 多分析服务部署</h2>
<p>1）准备服务程序
复制证据分析文件，在文件目录：CMS Server\TransmitServer\EvidenceAnalyService\下，复制EvidenceAnalyService.exe，重命名为EvidenceAnalyService1.exe
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=56978a5f8e9bdb1dcda182fc98586222" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=7b376001e85a86214c190176c802d4ab" alt="" />
2）修改相关配置文件
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=d2345396d816510b80712171f4dc25ad" alt="" />
在配置文件C:\Program Files (x86)\CMS Server\TransmitServer\ServerCtrl.ini的[config]节点下，增加服务信息，例如增加“EvidenceAnalyService1”服务：同时<code>servercount</code>数量加一
参考文档：<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=1c739893bfa676472bf5a0385b929bc1" title="[CB2相关分布式操作手册(2).doc">CB2相关分布式操作手册(2).doc</a>
3）增加卸载脚本
在配置文件\CMS Server\services_name.txt中增加卸载服务的名称，如：
EvidenceAnalyService1   卸载服务名称
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=ece7fdd41add409f6e36d5523408769e" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=35ac8c02599b9d4d77c7a9d6b2df8742" alt="" />
4）安装和启动服务
重新启动管理工具（DVR Server Control）（须右键退出后启动，不能只是关闭窗口），选中EvidenceAnalyService1服务，进行安装（Install current server），安装后启动服务
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=04d6db8ac61566cdaaa7620d2adc1cd3" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e7b1c8dbd3fe44425701ff34c18a3909" alt="" /></p></div><h3>13.1.4.14、证据中心打开白屏</h3><div style="margin-left:30px;"><h1>现象</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=80857d0fd2e9fa034582c007d26ba3aa" alt="" /></p>
<h1>排查</h1>
<p>客户端跳转证据中心连接：
<a href="http://127.0.0.1:12056/jump.html?action=evidencenter&token=zT908g2j9niDIGg7BDRG81CTRVK7OiVwAGFKj3ZvETM%3D&source=client&lang=English">http://127.0.0.1:12056/jump.html?action=evidencenter&token=zT908g2j9niDIGg7BDRG81CTRVK7OiVwAGFKj3ZvETM%3D&source=client&lang=English</a>
查看web日志。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f80701287c1041f3760095c50f939eab" alt="" /></p>
<h1>处理</h1>
<p>数据库缺表</p>
<table width='100%' class='codestyle'><pre><code>
-- ----------------------------
DROP TABLE IF EXISTS userflowset;
CREATE TABLE userflowset (
id int NOT NULL PRIMARY KEY AUTO_INCREMENT,
userid int NOT NULL,
islimit tinyint default 0 comment '是否进行流量限制，0：不限制，1：限制',
flowtype tinyint default 0 comment '流量类型：0：永不清零，1：每月清零',
totalflow bigint default 0 comment '总流量，单位为M',
alertvalue smallint default 90 comment '预警值，百分比数值',
cleardate smallint default 1,
mac text default null comment 'MAC地址，多个用分号隔开，定制项目内使用',
updatetime datetime not null,
typechangetime datetime comment '流量类型更改的时间。更改之后要重新计算流量数据',
remark text default null
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</code></pre></table></div><h3>13.1.4.15、证据预览蓝屏</h3><div style="margin-left:30px;"><h1>证据预览蓝屏</h1>
<p>问题背景：<a href="https://rdms.streamax.com/index.php?m=bugmarket&f=view&bugID=3313">https://rdms.streamax.com/index.php?m=bugmarket&f=view&bugID=3313</a>
问题原因：地图类型保存异常；修改后恢复
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e798d740edd61bc851030a990c251733" alt="" /></p></div><h3>13.1.4.16、客户端证据跳转web是ip的格式</h3><div style="margin-left:30px;"><h1>一、问题描述</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5e606594609b3fe61aa7627b732e0050" alt="" />
客户做了https，但是客户端点击证据跳转web还是以ip的格式显示</p>
<h2>二、问题解决</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f945e7606ed0bda71a538337493ffacf" alt="" />
以域名登录客户端，就可显示域名的证据
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=34234b0547fe96f79891a8f8422d7a0f" alt="" /></p></div><h3>13.1.4.17、证据跳转明细提示失败</h3><div style="margin-left:30px;"><h1>证据跳转明细提示失败</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6e2431858fb185ef91f22b43a10700b1" alt="" /></p>
<p>直接复制跳转失败的连接打开，发现是证书失效
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2539981ad372a0c0688c6b875e3795ea" alt="" /></p>
<p>检查nginx配置，发现是证书失效。 </p></div></div><h2>13.1.5、远程设置</h2><div style="margin-left:0px;"><h3>13.1.5.1、N9M1.0设备无法打开远程设置</h3><div style="margin-left:30px;"><h1>N9M1.0设备无法打开远程设置</h1>
<h2>检查项：</h2>
<p>一.检查代理服务器配置---以下的修改均需要重启代理服务才生效
路径:D:\Program Files (x86)\CMS Server\TransmitServer\n9m_proxy\ProxyServer.ini
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a9e023773e4938bc1a3ce6808c9b4858" alt="" />
或者是 D:\Program Files (x86)\CMS Server\TransmitServer\n9m_proxy\HttpProxyCfg.exe
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/bea3f884ea38372a9eee54fa88d132df" alt="" /></p>
<p>dev_conn_addr IP 应该填设备上报的IP.   即注册服务器IP
设备连接IP : 应该填设备上报的IP 即注册服务器IP。
注册服务器地址：部分服务器上不能通过自己的外网IP：5556访问到本机，所以最好填写服务器的内网IP或者127.0.0.1 ，例如127.0.0.1:5556</p>
<p>二.检查对应的端口
使用telnet 工具测试5558 7878端口是否通！
端口号参考上一个步骤 代理配置界面中的端口！平台软件版本号不同，端口号可能有变化！</p>
<h2>方法一</h2>
<p>检查12050/12051端口是否监听。
1.启动DBGVIEW, 过滤dev connect, 然后启动远程设置，如果DBGVIEW无输出，则设备没有连接上来， 需要设备排查。</p>
<ol>
<li>netstat -atn 1 | find 12050，如果没有建立的连接，则是设备没连上来，需要设备排查。
重启N9M_proxy服务试下。</li>
</ol>
<h2>方法二</h2>
<p>CB2远程设置N9M1.0设备时，登录后链接变为relogin
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/66359938df21921ecb20d34cadcd36cd" alt="" />
清除浏览器缓存解决</p>
<h2>方法三 替换补丁</h2>
<p>2021年6月15日10:00:32
整体替换，记得改配置文件。
263.0.63版本已经集成</p></div><h3>13.1.5.2、N9M2.0设备无法打开远程设置</h3><div style="margin-left:30px;"><h1>无法打开远程设置</h1>
<h2>1、N9M2.0设备的远程设置无法打开。</h2>
<h4>（1）N9M2.0设备打开远程设置的必须条件是服务器端安装的CMS Server版本必须为2.6.3及以上版本，使用的客户端版本为2.6.3.0.24及以上版本.</h4>
<h4>（2）服务器上安装了2.6.3.35.05版本的CMS Server后，还需要替换Commandispache服务的补丁。</h4>
<blockquote>
<p>注意:只有2.6.3.35.05版本的才需要打这个补丁，其余版本都不需要。
补丁包见以下链接：<a href="http://jf.streamax.com:8081/f/39677f41a537461b8aad/?dl">http://jf.streamax.com:8081/f/39677f41a537461b8aad/?dl</a>
补丁替换完成后，重启CommandDispatch服务。</p>
</blockquote>
<h4>（3）前提条件和使用逻辑</h4>
<h6>前提条件：</h6>
<p>1、8081，12048 都必须映射。
2、X:\CMS Server\TransmitServer\MessagerServer\regsvr的PublicIPv4  参数必须是公网IP（或者设备能连的IP）</p>
<h6>使用逻辑：</h6>
<p>1、客户端必须获取C6D设备的版本号
2、客户端先调用12056这个接口（下图1）， 12056去调12047,12047返回的errorcode和URL给客户端， 返回200，客户端用浏览器打开URL，非200，跳转旧代理（12050）
3、服务器让设备通过12048端口上传网页资源文件，上传过程中，客户端会提示“网页资源上传中，请稍等”，上传完成后，12056将返回error code=200。
4、 客户端再满足1 2 3 条件，才能通过8081端口打开远程设置.</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c9d3847787d4b90c8497886458a89f27" alt="" /></p>
<p>客户端先调用12056这个接口， 12056去调12047,12047返回的URL，由12056拼接好再通过客户端用浏览器打开。</p>
<p>远程设置跳转URL，替换ID和账号密码即可。
<a href="http://172.16.21.27:8081/devapi/v1/basic/key?username=admin&password=120223&language=0&autoLogin=1&serialnum=002B011F4F&url=/C6D4.0-base/pages/config/default.html">http://172.16.21.27:8081/devapi/v1/basic/key?username=admin&password=120223&language=0&autoLogin=1&serialnum=002B011F4F&url=/C6D4.0-base/pages/config/default.html</a></p>
<h4>所以请检查8081、12048端口是否正常映射。</h4>
<p>参考以下FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1301">http://jfwiki.streamax.com:7503/web/#/172/1301</a></p>
<h4>（4）若点击远程设置一直属于"资源文件正在上传"，</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/08c74a146fa1f6fed74026ce2cc93174" alt="" />
先检查外网端口
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=c3eb24cf94d4b7e421780c2f8b56f39b" alt="" /></p>
<h2>例1：</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/dbc75150aa807b80c503828f25fddea5" alt="" /></p>
<h3>排查过程:</h3>
<h4>（1）确认是否部分设备是否无法打开远程设置</h4>
<p><strong>点击设备设置和查看设备的版本号的时候，该设备离线，怀疑设备是不是网络情况不好。</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1c3489afb2038f0d5899dfa79d768050" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5cd4838e8976236b5674609dec37f5f0" alt="" /></p>
<h4>（2）查看设备日志</h4>
<p><strong>使用工具下载了设备日志，搜索关键词N9M，结果如下，设备在频繁上下线。（也可以直接通过报表中的设备上下线报表查看）</strong></p>
<blockquote>
<p>由此可以了解到：无法打开远程设置，是由于设备频繁上下线导致。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1b8471eb1fb9a8db1fef284161185be2" alt="" />
<strong>使用下面这串json获取服务器参数（使用曾工开发的ceiba工具可以做到这些事情！）</strong></p>
<table width='100%' class='codestyle'><pre><code class="language-json">{"MODULE":"CONFIGMODEL","OPERATION":"GET","PARAMETER":{"MDVR":{"MCMS":"?"}}}</code></pre></table>
<p><strong>发现设备其实是正常上报的</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/66416bcdae97c825cb611951e492913a" alt="" /></p>
<h3>结论：</h3>
<p><strong>目前判断为SIM的原因导致的设备频繁上下线，可以找运营商了解一下。
也可能是DNS原因导致的，问一下熊英强熊工后续是如何处理的即可。</strong></p>
<h4>（2）解决方法：打开服务器的web端，点击基础信息--车辆信息--找到异常的设备，点击修改，找到设备档案--设备用户名</h4>
<p>这里发现就是由于填写了设备用户名，所以打开远程设置的时候返回了不适当的参数。将这行字清除掉，点击保存，再次打开远程设置即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a92c725353cb8b918177d50d145ebd4e" alt="" /></p>
<h2>例4：打开N9M2.0的远程提示“An error occurred”</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/17eccf489150d4ecc65289d75e27d177" alt="" /></p>
<p>参考以下FAQ处理：<a href="http://jfwiki.streamax.com:7503/web/#/172/1302">http://jfwiki.streamax.com:7503/web/#/172/1302</a></p>
<h2>例5: 远程设置提示资源上传中</h2>
<p>上服务器，查看EvidenceStoreService服务日志
C:\Program Files (x86)\CMS Server\TransmitServer\EvidenceStoreService\Log\Info\2022\7\14
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e227452101fef33b46ebec1db109e423" alt="" />
下发上传任务指令，设备将指定文件传到对应的文件夹中。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=3ae017d05ed29fdbd902d8d2fc67a993" alt="" />
如图所示，设备的资源文件已经传到对应的文件夹中，亲测，上传完成后，还需要3-5分钟才能打开远程设置。</p></div><h3>13.1.5.3、打开N9M2.0的远程提示“An error occurred”</h3><div style="margin-left:30px;"><h1>打开N9M2.0的远程提示“An error occurred”</h1>
<h2>1、现象</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/048e1ee7fedd12a77e4282831ba2427d" alt="" /></p>
<h2>2、解决方法</h2>
<h3>（1）进入服务器</h3>
<p>A.先查看fcgi.exe是否正常运行</p>
<p>打开任务管理器--详细信息，按字母排序，观察fcgi.exe是否正常运行，如果正常运行，右键点击该进程，选择结束该进程。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f3971a63113cc046a98f234025cbee77" alt="" /></p>
<p>B.进入服务器的对应目录 CMS Server/nginx
点击startfcgi.bat，选择以管理员身份运行即可</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2dda57afeb010f38131ec660289b852b" alt="" /></p>
<p>若想知道具体执行打印
可以进入cmd中执行
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7a2a3dd12fc08a020e148077997d385b" alt="" /></p>
<h3>（2）检查端口</h3>
<p>fcgi有些版本是48081，有些是58081，即48081/58081有一个监听就行</p>
<table width='100%' class='codestyle'><pre><code>netstat -ano | findstr 8081
netstat -ano | findstr 48081
netstat -ano | findstr 58081</code></pre></table>
<p>检查这个8081端口和48081/58081端口是否正常监听，如果进行了第一步还没监听，执行以下操作。</p>
<p><strong>A.进入命令行界面</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/74f2814a74683f76ad69b8f4501dbf0f" alt="" /></p>
<p><strong>B.执行启动nginx命令</strong></p>
<table width='100%' class='codestyle'><pre><code>start nginxbroker.exe</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6f96d37fd9d42a8637c67ec2ae0814ed" alt="" />
<strong>B.执行启动nginx重载命令</strong></p>
<table width='100%' class='codestyle'><pre><code>nginxbroker.exe -s reload</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/53da6c7654285e3c08f94547df841368" alt="" /></p>
<p>直到48081/58081端口正常监听为止</p></div></div><h2>13.1.6、设备在线</h2><div style="margin-left:0px;"><h3>13.1.6.1、所有车辆不在线</h3><div style="margin-left:30px;"><h1>所有车辆不在线</h1>
<h5>1）    检查MessagerServer、OnlineServer、ClientAccessService服务是否正常。</h5>
<p>可直接在看门狗界面观察，然后检查端口监听状态。
netstat -ano | findstr “5556”
netstat -ano | findstr “12040”
在自己电脑上检查服务器端口是否映射：
telnet 外网IP 5556
telnet 外网IP 12040
具体情况可查看2.1的第2点进行操作。</p>
<h5>2）    可依次重启Redis Server服务，在重启MessagerServer服务，之后依次重启ClientAccessService、onlineServer、alarmservice，再次登录客户端观察。</h5>
<h5>3）    若客户端右上角提示“报警服务器断开”，检查AlarmServer、ClientAccessService是否正常启动。若均正常，检查登录客户端使用的密码是否包含了特殊字符，请将密码中的特殊字符修改为@或者！。</h5>
<h5>4）    可以双击看门狗中的MessagerServer查看具体有没有设备上线。</h5></div><h3>13.1.6.2、车辆频繁上下线或车辆离线但实际在线</h3><div style="margin-left:30px;"><h1>车辆频繁上下线或车辆离线但实际在线</h1>
<p>请下载以下链接中的补丁替换相关服务，替换前请一定做好文件备份工作：</p>
<blockquote>
<p>注意：一般替换补丁是需要替换补丁文件夹中的文件替换到服务器对应的文件夹内，而不是直接将补丁的文件夹拷贝到服务器对应目录使用。
针对2.6.3以下的版本</p>
</blockquote>
<p><a href="http://jf.streamax.com:8081/f/1966cf47a2c943c69477/?dl=1">http://jf.streamax.com:8081/f/1966cf47a2c943c69477/?dl=1</a></p></div><h3>13.1.6.3、车辆短时间内大量掉线</h3><div style="margin-left:30px;"><p>[TOC]</p>
<h1>一、概述</h1>
<p>车辆短时间内大量掉线，并且打开服务器提示fcgi.exe已停止工作
实际是注册服务异常引起的fcgi.exe停止工作，实际掉线与fcgi.exe并无任何联系，掉线只与注册服务有关。</p>
<center>![](http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c8474a44fc6df02b65a2e537ef70948b)</center>
<h1>二、解决步骤</h1>
<h2>2.1下载需要替换的包文件</h2>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/91ee221bb8c0aa3bf2d4589a2b618607" title="[MessagerServer.zip">MessagerServer.zip</a></p>
<h2>2.2停服务</h2>
<p>停止相关服务</p>
<h2>2.3对原有服务进行备份</h2>
<p>拷贝一份messageserver文件夹到其他目录进行备份</p>
<h2>2.4上传我们下载的要替换的包</h2>
<p>上传我们下载的要替换的包，并解压，将里面的文件替换到messageserver文件下进行替换</p>
<h2>2.5启动服务</h2>
<p>启动相关服务</p></div></div><h2>13.1.7、远程升级</h2><div style="margin-left:0px;"><h3>13.1.7.1、远程升级修改ftp端口和密码</h3><div style="margin-left:30px;"><h1>CB2远程升级修改ftp端口</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3cf3c1766d8cc35fde00e37f769a5d23" alt="" /></p>
<h2>修改端口</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8d47a9049f5c57e114b470374c72ccd1" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/15b0814e4cab4183df3cdd92dd36944e" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a861db862a52e5dbdc53d90afefcc478" alt="" /></p>
<p>参考以下FAQ的方法二连接数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a></p>
<p>直接修改为3100，然后点击空白处就会自动确认修改
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/def17c2960e60c7c070414076db3fda8" alt="" /></p>
<h2>修改密码</h2>
<p>点击Edit-Users</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9cc23bcbba6cd3c35839f23f3708b1da" alt="" /></p>
<p>选择General-admin，修改自己想修改的密码，最后点击ok。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d4bf83ae1410de34634e84b727a9019b" alt="" /></p>
<p>参考以下FAQ的方法二连接数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a></p>
<p>打开systemconfig表
将FTPPassword改为刚刚自己修改的密码，点击空白处即可自动修改。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/35b9ec291b2b5332d05031cb60c4baf0" alt="" /></p>
<h2>最后修改配置</h2>
<p>打开configtool</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fe8b4b14d6a229270f07c23002ebbda0" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8982a37e1407cac9d90800ffe165abd0" alt="" /></p>
<p>注意：客户需要映射3000-3100端口。</p></div><h3>13.1.7.2、远程升级返回文件不存在</h3><div style="margin-left:30px;"><h1>远程升级返回文件不存在</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/177e55bfcdd940b60d172cf5a6ecf81b" alt="" /></p>
<h1>排查过程</h1>
<h2>1、检查路径下是否存在该升级文件。</h2>
<h3>方法一：通过登录FTP查看</h3>
<p>CEIBA的FTP登录端口为21，账号/密码：admin/123456
进入FTP后发现升级文件是存在的。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/21c31e5105aa2531200c58abe074c8cb" alt="" /></p>
<h3>方法二：进服务器目录查看</h3>
<p>在12056网页端上传的软件是存放在服务器目录CMS Server/WCMS4.0/systemfile/download/deviceupgrade下的。
查看服务器目录发现文件存在。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/df5101c9227e3816d7db5e821d57c25c" alt="" /></p>
<h2>2、检查服务器给设备下发的文件路径是否正确。</h2>
<p>（1）进入服务器目录CMS Server/TransmitServer下，找到Dbgview.exe，并以管理员权限打开。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a61bd2303ff4cd6f298f9261f43b4811" alt="" /></p>
<p>（2）软件打开后，点击Capture，将下图显示的几项都勾选上。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9cda910872f4a203fbec5e49fe74a476" alt="" /></p>
<p>（3）筛选关键字，关键字为自己服务器对应的外网IP，如下图所示,输入完成后点击ok。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f137b3c7984ab53baee3d4ac1d33fca8" alt="" /></p>
<p>（3.1）上述筛选外网ip可能导致抓取不到信息，因为存在下发ip配置错误，推荐筛选“ftp”关键字
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b41e80b77f09e952d8a423da1c87574d" alt="" /></p>
<p>（3.2）数据库mysql systemconfig表可以确定下发ip正确与否</p>
<p>（4）在12056网页端，重新下发升级任务。如果指令下发成功，那Dbgview页面会弹出相关的信息，如下图所示。
这里表明了升级文件的路径为CMS Server/WCMS4.0/systemfile/download/deviceupgrade下的文件。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/61071e290672a4150965d9694676f473" alt="" /></p>
<h2>3、检查FTP配置的文件路径</h2>
<p>（1）打开FTP Server。进入服务器目录CMS Server/FtpServer，单击FileZilla Server Interface.exe（图3.1），即可打开界面（图3.2）。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8860d971b8b323fcf005ec5cc0d00989" alt="" /></p>
<center>图3.1</center>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/10d582642074c351a29c94b2a5570921" alt="" /></p>
<center>图3.2</center>
<p>（2）点击设置，查看配置的文件目录。
这个目录以前设置的是ROOT_DIR\WCMS4.0\Systemfile,所以升级的时候返回找不到文件。
然后点击Add，选择自己服务器的CMS Server/WCMS4.0/systemfile，然后将右边的Files和Directoies按照图3.5勾选上，勾选上后，点击Set as home dir，最后点击左下角的ok。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/33773e414479d7674a821f38c516c2ba" alt="" /></p>
<center>图3.3</center>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/119f7f5b2f3f3af057c2835ebc1df997" alt="" /></p>
<center>图3.4</center>
<h2>最后测试升级</h2>
<p>重新升级失败的设备，验证正常。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7ef08a3a9a4446f0b55db4ef7d67b385" alt="" /></p></div><h3>13.1.7.3、远程升级失败</h3><div style="margin-left:30px;"><h1>现象</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0ac65687034d16d812e888e4f101cca1" alt="" /></p>
<h2>排查</h2>
<p>使用flashfxp 登陆测试
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c70523157d26a79b131649815bfb58b1" alt="" />
被动端口没开</p>
<h2>解决</h2>
<h3>确认当前FTP端口配置</h3>
<p><a href="http://jfwiki.streamax.com:7503/web/#/172/1307">http://jfwiki.streamax.com:7503/web/#/172/1307</a>
检查当前配置的端口，与客户确认端口是否映射。 </p></div></div><h2>13.1.8、自动上报</h2><div style="margin-left:0px;"><h3>13.1.8.1、车辆未上报（无法自动加车）</h3><div style="margin-left:30px;"><h1>车辆未上报（无法自动加车）</h1>
<h5>1）    检查WCMSWebCenterService、Apache2.2服务是否启动正常，重启这两个服务。</h5>
<h5>2）    检查5556/12055端口是否映射。</h5>
<h5>3）    连接数据库，清空deletedevicelog表的内容。</h5>
<p>请参考以下文档链接中的navicat连接数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a></p>
<h5>4）    连接数据库，检查systemconfig表的IsAutoSynchronous字段值是否为1，webport字段是否为12055.</h5>
<h1>例1</h1>
<h2>背景</h2>
<p>内网上报，服务器内网使用，不开放端口；
重启了WCMSWebCenterService和Apache2.2没有效果；
数据库deletedevicelog表已经清空；
数据库sistemconfig表的IsAutoSynchronous字段值为1。
在注册服务器可以查看该设备，但登录ceiba2后无法查看，无法正常自动上报。</p>
<h2>排查</h2>
<p>（1）查看HTTPSDK服务的错误日志，提示以下错误。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/32e941fadc598f52affd3da9faf07430" alt="" /></p>
<p>（2）询问了研发，认为是升级的时候CMS Server/TransmistServer/HttpSdkService/DatabBase下的dev.bat没有更新，导致字段跟现在不一致。</p>
<p>将dev.bat备份。
然后删除掉原来的dev.bat。
<strong>最后重启HttpSdkService服务和WCMSWebCenterService服务恢复正常。</strong></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/418b5a8b56ff778a28034c30db1c8910" alt="" /></p></div></div><h2>13.1.9、自动下载</h2><div style="margin-left:0px;"><h3>13.1.9.1、更改自动下载路径</h3><div style="margin-left:30px;"><h1>更改自动下载路径</h1>
<h2>操作方法</h2>
<p>（1）登录客户端</p>
<p>（2）点击右上角的下载按钮</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/89c5f40ed2d250a2411e7b2a2c17c2fe" alt="" /></p>
<p>（3）点击自动下载--点击配置</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f1d17f422966046e4deba2029586ac95" alt="" /></p>
<p>（4）选择自己想存储的盘，最后点击磁盘配置。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/93c30c8600aced3c9efe4d6d800f181a" alt="" /></p>
<p>如果新增了磁盘，但是配置页面未出现，可以点击刷新磁盘试试。</p>
<p>如果刷新磁盘仍然不行，可以查看以下FAQ解决方法的第二点：<a href="http://jfwiki.streamax.com:7503/web/#/172/1326">http://jfwiki.streamax.com:7503/web/#/172/1326</a></p>
<blockquote>
<p>注意：修改以后仅仅只针对于以后自动下载的视频有效，之前的视频该放在哪里还是放在哪里，视频存放路径是入了数据库的，所以之前的视频如果你挪到了别的盘，仍然也无法读取，请不要动之前的视频。</p>
</blockquote></div><h3>13.1.9.2、关闭自动下载转Mp4</h3><div style="margin-left:30px;"><h1>关闭自动下载转Mp4</h1>
<p>自动下载录像后，默认会将录像转换一份mp4作为ADS接口的下载数据源，若客户不需要使用这个接口，可关闭此功能以节约磁盘空间。</p>
<h2>操作方法</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/516a17e71ddcf6fe95ee7a05746aaad1" alt="" /></p></div><h3>13.1.9.3、自动下载页面无法打开</h3><div style="margin-left:30px;"><p>[TOC]</p>
<p>Time:2022-03-04
Auth: Lee</p>
<h2>概述</h2>
<p>Ceiba2客户端-下载-自动下载</p>
<h2>现象</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/73cf464b4473e548f3ff232d3b3cef0e" alt="" /></p>
<h2>排查步骤</h2>
<h3>1）* 客户端版本与服务器端版本不适配</h3>
<p>大多出现此问题的，主要原因均为CB2客户端与服务器版本不适配导致，需更换对应的版本。
如果要使用自动下载功能：<code>建议客户端版本不要比服务器版本高</code>
262:
263:
264:</p>
<h3>2）12055端口相关连接无法访问</h3>
<p>由于Ceiba2客户端自动下载界面是内嵌的网页，所以客户端所有内容均来自于下面的网页内容，如果此URL无法访问，说明相关服务未启用或者异常。</p>
<p>相关URL：</p>
<table width='100%' class='codestyle'><pre><code class="language-shell">http:IP:12055/?action=autodownloadTask&username=Ceiba2用户&pwd=密码</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8551cfd67f777c92f43c271acd9f2ba2" alt="" />、
说明：如果通过浏览器能访问此页面，说明服务正常。反之，检查第（1）步。再反之，继续以下步骤。</p>
<h3>3）检查12055登陆页面</h3>
<p>如果第2步无法正常进入页面，说明用户登陆页面有问题（因为上一步的链接内有username和pwd参数，这两个参数用于用户验证）。</p>
<p>相关URL：</p>
<table width='100%' class='codestyle'><pre><code class="language-shell">http://ip:12055/plugin/RegisterLogin/default.aspx</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e0bedf31cc297a35cb2de2efeafb8e4c" alt="" />
说明：此页面无法访问，检查12055端口是否监听；检查WCMS4.0/plugin/下目录数是否完整（完整目录如下图）
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4a9fe66d2eed429e3f5bd8801f2c678b" alt="" /></p>
<p>如访问过程中出现错误：<strong>Server Error in '/' Application</strong>
参考：<a href="http://jfwiki.streamax.com:7503/web/#/172?page_id=1351" title="showdoc-巴拉巴拉">showdoc-巴拉巴拉</a></p>
<h2>总结</h2>
<p>此功能主要受两个点影响：</p>
<table width='100%' class='codestyle'><pre><code class="language-shell">1.客户端版本
2.12055相关链接</code></pre></table></div><h3>13.1.9.4、把服务器上下载的录像拷贝到本地转mp4失败</h3><div style="margin-left:30px;"><h1>把服务器上下载的录像拷贝到本地转mp4失败</h1>
<h2>解决方法</h2>
<p>需要先把文件目录里面的rmdvrrootdir.dat等文件删除掉，见下图。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8362c795267a96db51ffc71691e476f5" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0c0d3822f97f8b63aa3c9b3785f13052" alt="" /></p></div><h3>13.1.9.5、ADS下载任务提示等待中</h3><div style="margin-left:30px;"><h1>现象</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=a9377e310e25aaad8c0e2ba66b3362f8" alt="" /></p>
<h1>排查</h1>
<p>业务逻辑说明：<a href="http://jfwiki.streamax.com:7503/web/#/172/1549">http://jfwiki.streamax.com:7503/web/#/172/1549</a>
1、是否在线
2、检查任务参数
2.1 任务开始、结束日期
2.2 任务模式，单次还是循环
2.3 下载时间段
2.3 触发条件</p>
<h1>案例</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=3f2f133c3d3cf58dd91d716d41a1277e" alt="" />
任务开始、结束日期是前天，
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=4ed18562c906b875565c4275a307f3ce" alt="" />
修改开始日期前天，结束日期当天正常
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=a26c1f482c8ac4aa70c8315b28e1cfa2" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=cac1c9e4fa900b032228b6b2697f7852" alt="" /></p>
<h1>异常任务删除</h1>
<p>进数据库清空 ads_task ads_detailtask两个表即可</p></div></div><h2>13.1.10、其他</h2><div style="margin-left:0px;"><h3>13.1.10.1、客户端解析地址提示timeout（超时）</h3><div style="margin-left:30px;"><h1>客户端解析地址提示timeout</h1>
<h2>一、现象</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d0a596c34a10dac5223c6eaaa14de3e4" alt="" /></p>
<h2>二、原因</h2>
<p>默认的客户端都是使用的公司的百度key，一般到了下午的时候，key的解析次数就会用完，属于正常现象，如果客户需要这个功能，那么让客户先申请一个自己的百度key进行替换即可。</p>
<h2>三、替换客户申请的百度Key</h2>
<p>（1）请点击core.js并下载。
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/47b91f6e9ad0d395cfadcfb7ab4001de" title="[core.js">core.js</a></p>
<p>（2）下载完成以后打开core.js，找到第750行的api_key,将这一串的xxxxxxxxx修改为客户申请的百度key，点击保存。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3d60bf0a429e5379cc805ca06e4da31a" alt="" /></p>
<p>（3）进入自己电脑Ceiba2安装目录下，CEIBA2/map/lib，将原来的core.js备份一份，
再将第二步修改完的core.js复制到该目录下，重新登录客户端即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f75de0d69efb3a8d66463378847c0a0c" alt="" /></p>
<blockquote>
<p>注意该方法是单个客户端修改，如果需要批量，那么需要利用修改好的客户端进行二次打包。</p>
<h1>客户端获取地址提示超时</h1>
<h2>1.现象</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=08a840af42824bfe5a26586c65a85fca" alt="" /></p>
<h2>2.原因</h2>
<p>更换电脑客户端登录依旧失败，但登录其他客户ip正常，应该是百度key到期</p>
<h2>3.替换客户申请的百度key</h2>
<p>在网页端替换key保存
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=3cffd15181a8bd59515e753ce9faebc7" alt="" />
再次登录客户端已恢复正常
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=d2c734516cc1662a8f4fb041caf25ee1" alt="" /></p>
</blockquote></div><h3>13.1.10.2、客户端点击基础数据跳转空白</h3><div style="margin-left:30px;"><h1>客户端点击基础数据跳转空白</h1>
<h3>解决方法：</h3>
<p>替换以下补丁：</p>
<blockquote>
<p>针对263版本以下
替换之前，请先备份对应的文件夹</p>
</blockquote>
<p><a href="http://jf.streamax.com:8081/f/3292808b102a4c5eb8fa/?dl=1">http://jf.streamax.com:8081/f/3292808b102a4c5eb8fa/?dl=1</a></p></div><h3>13.1.10.3、车辆无时间、定位、报警（或时间、定位、报警不更新）</h3><div style="margin-left:30px;"><h1>车辆无时间、定位、报警（或时间、定位、报警不更新）</h1>
<h5>1）    重启AlarmServer服务，如果单独重启该服务仍无实时GPS等信息，重启所有服务。</h5>
<h5>2）    报警服务频繁重启，替换补丁。</h5>
<blockquote>
<p>补丁针对263版本以下</p>
</blockquote>
<p>补丁链接如下：
<a href="http://jf.streamax.com:8081/f/b2df47e061a844deb638/?dl=1">http://jf.streamax.com:8081/f/b2df47e061a844deb638/?dl=1</a></p>
<h5>3)    检查MessagerProcessServeice的开关</h5>
<p><strong>2.6.3.0.80及以上的263版本，以及264、265、266这个开关会是1，以下的版本为0</strong></p>
<p>找到messageservice配置文件，修改位置如下，<code>将其改为0</code></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=cc063705836ebfb034512dcc0db993de" alt="" /></p></div><h3>13.1.10.4、磁盘容量增加或者新增磁盘后，ADS设置未识别到磁盘变化</h3><div style="margin-left:30px;"><h1>磁盘容量增加或者新增磁盘后，ADS设置未识别到磁盘变化</h1>
<h2>现象</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cdbaa9673495ecf511512d2f7e1afb2a" alt="" /></p>
<h2>原因</h2>
<p>此现象是因为添加新硬盘或者硬盘容量改变后CB2没有重新检测硬盘数据。</p>
<h2>解决方法</h2>
<p>（1）管理员权限执行磁盘检测工具：CMS server\TransmitServer\AdsServer\CheckDisk\ADS.CheckDiskPath.exe
执行完毕后重启客户端即可选择新增盘符。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6f1f572ceb07199d33671732a35dba05" alt="" /></p>
<p>（2）如果第一步执行了没有任何变化，需要进入数据库删除ads_diskpath表。</p>
<p>参考以下FAQ的方法二使用navicat连接数据库：<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a></p>
<p>然后选中WCMS4数据库，点击查询--新建查询</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fdf49b2a64471c28c2115090951dace6" alt="" /></p>
<p>输入delete from ads_diskpath;点击运行即可。
然后再次执行第1步。
管理员权限执行磁盘检测工具：CMS server\TransmitServer\AdsServer\CheckDisk\ADS.CheckDiskPath.exe
执行完毕后重启客户端即可选择新增盘符。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/81c4392397e638c16cb09c2d6587e347" alt="" /></p></div><h3>13.1.10.5、修改设备GPS上报间隔</h3><div style="margin-left:30px;"><h1>修改设备GPS上报间隔</h1>
<p>CEIBA2服务器默认开启了GPS上报开关，当设备上报平台后，会自动打开GPS上报并将上报频率设置为30s。当此功能开启时，即使在客户端修改了GPS上传间隔设置，在设备重启后也会被更改成默认值。</p>
<p>可通过修改配置的方式关闭自动修改设备GPS上传间隔的功能或者修改上传间隔</p>
<h2>操作方法</h2>
<p>（1）进入服务器CMS Server\TransmitServer\MessagerServer，打开regsvr.ini文件</p>
<p>配置项：
UpGpsEnable：值为1代表开启自动修改GPS上传间隔，为0代表关闭，为-1表示忽略。
UpGpsPeriod：GPS上传间隔，单位为秒，最小可设置为5。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/86306e3d109094afea781f1dd8795ded" alt="" /></p>
<p>（2）修改配置后保存文件重启MessagerServer生效。</p></div><h3>13.1.10.6、修改地图车辆图标数</h3><div style="margin-left:30px;"><h1>修改地图车辆图标数</h1>
<h2>背景</h2>
<p>客户端登录成功后，地图上仅会默认显示100辆车的图标，其余的图标将会在点击车辆的时候再显示到地图上，客户想要将车辆的图标都正常显示在地图上。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0fa80e6276d7e2e51c1224f3d02575b2" alt="" /></p>
<h2>操作方法</h2>
<p>找到当前电脑上安装Cb2客户端的目录，找到program.ini.</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6db1786fa9adee98bdfa1cd6efa0cba8" alt="" /></p>
<p>找到MapCarCount参数，修改其数值即可，该数值的修改研发未曾测试，若数据太大可能不一定有效，请自行尝试。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cbb3202c8ba9d8ee7ebe549734564be2" alt="" /></p></div><h3>13.1.10.7、客户端车辆图标不显示</h3><div style="margin-left:30px;"><h1>车辆图标不显示</h1>
<h3>问题截图</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=06b00e627d2325376f72839155a59b19" alt="" /></p>
<h3>解决步骤</h3>
<h4>1.单击空白桌面选择屏幕分辨率</h4>
<h4>2.点击高级选项</h4>
<h4>3.将颜色改为真彩色32位</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=84aabbf339a2d687453f82dd4793d30e" alt="" /></p></div><h3>13.1.10.8、服务器开启了HTTPS, 客户端端口测试仍在测试HTTP端口</h3><div style="margin-left:30px;"><h1>一、现象</h1>
<p>服务器开启了HTTPS, 客户端端口测试仍在测试HTTP端口，例如下图的8090,3113。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2a9f9f7187eb93910dac40f0d8221d2e" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=514b2a8639b331998af145e71d7a6df2" alt="" /></p>
<h1>二、修改方案</h1>
<p>找到服务器ClientBalance/BAGConfig.json文件，在对应的http端口配置项节点里添加 <strong>"ips"</strong> 和 <strong>"ports"</strong> 和 <strong>"usesecure"</strong> 三个配置项，其中，<strong> ips的值为"0.0.0.0", ports的值为对应的https端口（例如该节点http端口是8090，https端口即为28090， 具体参见服务器的端口配置工具）， "usesecure"的值为1</strong>。修改完成后重启服务器的ClientBalance服务，然后重新登陆客户端即可。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=13971f163b4dbe12736172d19c070274" alt="" /></p></div></div><h2>13.1.11、服务器回放</h2><div style="margin-left:0px;"><h3>13.1.11.1、服务器回放视频组件加载异常</h3><div style="margin-left:30px;"><h1>服务器回放视频组件加载异常</h1>
<h2>问题背景：</h2>
<p>服务器回放，双击车辆设备后月历显示存在视频缓存，但是双击当天月历显示视频组件后消失；</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=26e0ea309094c5e10e99302c031bc903" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6de2802a7c6f421fd326333e64a9911d" alt="" /></p>
<p>服务器存在当前查看视频文件</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=d1b6a627dca9fd5b7db70bf103b7dc37" alt="" /></p>
<h2>排查过程：</h2>
<p>当前客户服务器位于泰国，服务器时间为泰历，与常规时间冲突不同，服务器上是泰国日历，获取的系统时间也是泰历的，导致计算时间出错，获取不到视频数据，修改系统时间格式为国际时间日历后服务器回放功能正常；
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=cb8b5a6d810f0751b3f4e6406b8adbcf" alt="" /></p></div></div></div><h2>13.2、客户端--Web</h2><div style="margin-left:20px;"><h2>13.2.1、基础数据</h2><div style="margin-left:0px;"><h3>13.2.1.1、Web端数据不显示</h3><div style="margin-left:30px;"><h1>web端数据不显示</h1>
<h2>一、现象</h2>
<p>web端无数据显示</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6130d014e320d2eb41f6fa449101a2ef" alt="" /></p>
<h2>二、排查与解决</h2>
<h3>2、1查看WCMS5/root/logs/app.log</h3>
<p>提示Duplicate entry '0' for key 'PRIMARY'，应该就是数据库有些表出现了丢失自增属性或者第一个ID为0的情况。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3781dc17ec3d9fe5eb77397b11c31298" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d4526921245f68707a3c379d3d78a3bf" alt="" /></p>
<h3>2、2手动为表增加自增属性</h3>
<p>（1）连接数据库
参考http://jfwiki.streamax.com:7503/web/#/172/1329 的方法二进入数据库</p>
<p>（2）备份数据</p>
<p>参考该文档http://jfwiki.streamax.com:7503/web/#/172/1283  第（4）点使用navaicat备份数据库。</p>
<p>（3）手动添加自增属性
主要为以下表添加自增属性：vehicledevice、devicefile、vehiclefile、sim、roleinfo、userinfo、registlogin、userconfig、userflowset、userflowsetlog、groupinfo、moduleinfo、modulepower、commandinfo、commandpowr</p>
<p>第一步:双击打开需要增加自增属性的表，找到该表最大的一个ID值，比如下图，该表最大ID值为51.</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1d11a2a9483a5b77d7f3b5f74e6c268d" alt="" /></p>
<p>第二步：右键点击需要增加自增属性的表，点击设计表。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/66c0b97e574e59555f3683d1371d144d" alt="" /></p>
<p>第三步：打开设计表后，在栏位处，将自增属性勾选上。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/33bb747df558cf9360bcb9f16966a44a" alt="" /></p>
<p>第四步：点击选项，在自动递增那一行里填入刚刚第一步查询到的最大ID值+1，这里即52，最后点击保存即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3055e812f5142171632736970a7b72fd" alt="" /></p>
<h3>2、3手动删除ID为0的值</h3>
<p>主要查看以下表：
vehicledevice、devicefile、vehiclefile、sim、roleinfo、userinfo、registlogin、userconfig、userflowset、userflowsetlog、groupinfo、moduleinfo、modulepower、commandinfo、commandpowr</p>
<p>（1）连接数据库
参考http://jfwiki.streamax.com:7503/web/#/172/1329 的方法二进入数据库</p>
<p>（2）双击打开需要检查的表，如果出现第一行的ID为0，选择那一行，点击删除记录即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b9ea1a60f212cda32386d8611ea9dce6" alt="" /></p></div><h3>13.2.1.2、无法查询角色和用户</h3><div style="margin-left:30px;"><h1>无法查询角色和用户</h1>
<h2>原因</h2>
<p>服务器升级后还原了旧版本的数据，由于表结构产生了变化，导致还原的视图异常。</p>
<hr />
<h2>如何排查</h2>
<h5>1、进入服务器目录CMS Server/WCMS5/root/logs，找到app.log文件并打开，查看最近的一次报错。</h5>
<p>如下图所示，一般会提示以下错误：View 'wcms4.view_userflow' references invalid table(s) or column(s).......，表示wcms4数据库中的view_userflow视图异常。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/29c591bd5e6570923dd251b2e304920b" alt="" /></p>
<hr />
<h5>2、使用navicat连接数据库（请参考http://jfwiki.streamax.com:7503/web/#/172/1330 中的方法二）</h5>
<hr />
<h5>3、进入服务器目录CMS Server/WCMS4，找到wcms4.sql文件并打开，搜索view_userflow，并复制画红框的create那句话。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0458ee4c2bbb6b52c0403f78d1822c0a" alt="" /></p>
<hr />
<p>4、进入navicat后，点击查询--新建查询，将第3步复制的语句粘贴到查询编辑器的输入框，点击运行。如果提示了error，根据提示的错误进行解决，若不会，请联系平台技术支持。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2967a3ee26ddbb668ccebcece56dd5d6" alt="" /></p></div><h3>13.2.1.3、点击角色用户没有显示账号</h3><div style="margin-left:30px;"><h1>进入12056web端后 点击角色用户 没有显示账号</h1>
<h2>问题描述</h2>
<p>打开CEIBA2对应的12056web端后，点击左侧的角色用户，右侧没有显示账号，如下图所示：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/bdb94e71f890cdc25d6855b3b878afbb" alt="" /></p>
<h2>分析</h2>
<p>出现web端数据不能显示的问题，初步猜测多半是数据库的问题，因此接下来到服务器上面去看系统中日志</p>
<h2>解决步骤</h2>
<h2>（进行数据库操作之前先进行备份！！！）</h2>
<h2>（进行数据库操作之前先进行备份！！！）</h2>
<h2>（进行数据库操作之前先进行备份！！！）</h2>
<h3>打开服务器到如下的路径去查看系统日志</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d57ac1f9a0424b2997cd37460b6095e5" alt="" /></p>
<h3>打开后滑倒最底下，发现日志中记录着如下的错误</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9fe626d0a8e525a0623abfa55ad819de" alt="" /></p>
<h4>由此可以得出是由于数据库里面的视图出现了错误的原因，使用NaviCat打开数据库，删除wcms4.0数据库中的三张视图，它们分别是：view_flowplus、view_userflow。</h4>
<h4>打开D:\Program Files (x86)\CMS Server\WCMS4.0路径下的wcms4.sql文件，按下ctrl+f键搜索关键字view，找到我们刚刚删除的三张视图：</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/16c411fe8bf37c8fbd51c352675f7a3e" alt="" /></p>
<h3>复制下面的创建视图的语句，到NaviCat里面去执行，如下图所示：</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f44161d590f37f7673c6773cce617161" alt="" /></p>
<h3>执行完三张表的操作后重启MySQL服务即可。最后登陆服务器IP：12056网站进行验证即可。</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/897d6bbfb143f63c7a5f3ce61c36ea9f" alt="" /></p></div><h3>13.2.1.4、添加角色或添加用户提示服务器错误</h3><div style="margin-left:30px;"><h1>添加角色或添加用户提示服务器错误</h1>
<h2>1、查看CMS Server/WCMS5/root/log/app.log的日志。</h2>
<h2>例1：</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5e7425f468ee10dd5041bb1ef40e2550" alt="" />
提示Duplicate entry ‘0’ for key ’PriMary‘。
这种是属于数据库的部分数据表自增属性丢失，需要把ID为0的数据删掉，然后点击设计表，将自增属性勾上，并且在选项一栏输入下一个应该添加的数字。如果数据表删除0之后是空的，那么填入1就可以。</p>
<p>以下是相关联的一些表。
添加用户提示服务器错误：roleinfo、userinfo、registlogin、userconfig、userflowset、userflowsetlog
添加角色提示服务器错误：moduleinfo、modulepower、commandinfo、commandpowr
添加车辆提示服务器错误：vehicledevice、devicefile、vehiclefile、sim</p>
<p>具体操作如下：</p>
<p>（1）使用navicat进入数据库。
参考以下FAQ：</p>
<p>（2）这里以vehicledevice表为例，双击vehicledevice，展示出表的具体信息。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b15ef5d98801e0746b2e36691b8c6339" alt="" /></p>
<p>（3）发现第一个ID为0，选中后，点击右键，选择删除记录即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/93d41dcecc5f9b386d9d85cb9d188890" alt="" /></p>
<p>（4）然后再次选择vehicledevice表，右键点击，选择设计表。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/798741621f5ce5359b16ece6f9bdf046" alt="" /></p>
<p>（5）自动递增属性如果没有勾上的需要勾上。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/482eabcb63181a3986670c546a1214a3" alt="" /></p>
<p>（6）最后填入下一个自动递增的值，点击保存。</p>
<p>双击vehicledevice可以看到，最后一条记录的ID为364，
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a2d74ffcb885dd853ebbe4173a1a95f5" alt="" /></p>
<p>在设计表--选项，自动递增这里，需要填入364的下一个值，即365，最后点击保存即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f8d48ea01d37ef8cecb6af2cea4305a5" alt="" /></p>
<h2>例2：</h2>
<p><strong>--来自西南战区邓景文</strong></p>
<h3>现象：</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4b0b5589a9530b0090a5deb10722c387" alt="" /></p>
<h3>排查过程与解决方法：</h3>
<h4>1、查看服务器的CMS Server/WCMS5/root/log/app.log的日志。</h4>
<p>日志表示userflowset表由于islimit字段缺失，导致无法写入数据。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7ab2a36738327a6ef268eae645436373" alt="" /></p>
<h4>2、重建userflowset表</h4>
<h5>2、1备份userflowset表：可以用navicat将userflowset表转储SQL语句，或者复制表</h5>
<h5>2、2查找初始化脚本E:\CMS Server\WCMS4.0下的wcms4.sql针对userflowset表的初始化sql语句</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/98cf0f57e7f367070777d3d0a63edf0c" alt="" /></p>
<blockquote>
<p>注意：有一个UserFlowSet表，大小写不同，但是不是同一个表，不要查找错了</p>
</blockquote>
<h5>2、3使用navicat，查询--新建查询，输入userflowset的建表语句</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/89dcc3a5179124836d54056a39614d29" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3ad4813096fd3d48ada9439ed9224299" alt="" /></p>
<h4>3、在web端添加用户验证问题是否解决。</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5df83cbfcb167740ea6c509c3cb8daa5" alt="" /></p></div><h3>13.2.1.5、加车提示车辆已存在</h3><div style="margin-left:30px;"><h2>概述</h2>
<p>用于排查Ceiba2-WEB端添加车辆提示车辆已存在问题
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a1488f2a0e37d6a4da72b5e79eaa4190" alt="" /></p>
<h2>排查流程</h2>
<h4>1）登陆数据库</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/78024a02efdb39dd2bea2d71e5c03078" alt="" /></p>
<table width='100%' class='codestyle'><pre><code class="language-shell">mysql.exe -uroot -pc6l7r8ceacvi2010vs -P3307</code></pre></table>
<h4>2）检查是否存在父组为空的车辆</h4>
<table width='100%' class='codestyle'><pre><code class="language-shell">> use wcms4;
> select * from vehicledevice where groupid not in (select id from groupinfo);</code></pre></table>
<h4>3）修改父组为空的车辆到Center车组下</h4>
<p><code>(操作之前请备份vehicledevice表)</code></p>
<blockquote>
<p>update vehicledevice set groupid=1 where groupid not in  (select id from groupinfo);</p>
</blockquote>
<h4>4) 查看</h4>
<p>WEB查看</p></div><h3>13.2.1.6、导入车辆数据提示失败</h3><div style="margin-left:30px;"><h1>问题现象</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f4bdd23a21dd9cabaebc2a8f27973dbe" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7095138ff168b23560cd4179de511245" alt="" /></p>
<h1>问题原因</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6ab7bbee551b42600f5ef7c2f8f68f60" alt="" />
空格需要用*填充</p>
<p><strong>还有一种原因是：车牌号或者设备ID重复了。</strong></p>
<h1>解决方法</h1>
<p>空格需要用*填充或者检查车牌号和设备ID是否重复。
重试导入即可。 </p></div><h3>13.2.1.7、只知道芯片号想查到车辆信息</h3><div style="margin-left:30px;"><h1>只知道芯片号想查到车辆信息</h1>
<h2>背景信息</h2>
<p>web端只能通过车牌号查询到车辆信息，如果只知道芯片号想查找到车辆信息需要先通过数据库找到车牌号。</p>
<h2>操作方法</h2>
<p>（1）使用navacat连接数据库
参考方法二：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a></p>
<p>（2）点击wcms4数据库，并且点击查询</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/65b12b9df1fa8ea064ee42c9371d037e" alt="" /></p>
<p>点击新建查询</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1ce937e0def83850b8df31607b0b39e6" alt="" /></p>
<p>（3）输入sql语句进行查询，根据需要改变deviceid的值进行查询即可。</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">select * from vehicledevice where DeviceID = "002B101592";</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f00a147e8dad379d5b51aa00a05ec0d3" alt="" /></p></div></div><h2>13.2.2、实时视频</h2><div style="margin-left:0px;"><h3>13.2.2.1、Web端无法查看直通</h3><div style="margin-left:30px;"><h1>Web端无法查看直通</h1>
<h2>背景：客户端正常播放直通视频，Web端直通视频一直处于加载状态</h2>
<p>客户端状态：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5cce3bf55291c0ce41c8713effe18675" alt="" />
Web端状态：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=58e262cc6f16c685dc127cef02a285da" alt="" /></p>
<h2>排查思路：</h2>
<ol>
<li>客户端检查测试端口，服务器查看看门狗服务中其他服务的状态；
端口测试：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e7d35865df3eb3915c500f63deeacb0b" alt="" />
服务检查：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=7041dea08f537303157f2486ecaf5b9e" alt="" /></li>
<li>选择问题车辆查看远程设置
record/Dual stream页面，查看通道码流是否为265；
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b1a59bc483e23a85a26957c3dcde7ab8" alt="" />
当前车辆Web直通功能
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6f9e848048e23263890ae17f04f04db8" alt="" />
可见仅264码流的通道2正常播放
修改通道码流为264格式后，网页播放恢复正常；
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=dfcfea2898de534fe8f4dd6670807a14" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e02a56195d0584415374e17463b8b440" alt="" />
后续操作：
根据服务器版本咨询专家部，当前版本是否支持Web部分265码流直通；</li>
</ol></div><h3>13.2.2.2、客户端某通道实时视频加载</h3><div style="margin-left:30px;"><h1>客户端某通道实时视频加载</h1>
<h3>问题背景：</h3>
<p>客户端上观看直通视频某通道处于一直加载的状态，但是Web以及App能正常观察通道直通，客户端设备回放中也能正常查阅该通道视频；</p>
<table width='100%' class='codestyle'><pre><code>Web</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=23fcd1077d52f2720ab77077a91ca8cf" alt="" /></p>
<table width='100%' class='codestyle'><pre><code>客户端</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=4c2e0065b3e344af350b41c293fa4cc0" alt="" /></p>
<h3>排查过程：</h3>
<p>Web页面打开设备通道编辑，发现出问题的通道命名结尾有很多空格，删除末尾空格并保存后客户端通道直通恢复正常；</p>
<blockquote>
<p>客户端需重新登录，发现闪退请重新安装服务器对应客户端</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6c111abbf92e4b4eb5dc51fac732d596" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=78fd46cca61c0df21a0cd74b9e8c4f46" alt="" /></p></div><h3>13.2.2.3、WIN11系统下打开视频闪退</h3><div style="margin-left:30px;"><h2>一、背景</h2>
<p>在win10系统下打开CB2客户端视频无异常，在win11系统下打开CB2客户端视频就会出现闪退；
其原因是由于只在win10环境下测试过，没有在win11环境下测试过；</p>
<h2>二、临时解决步骤</h2>
<p>找到客户端此目录</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2674c0fae1457637c0f12d670cedc4cb" alt="" /></p>
<p><code>将set.ini的渲染模式由d3d为gdi，drawmode改为1；</code></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=ae3494d2ff7b595d9a1cd1449b56d99b" alt="" /></p></div></div><h2>13.2.3、设备回放</h2><div style="margin-left:0px;"><h3>13.2.3.1、Web端无法查看远程回放</h3><div style="margin-left:30px;"><h1>无法查看远程回放</h1>
<h2>（1）8090端口是否正常映射和监听。</h2>
<p>参考以下FAQ检查8090端口是否监听：<a href="http://jfwiki.streamax.com:7503/web/#/172/1286">http://jfwiki.streamax.com:7503/web/#/172/1286</a>
参考以下FAQ检查8090端口是否映射：<a href="http://jfwiki.streamax.com:7503/web/#/172/1301">http://jfwiki.streamax.com:7503/web/#/172/1301</a></p>
<h2>（2）设备的媒体服务器ip和媒体端口是否正常填写。</h2>
<p>参考以下FAQ检查媒体IP和媒体端口是否填写正常：<a href="http://jfwiki.streamax.com:7503/web/#/172/1297">http://jfwiki.streamax.com:7503/web/#/172/1297</a></p>
<hr />
<h2>例1：</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5bf5c990d4c113f0f425780b70043cca" alt="" /></p>
<h2>排查过程</h2>
<h3>1、使用360浏览器打开web端的历史回放，按F12，查看网络情况。</h3>
<p>发现请求的8090端口，返回了一个“404 not found”</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3a0d142765926bf1206960c367a8c5d6" alt="" /></p>
<h3>2、排查8090端口是否正常监听</h3>
<p>在自己的电脑上打开cmd，telnet 服务器地址 8090端口，本次这台服务器telnet是通的。
但是进入服务器后，netstat - ano|findstr 8090 ,却没有看到建立的连接。
由此可得知，外网的8090端口 并不是对应的内网的8090端口，判断为客户映射错误。
确认后，的确是端口映射问题。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/755b6657563d185e310c1cd89d7f3eb3" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4f98f784a230b3bf6eac208eed47d627" alt="" /></p>
<h3>3、打开设备远程设置检查媒体IP和媒体端口是否填写正确</h3>
<p>打开此服务器的远程回放，均黑屏，打开远程设置查看，媒体服务器地址填写错误，更正后客户端可以正常查看远程回放。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/89791de90ee77cda7b3b9e84f59aee72" alt="" /></p>
<h3>最后</h3>
<p>联系客户更换了端口，且远程回放端口改为8091，内网的8091映射到对应的8091，检查正常。
打开服务器上的网络配置工具，将8090修改为8091，点击修改配置，重启所有服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8fdeec334b029f4e288131043f7bc79a" alt="" /></p>
<h3>验证</h3>
<p><strong>如果修改了默认的远程回放端口8090，验证web端查看远程回放的时候请一定要重新登录客户端！！！！否则一直都返回的以前未修改的端口！！！！</strong></p></div><h3>13.2.3.2、web端下载的远程回放点击file list无响应</h3><div style="margin-left:30px;"><h1>web端下载的远程回放点击file list无响应</h1>
<h2>1、操作背景</h2>
<p>进入web端，点击回放，找到在线的设备选择对应的日期，下载一段时间的回放视频，下载完成后点击右上角的file list</p>
<h2>2、解决方法</h2>
<p>（1）进入服务器,进入文件夹<strong>CMS Server/WCMS5/root/controllers/api/basic</strong>,打开index.js,查找关键字“fs.rename”,若存在“fs.rename”，则将其改为“fs.renameSync”</p>
<p>(2)进入文件夹<strong>CMS Server/WCMS5/root/controllers/play-back/video-track</strong>,打开index.js,查找关键字“fs.rename”,若存在“fs.rename”，则将其改为“fs.renameSync”</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a70596350163c7e26016f96746bd5c91" alt="" /></p>
<p>(3)修改完毕后重启WCMS5服务</p></div><h3>13.2.3.3、Web端Https无法查看回放</h3><div style="margin-left:30px;"><h1>web端无法查看回放</h1>
<h2>一、背景</h2>
<p>客户使用了https代理，访问回放仍旧是使用的8090端口，且端口处于正常监听状态。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/994505e1ea379ad7e0f814a970901360" alt="" /></p>
<h2>二、排查过程与解决方法</h2>
<h3>1、不使用https代理访问回放</h3>
<p>经过验证，发现如果不使用https代理点击web端的回放，是可以正常查看的。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cedb555bdbb59a906a383b9c9e848adc" alt="" /></p>
<h3>2、若是使用https，则8090需要代理</h3>
<p>（1）进入CMS Server/nginx/conf，打开nginx.conf，新增一个8090端口的代理，比如使用8091去代理8090。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fc1e47aacd918b37f20267b7715b42be" alt="" /></p>
<p>（2）进入CMS Server\WCMS5\root\config，打开app.json，将里面的8090端口改成被代理的端口，比如8091。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9f48cc3168dc2b08cba29f10dcd70f16" alt="" /></p>
<p>（3）映射8091端口，重新登录web端即可。</p></div><h3>13.2.3.4、web端回放无法下载</h3><div style="margin-left:30px;"><h1>web端回放无法下载</h1>
<h2>一、现象</h2>
<p>返回nodata或者一直处于waiting状态。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/24848c2082398ae555c8e6dd746ff802" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/aae71ff02590a9debf017df64e2a1cc3" alt="" /></p>
<h2>二、解决方法</h2>
<h4>（1）打开客户端的自动下载，Max Connections的连接数必须要大于第二处红框的连接数，如果两处的数目一致，则没有空余的连接数分配到下载.</h4>
<p>建议都将第一处改为10，第二处改为5.</p>
<p>如果客户端打开自动下载一直处于加载中，可能是客户端不匹配，找到匹配的客户端打开即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/00d037c881f8faac6f1849f6c95f6432" alt="" /></p>
<h4>（2）但可能有部分服务器的客户端打开自动下载后是空的，如下图所示。</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2fdfdc393c70b74ef586afdafd082900" alt="" /></p>
<p>这种是属于磁盘检测失败导致或者BaseDataServer服务没有启动。</p>
<p>如果磁盘检测失败，可以到CMS server\TransmitServer\AdsServer\CheckDisk下，运行ADS.CheckDiskPath.exe。</p>
<p>如果basedataserver没有启动，请参考以下FAQ处理：<a href="http://jfwiki.streamax.com:7503/web/#/172/1338">http://jfwiki.streamax.com:7503/web/#/172/1338</a>
如果出现没有保存按钮请使用最高权限账户登录
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=1598145a3f9d7edc672aa63bc15796e9" alt="" /></p></div><h3>13.2.3.5、Web回放显示Flash Player错误</h3><div style="margin-left:30px;"><h2>问题背景：</h2>
<p>Web端打开设备回放，视频播放部件无法正常加载
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=800afc85198d9343e3b4ed19ea7cd068" alt="" /></p>
<h2>原因分析：</h2>
<p>老版本的web是用flash打开视频的，导致在flash部件缺失的情况下，无法打开设备回放功能</p>
<h2>解决方法：</h2>
<h3>1. 修改两个配置文件字段，将<code>flash</code>改为<code>html5</code></h3>
<table width='100%' class='codestyle'><pre><code>C:\Program Files (x86)\CMS Server\WCMS5\root\public\play-back\video-track\script</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=dae2eb6f894acfeb7dd41135525683bf" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b7b43e4ebf1aeee23fd5239190940800" alt="" /></p>
<table width='100%' class='codestyle'><pre><code>C:\Program Files (x86)\CMS Server\WCMS5\root\public\monitor\map-video\script</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=9af3289d839cac999554099f77292a33" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6fe91f1bb59191ca353f6acaad408af5" alt="" /></p>
<h3>2. 重启WCMS5服务</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=10bed26d36fd1f44ec946eec45b81170" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=fb474d4421c39437ba57d6b9b0d7c4c3" alt="" /></p></div><h3>13.2.3.6、批量修改设备通道</h3><div style="margin-left:30px;"><h2>批量修改设备通道</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=51b8acda38cef652f72af51d6e32c52a" alt="" /></p>
<h2>1. 连接数据库</h2>
<p>参考：<a href="http://jfwiki.streamax.com:7503/web/#/172/1290">http://jfwiki.streamax.com:7503/web/#/172/1290</a></p>
<h1>进行数据库操作前请备份</h1>
<h2>2. 打开wcm4数据库新建查询</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=1c54c2349d39dd9bd32cf8509d23b86c" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=92d9b8bf30418847e7a9c0070cf73abf" alt="" /></p>
<table width='100%' class='codestyle'><pre><code class="language-shell">sql语句

UPDATE devicefile SET ChannelCount=6 WHERE  VehicleDeviceID in (SELECT ID FROM vehicledevice WHERE DeviceID in ('00B000013E','00B000002E'))</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=0506f9af83376eaee8466cd374d6c72b" alt="" /></p>
<p>终端号之间间隔<code>','</code>英文符号</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=006d9b463daca87f188895863708a2e3" alt="" /></p>
<p>终端设备号就是车辆设备号，在这个页面上需要修改的车辆的终端设备号填写到mysql语句最后，要用英文的逗号隔开</p>
<h2>3. 运行查询语句</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b99458762017d07de162a5825a2ec190" alt="" /></p></div></div><h2>13.2.4、远程升级</h2><div style="margin-left:0px;"><h3>13.2.4.1、使用远程升级创建了任务但是找不到任务</h3><div style="margin-left:30px;"><h1>使用远程升级创建了任务但是找不到任务</h1>
<h2>一、现象</h2>
<p>创建了任务但是没有任务存在</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d0f761eabf5de5f6eab8c76a08100af2" alt="" /></p>
<h2>二、排查与解决方法</h2>
<h3>2、1查看日志</h3>
<p>打开CMS Server/WCMS5/root/logs/app.log，提示没有这个content字段。</p>
<blockquote>
<p>怀疑是服务器升级还原数据的时候有表是使用的旧版本的表结构。</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c0df2ed04f5101bb8ab29db1eb4fe690" alt="" /></p>
<h3>2、2查看初始化sql文件</h3>
<p>打开CMS Server/WCMS4.0/wcms4.sql,搜索Content，发现DeviceUpgrade表里面有这个字段。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/dbe62c1250f998d62f5859c3ee8cea9d" alt="" /></p>
<h3>2、3连接数据库，查看DeviceUpgrade表结构</h3>
<p>参考以下的FAQ 方法一连接数据库：<a href="http://jfwiki.streamax.com:7503/web/#/17/96">http://jfwiki.streamax.com:7503/web/#/17/96</a></p>
<p>进入到数据库以后，执行以下命令：</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">use wmcs4;
desc DeviceUpgrade;</code></pre></table>
<p>观察使用desc DeviceUpgrade的结果是否与2.2查询出来的DeviceUpgrade结构一致。</p>
<p>如果没有发现Content字段，请执行2.2打开的wcms4.sql里面的DeviceUpgrade语句。
以下也是在数据库里面执行：
比如：</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">DROP TABLE IF EXISTS DeviceUpgrade;
CREATE TABLE DeviceUpgrade (
   ID int(11) NOT NULL PRIMARY KEY AUTO_INCREMENT,
   VehicleDeviceID  int(11) NOT NULL,
   State int(11) DEFAULT NULL,
   ErrorCode int(11) DEFAULT NULL,
   Progress decimal(10) DEFAULT NULL,
   Version varchar(50) DEFAULT NULL,
   UpgradeTime DateTime DEFAULT NULL,
   Level int(11) DEFAULT NULL,
   LastVersion varchar(50) DEFAULT NULL,
   LastUpgradeTime DateTime DEFAULT NULL,
   DeviceUpgradeTaskID int(11) DEFAULT NULL,
   Content text DEFAULT NULL
)ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</code></pre></table>
<p>执行完毕后，再次新建任务已经正常了。</p></div></div><h2>13.2.5、报表</h2><div style="margin-left:0px;"><h3>13.2.5.1、报警报表报警类型导出失败</h3><div style="margin-left:30px;"><h1>现象</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1619160d606755a7edb5b82115b6bdc0" alt="" /></p>
<h1>排查</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cd40e4ddc573d0e5b7461f88523ff194" alt="" /></p>
<h1>解决</h1>
<p>历史问题，有补丁，参考如下
<a href="http://jfwiki.streamax.com:7503/web/#/172/1374">http://jfwiki.streamax.com:7503/web/#/172/1374</a></p></div></div><h2>13.2.6、其他</h2><div style="margin-left:0px;"><h3>13.2.6.1、访问12055网页提示Server Error in ‘/’Application.</h3><div style="margin-left:30px;"><h1>访问12055网页提示Server Error in ‘/’Application</h1>
<h2>现象</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f975a3facfbf3e7380f5fbfedc820e97" alt="" /></p>
<h2>排查过程与处理方法</h2>
<p>（1）进入服务器，进入CMS Server/WCMS4.0，打开Web.config.</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7842d49062df61680e64e12ee4979bc3" alt="" /></p>
<p>改成如下图所示</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1630a1d1706ca3fcc0303c9419c53816" alt="" /></p>
<p>（2）重启Apache2.2服务</p>
<p>（3）再次从本地服务器的浏览器进入http://127.0.0.1:12055 ,观察是否报错。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/714df6c1c423915769f5673cf79075c5" alt="" /></p>
<p>（4）根据提示到对应的文件夹下建立Temporary ASP.NET Files文件夹即可。</p></div><h3>13.2.6.2、修改admin通道数</h3><div style="margin-left:30px;"><h1>修改admin通道数</h1>
<h2>解决方法</h2>
<p>在web端无法修改admin账号的通道数，必须进入数据库才可以正常修改。</p>
<p>1、连接数据库，参考以下faq的方法二进入数据库：<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a></p>
<p>2、双击wcms4数据库，点击查询--新建查询</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/497c7c614e935eb5f4e9dea46cf1e8db" alt="" /></p>
<p>3、将userconfig表的chncount改成64即可。</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">UPDATE userconfig SET chncount = 64 WHERE id = 1;</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b137efada249a8734330746f9e255a1c" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ca4513538ff81de03d52cb1a9cdc5249" alt="" /></p></div></div><h2>13.2.7、API调用</h2><div style="margin-left:0px;"><h3>13.2.7.1、https请求API错误</h3><div style="margin-left:30px;"><h1>https请求API错误</h1>
<h2>1. 问题背景</h2>
<p>客户的服务器安装了HTTPS的SSL证书，使用http请求数据没有问题，使用https请求数据，就请求不到</p>
<h3>1.1 采取<code>http//:ip:端口</code>有正确响应内容</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=faa277ede640e7c0f0814719e2a92688" alt="" /></p>
<h3>1.2 采取<code>http//:ip:端口</code>无响应内容</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b7a11a63ffd07681eff49dbd0f339c26" alt="" /></p>
<h1>2. 排查与解决方法</h1>
<h3>2.1 解决前提</h3>
<p>确认服务器版本，确保https服务已经成功安装部署，相关端口已经打开。</p>
<blockquote>
<p>且持有有效HTTPS的SSL证书</p>
</blockquote>
<h3>2.2 解决思路</h3>
<p>将api调用中的ip地址，换成域名，采取<code>https//:域名:端口</code>，以得到正确响应内容
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=33309e1c533685620d436b96fade0e9a" alt="" /></p></div></div></div><h2>13.3、客户端--App</h2><div style="margin-left:20px;"><h3>13.3.1、安卓手机登录CB2app后无回放按钮</h3><div style="margin-left:0px;"><h1>安卓手机登录CB2app后无回放按钮</h1>
<h1>1、现象</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8b493fa7bd146a9e50b1406bded58baf" alt="" /></p>
<h1>2、解决方法</h1>
<p>（1）进入服务器，参考http://jfwiki.streamax.com:7503/web/#/17/96 进入数据库。</p>
<p>（2）进入数据库后，找到这四张表commandpower、commandinfo、moduleinfo、modulepower，右键点击该表，选择“复制表”即为备份。</p>
<p>（3）点击查询--新建查询，执行以下sql语句即可。</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">insert into commandinfo(code) select '303-2' from DUAL where not exists(select code from commandinfo where code='303-2');   
insert into commandpower(roleid,ccode) select 1,'303-2' from DUAL where not exists(select ccode from commandpower where ccode='303-2' and roleid=1);  
insert into commandinfo(code) select '306-1' from DUAL where not exists(select code from commandinfo where code='306-1');   
insert into commandpower(roleid,ccode) select 1,'306-1' from DUAL where not exists(select ccode from commandpower where ccode='306-1' and roleid=1);  
insert into commandinfo(code) select '301-10' from DUAL where not exists(select code from commandinfo where code='301-10');   
insert into commandpower(roleid,ccode) select 1,'301-10' from DUAL where not exists(select ccode from commandpower where ccode='301-10' and roleid=1);  
insert into commandinfo(code) select '301-4' from DUAL where not exists(select code from commandinfo where code='301-4');   
insert into commandpower(roleid,ccode) select 1,'301-4' from DUAL where not exists(select ccode from commandpower where ccode='301-4' and roleid=1);  
insert into commandinfo(code) select '302-1' from DUAL where not exists(select code from commandinfo where code='302-1');   
insert into commandpower(roleid,ccode) select 1,'302-1' from DUAL where not exists(select ccode from commandpower where ccode='302-1' and roleid=1);

insert into moduleinfo(code) select '303' from DUAL where not exists(select code from moduleinfo where code = '303');  
insert into modulepower(roleid,mcode) select 1,'303' from DUAL where not exists(select mcode from modulepower where mcode = '303' and roleid=1);  
insert into moduleinfo(code) select '314' from DUAL where not exists(select code from moduleinfo where code = '314');  
insert into modulepower(roleid,mcode) select 1,'314' from DUAL where not exists(select mcode from modulepower where mcode = '314' and roleid=1);  
insert into moduleinfo(code) select '306' from DUAL where not exists(select code from moduleinfo where code = '306');  
insert into modulepower(roleid,mcode) select 1,'306' from DUAL where not exists(select mcode from modulepower where mcode = '306' and roleid=1);  
insert into moduleinfo(code) select 'G' from DUAL where not exists(select code from moduleinfo where code = 'G');  
insert into modulepower(roleid,mcode) select 1,'G' from DUAL where not exists(select mcode from modulepower where mcode = 'G' and roleid=1);  
insert into moduleinfo(code) select '312' from DUAL where not exists(select code from moduleinfo where code = '312');  
insert into modulepower(roleid,mcode) select 1,'312' from DUAL where not exists(select mcode from modulepower where mcode = '312' and roleid=1);  
insert into moduleinfo(code) select '308' from DUAL where not exists(select code from moduleinfo where code = '308');  
insert into modulepower(roleid,mcode) select 1,'308' from DUAL where not exists(select mcode from modulepower where mcode = '308' and roleid=1);  
insert into moduleinfo(code) select '309' from DUAL where not exists(select code from moduleinfo where code = '309');  
insert into modulepower(roleid,mcode) select 1,'309' from DUAL where not exists(select mcode from modulepower where mcode = '309' and roleid=1);  
insert into moduleinfo(code) select 'I' from DUAL where not exists(select code from moduleinfo where code = 'I');  
insert into modulepower(roleid,mcode) select 1,'I' from DUAL where not exists(select mcode from modulepower where mcode = 'I' and roleid=1);</code></pre></table></div><h3>13.3.2、登录失败</h3><div style="margin-left:0px;"><h1>登录失败</h1>
<p>如果app登录失败，一般客户端也会登录失败，先查看下客户端登录失败的faq排查下</p>
<p><a href="http://jfwiki.streamax.com:7503/web/#/172/1293">http://jfwiki.streamax.com:7503/web/#/172/1293</a></p></div></div><h2>13.4、服务器</h2><div style="margin-left:20px;"><h2>13.4.1、服务异常</h2><div style="margin-left:0px;"><h3>13.4.1.1、【通用】服务启动失败</h3><div style="margin-left:30px;"><h1>服务启动失败通用解决方法</h1>
<h2>1、端口被占用导致服务无法启动</h2>
<p>xxxx为第一步查询到的pid号，如下图所示。</p>
<table width='100%' class='codestyle'><pre><code>netstat -ano | findstr 端口
taskkill /f /pid xxxx</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5c960be0ffbbfdc359e4d6adb5daa9bc" alt="" /></p>
<h2>2、缺失dll文件导致的服务无法启动</h2>
<h5>1）    首先打开任务管理器，选择服务，点击右下角的服务，如图3.2.1.1所示。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f1bb4e6e3b18bb323b41b55c07730881" alt="" /></p>
<h5>2）    点击打开后，找到无法启动或者频繁重启的服务，右键选择属性打开，可以查看到可执行文件路径的目录，如图3.2.1.2所示。进入该目录，双击运行对应程序的exe文件，如果提示缺失某某dll文件，请到正常的服务器相同版本的对应目录下找到拷贝到缺失的服务器上即可。</h5>
<p>例：EvidenceAnalyService启动失败，
查看到该服务的可执行文件路径如下：
E:\Program Files (x86)\CMS Server\TransmitServer\EvidenceAnalyService\EvidenceAnalyService.exe</p>
<p>那么进入E:\Program Files (x86)\CMS Server\TransmitServer\EvidenceAnalyService目录下，
双击运行EvidenceAnalyService.exe该应用程序，会提示缺失文件的错误，如图3.2.1.3所示。</p>
<p>然后从同版本的别的服务器的CMS Server\TransmitServer\EvidenceAnalyService目录下，拷贝相应文件到提示错误的服务器上即可。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/54c6ba568e5dfc705923be3d5214ec9d" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2097a834eb1d910ddce175a684ca4772" alt="" /></p></div><h3>13.4.1.2、多个服务启动失败</h3><div style="margin-left:30px;"><h1>多个服务启动失败</h1>
<h2>1、服务器上的.NET3.5环境未安装。</h2>
<p>未安装请打开控制面板—启用或关闭 Windows功能—在功能界面选择.NET3.5—点击安装即可。若安装失败，可以到微软官网下载离线安装包进行安装，百度搜素微软官网.NET3.5。
详细操作请参考服务器部署系统准备文档：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1280">http://jfwiki.streamax.com:7503/web/#/172/1280</a></p>
<h2>2、Mysql未初始化</h2>
<h3>现象：</h3>
<p>Mysql5.5正常运行，但AlarmService、OnlineServer等处于停止状态</p>
<p>在网络配置工具里面点击修改配置会提示”数据库端口错误：3307“</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6cd677d2942c23a0d94dd3c51e7194f5" alt="" /></p>
<h3>问题原因与解决版本</h3>
<h4>原因1：数据库未初始化导致。 　<font color='red'> 仅限于刚安装服务器出现的大批量服务停止的情况！！！！ </font></h4>
<p>未初始化的标志：进入CMS Server/Mysql5.5/data，查看是否有WCMS4文件夹，如果没有那么就是未初始化。</p>
<h4>解决方法1：</h4>
<p>请参考以下文档的链接对数据库进行初始化：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1666">http://jfwiki.streamax.com:7503/web/#/172/1666</a></p>
<h4>原因2：。</h4>
<p>数据库已初始化，排查使用场景，客户是在使用过程中突然服务功能异常，数据库未初始化一般存在在服务器部署后出现的现象，通过命令行进入mysql5.5的bin中登录数据库，提示报错：too many connects，查看数据库端口连接情况，发现将近400个连接，通过pid查看对应服务为tomcat，该服务存在于262旧版本，现已被优化，初步判断原因为数据库连接数超出最大连接数，修改对应配置文件，修改对应最大连接数为1024后，任务管理器单独重启mysql5.5；观察看门狗服务中，各个服务的运行情况，正常情况为各个服务依次启动问题解决；
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=a7861819f48e17b026f8fee1438a2386" alt="" /></p>
<h4>解决方法2：</h4>
<p>数据库连接数超过最大连接数，修改对应配置文件；
请参考以下文档的链接命令行登入数据库：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1666">http://jfwiki.streamax.com:7503/web/#/172/1666</a></p>
<h2>3、Mysql密码变更导致</h2>
<p>参考以下FAQ还原Mysql的密码：<a href="http://jfwiki.streamax.com:7503/web/#/172/1330">http://jfwiki.streamax.com:7503/web/#/172/1330</a></p>
<p>然后打开网络配置工具，点击修改配置即可。</p></div><h3>13.4.1.3、数据库端口错误:3307</h3><div style="margin-left:30px;"><h1>数据库端口错误:3307</h1>
<h2>现象：</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b9d287a1821b2f304292c8b14358bf70" alt="" /></p>
<h2>原因：</h2>
<p>数据库未初始化或者数据库密码错误。</p>
<h2>解决方法</h2>
<p>参考此FAQ处理的第二点或者第三点处理：<a href="http://jfwiki.streamax.com:7503/web/#/172/1334">http://jfwiki.streamax.com:7503/web/#/172/1334</a></p></div><h3>13.4.1.4、DVRGTService（转发服务）启动失败</h3><div style="margin-left:30px;"><h1>DVRGTService（转发服务）启动失败</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6acde4e886f6100a9f209b52bdf0f107" alt="" /></p>
<h2>1、授权文件过期</h2>
<p>（1）进入CMS Server/TransmitServer，双击DVRGTService.exe运行，提示以下信息即表明授权文件过期。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c6003e63ae7d385930ac83e855b114f1" alt="" /></p>
<p>（2）替换当前目录下的授权文件即可，以下为2022年的授权文件，点击下载即可。</p>
<p><a href="http://jf.streamax.com:8081/f/d05f99a218f04f828a8c/?dl=1">http://jf.streamax.com:8081/f/d05f99a218f04f828a8c/?dl=1</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=cd1d197827c850caa23a81c20fd9f808" alt="" /></p>
<h2>2、运行DVRGTService.exe提示load lib ProviderRmCMS.dvrplus fail</h2>
<p>盗版系统导致</p></div><h3>13.4.1.5、MongoDB3.2启动失败</h3><div style="margin-left:30px;"><h1>MongoDB3.2</h1>
<p>（1）检测服务器版本是否为2008 R2 Enterprise版本，下载SP1补丁安装，具体信息请百度“2008R2 SP1补丁”下载安装即可。</p>
<p>（2）检查CMS Server\mongodb_3.2\mongodb.conf 文件中的路径是否与实际路径一致，以及检查是否存在db文件夹与MongoDB.log这两个文件。</p>
<p>(3)检查硬盘剩余空间，若剩余空间没有内存大，建议清理一些数据（比如日志信息等）。</p>
<p>(4)可以使用修复语句修复。执行前，mongo需要处于停止状态，且需要重命名db文件夹下的mongo.lock文件。进入cmd界面，执行以下内容（注意路径需要修改为服务器对应的路径）：</p>
<table width='100%' class='codestyle'><pre><code>cd /d "C:\Program Files (x86)\CMS server\mongodb_3.2\bin"</code></pre></table>
<p>再执行：</p>
<table width='100%' class='codestyle'><pre><code>mongod --config "C:\Program Files (x86)\CMS Server\mongodb_3.2\mongodb.conf"  --repair</code></pre></table>
<blockquote>
<p>注意：如果执行修复语句闪退，则不证明无法修复，请查看第5点。
若一直在修复界面，则表示可以修复，修复时间较长，请耐心等待。</p>
</blockquote>
<p>（5）询问客户是否需要GPS文件、证据记录、报表里面的数据，如果需要，请联系研发处理；</p>
<p>如果不需要GPS文件，进行以下操作：
A.进入CMS server\mongodb_3.2\data目录下，将db文件夹重命名为db1。
B.在当前路径下新建一个db的文件夹。
C.观察服务是否启动</p></div><h3>13.4.1.6、BaseDataServer启动失败</h3><div style="margin-left:30px;"><h1>BaseDataServer启动失败</h1>
<h2>例1：</h2>
<p>（1）排查日志发现了JDBC连接失败的问题，怀疑是连接数据库异常，重启数据库无效。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3127308e1710ba0bbc7653e8af279fd7" alt="" /></p>
<p>（2）basedataserver是一个由java写的服务，但是在文件夹中不曾看到jdk1.8文件夹，判断是确实java环境导致无法启动服务，将jdk1.8的压缩包拷贝到服务器上并解压。</p>
<p>压缩包链接如下：<a href="http://jf.streamax.com:8081/f/99a4b1f883ff4509b352/?dl=1">http://jf.streamax.com:8081/f/99a4b1f883ff4509b352/?dl=1</a></p>
<p>最后重启该服务即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/69e18f01a347a64f5810f093a32eeaca" alt="" /></p>
<h2>例2：</h2>
<p>（1）进入到CMS Server\TransmitServer\BaseDataServer目录下
输入cmd后回车进入到命令行界面。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0a7d14346c0e185461081454077da470" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7dc4e344ffc1488c57881c56d125c1ab" alt="" />
输入uninstall.bat，然后回车，执行卸载命令
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/33ff9becca24f7f649e381e4a6a0e837" alt="" /></p>
<p>（2）卸载完成后，在输入install.bat,然后回车，执行安装命令。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ca37d9358281a403dabd917b740448b1" alt="" /></p>
<p>（3）然后再次观察服务是否正常启动。</p>
<h2>例3：</h2>
<p>（1）basedataserver/bin目录下缺少启动的bat脚本，去别的服务器上拷贝过来即可。</p>
<p>（2）basedataserver/config目录下的配置文件仅为1kb，缺失大量配置文件，去别的服务器上拷贝一份即可。</p></div><h3>13.4.1.7、MessageServer启动失败</h3><div style="margin-left:30px;"><h1>MessageServer无法启动</h1>
<h2>1、端口占用或缺文件</h2>
<p>查看通用问题解决方法链接，该服务器对应的端口为5556。
<a href="http://jfwiki.streamax.com:7503/web/#/172/1333">http://jfwiki.streamax.com:7503/web/#/172/1333</a></p>
<h2>2、检查服务产生的日志或者对应的rpt文件</h2>
<p>（1）rpt文件就在CMS Server/TransmitServer/MessagerServer下，可以找到最近的rpt文件，打开看看是不是与什么dll文件相关，如果提示了某个dll可以尝试备份原来的dll，然后从同版本的另外的服务器上拷贝一份新的过去。</p></div><h3>13.4.1.8、Mysql5.5启动失败</h3><div style="margin-left:30px;"><h1>Mysql启动失败</h1>
<blockquote>
<p>Mysql启动失败，请至CMS Server/Mysql5.5/data下，查看err结尾的错误日志，根据日志提示的信息来解决此问题。</p>
</blockquote>
<h2>1、ibdata文件损坏</h2>
<table width='100%' class='codestyle'><pre><code>InnoDB: The log sequence number in ibdata files does not match
InnoDB: the log sequence number in the ib_logfiles!</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/23240df4c09206d263eee9dd96677aa1" alt="" /></p>
<table width='100%' class='codestyle'><pre><code>可能ibdata文件损坏了

在my.ini里面的[mysqld]下面添加innodb_force_recovery = 4，然后重启动mysql，观察是否能够启动成功。</code></pre></table>
<blockquote>
<p>注意：添加了该命令mysql正常启动后，之后运行添加数据可能出错，建议将数据库恢复过来以后就备份数据重新安装一下，然后还原数据。</p>
</blockquote>
<h2>2、端口被占用</h2>
<p>日志如下：</p>
<table width='100%' class='codestyle'><pre><code>[ERROR] Do you already have another mysqld server running on port: 3306 ?</code></pre></table>
<p>解决方法：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/283c9ed73457724adbac373e3f4ba9d0" alt="" /></p>
<p>输入win+R,输入cmd，进入dos界面。执行以下语句，13328就是第一句查出来的最右边那个值：</p>
<table width='100%' class='codestyle'><pre><code>netstat -ano | findstr 3306
taskkill /f /pid 13328
net start Mysql5.5</code></pre></table>
<h2>3、错误码87</h2>
<p>日志如下：</p>
<table width='100%' class='codestyle'><pre><code>220301  3:21:38 InnoDB: The InnoDB memory heap is disabled
220301  3:21:38 InnoDB: Mutexes and rw_locks use Windows interlocked functions
220301  3:21:38 InnoDB: Compressed tables use zlib 1.2.3
220301  3:21:38 InnoDB: Initializing buffer pool, size = 1.7G
220301  3:21:38 InnoDB: Completed initialization of buffer pool
220301  3:21:38 InnoDB: highest supported file format is Barracuda.
220301  3:21:38  InnoDB: Operating system error number 87 in a file operation.
InnoDB: Some operating system error numbers are described at
InnoDB: http://dev.mysql.com/doc/refman/5.5/en/operating-system-error-codes.html
InnoDB: File name .\ib_logfile0
InnoDB: File operation call: 'aio read'.
InnoDB: Cannot continue operation.</code></pre></table>
<p>进入CMS Server/Mysql 文件夹，打开my.ini，在【mysqld】里面添加一行配置文件，</p>
<table width='100%' class='codestyle'><pre><code>innodb_flush_method=normal</code></pre></table>
<p>如下图所示：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7e00da0c588605921d938bbaf39795ef" alt="" /></p>
<p>添加完成后，保存，去启动Mysql服务。</p></div><h3>13.4.1.9、所有服务未正常启动，提示请安装服务，未知状态</h3><div style="margin-left:30px;"><h1>所有服务未正常启动，提示"请安装服务，未知状态"</h1>
<h2>现象：</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/90f83d9eea920d7ce647afe42cbe3959" alt="" /></p>
<h2>原因：</h2>
<p>启动看门狗服务的时候没有以管理员身份运行导致。</p>
<h2>解决方法</h2>
<p>参考FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1335">http://jfwiki.streamax.com:7503/web/#/172/1335</a></p></div><h3>13.4.1.10、看门狗服务不能正常启动、没有数据显示</h3><div style="margin-left:30px;"><p>[TOC]</p>
<h1>一、案例</h1>
<p>1.看门狗服务正常运行不能显示信息
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ac21d8695467de753dc9a563aae77b96" alt="" />
2.看门狗服务起不来
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5cddc8ebbe140bd57977b28e12a7ae6d" alt="" /></p>
<h1>二、排查步骤</h1>
<h2>2.1 检查配置文件是否正确</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/46d9c868b29d6a0afe2cb8096890e2ba" alt="" /></p>
<h2>2.2 检查配置文件编码是否正确</h2>
<p>UTF-8才是正确编码，可以使用notepad++进行查看</p>
<h2>2.3 排查完后重启看门狗即可</h2></div><h3>13.4.1.11、Apache2.2启动失败</h3><div style="margin-left:30px;"><h1>Apache2.2启动失败</h1>
<h2>1、卸载Apche2.2</h2>
<p>点击看门狗服务，选择服务--点击安装服务器--点击卸载当前服务</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4de5752cd44736c58c5dd8f54615e741" alt="" /></p>
<h2>2、进入Apache2.2/bin目录，执行 gacutil.exe /i "Apache.Web.dll"</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/301a107fe9f286fbf4319d17479fcb4b" alt="" />![]</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f81914633fd8b90ab6fb1cac31802789" alt="" />![]</p>
<h2>3、重新安装</h2>
<p>httpd -k install -n "Apache2.2" -f "配置文件路径"</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/dbff53c0f5abc6ab9436fd7e18897a0a" alt="" /><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/44c0ea24d9fc0e8649c0c7ba0d4ac0da" alt="" /></p></div><h3>13.4.1.12、Redis启动失败</h3><div style="margin-left:30px;"><h1>Redis启动异常</h1>
<h2>解决方法1</h2>
<p>进入服务器CMS Server/TransmitServer/redis_service/data</p>
<p>将dump.rdb文件修改名字后，替换如下文件夹中得dump.rdb文件。
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=a68d52e16a2b414c8de16f0135d123c2" title="[dump文件.zip">dump文件.zip</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8053b2f03e5101e17c2061cde4aee239" alt="" /></p>
<p>之后再次重新启动redis即可。</p>
<blockquote>
<p>注意：该rdb文件里面包含了redis未完成的一些任务，比如当前上传的证据之类的，但重启注册的话应该任务会重新上传。</p>
</blockquote>
<h2>解决方法2</h2>
<p>可能是注册服务还连接着redis，所以要重启注册服务后再启动redis。</p></div><h3>13.4.1.13、ARMSStorgeService/ARMSRestService启动失败</h3><div style="margin-left:30px;"><h1>ARMSStorgeService/ARMSRestService启动失败</h1>
<h3>1、修改服务器对应路径下VersionTime.cfg文件的时间，改为当前的时间，比如2021-01-20 00:00:00</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8d8a4677f9aeccb1d16ed54094c66110" alt="" /></p>
<h4>2、查看Storage的日志</h4>
<h5>2.1若提示以下内容，需要修改注册表的值。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7c951c73bd0b1cd30d2de481c55838e6" alt="" /></p>
<p>注册表：
HKEY_LOCAL_MACHINE\system\CurrentControlSet\Control\Lsa\FipsAlgorithmPolicy
将enable属性设置为0 即可。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/17a6ad9158f1dde022faafde4c4895e2" alt="" /></p>
<h6>2.2若提示以下内容，需要关闭所有的杀毒软件。</h6>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9c25545f308425eb31497031fc6a00da" alt="" /></p>
<p>退出360等杀毒软件</p>
<h6>2.3如果日志提示与27018端口有关，则表示与mongodb服务有关，可以尝试重启mongodb服务。</h6>
<h6>2.4如果日志提示缺少table数据库表。</h6>
<p>案例：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=820cca071ff8e967f2d62cb788aa3c10" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=1b33972a37fb7d27c039837000bc9883" alt="" />
检查数据库文件
参考：<a href="http://jfwiki.streamax.com:7503/web/#/172/1283">http://jfwiki.streamax.com:7503/web/#/172/1283</a></p></div><h3>13.4.1.14、ClientBalance启动失败</h3><div style="margin-left:30px;"><h1>ClientBalance启动失败</h1>
<h2>1、端口占用或缺文件</h2>
<p>查看通用问题解决方法链接，该服务器对应的端口为7264。
<a href="http://jfwiki.streamax.com:7503/web/#/172/1333">http://jfwiki.streamax.com:7503/web/#/172/1333</a></p>
<h2>2、可能是由于连不上mysql导致</h2>
<p>尝试重启mysql5.5、再重启clientbalance试试</p></div><h3>13.4.1.15、WCMS5启动失败</h3><div style="margin-left:30px;"><h1>WCMS5启动失败</h1>
<h2>解决方法：</h2>
<p>（1）进入CMS Server/WCMS5文件夹，先查看nssm.exe是否还存在，如果不存在，请从别的服务器拷贝一个过来。</p>
<p>（2）进入CMS Server/WCMS5文件夹，在此处打开cmd窗口</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7d3179d56823ec1b78aa3f400fea4ecd" alt="" /></p>
<p>（3）执行卸载命令</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/27ee507e59e605d7e369980c63419b40" alt="" /></p>
<p>（4）卸载完成后，再次执行安装命令</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f1296ac15623c3cfab1f285198a57b88" alt="" /></p></div><h3>13.4.1.16、AlarmService服务异常1</h3><div style="margin-left:30px;"><h2>AlarmService服务异常1</h2>
<p>关键词：报警、地图、空白</p>
<h3>问题描述</h3>
<p>1）无报警信息
2）客户端、网页、APP地图空白
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=1a067572b8c9b8e6cbac6ed7f8aed489" alt="" /></p>
<h3>检查服务状态</h3>
<p>运行看门狗程序，检查服务的运行状态；
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=095a2848cdcb80b99e9d12b95b1edeee" alt="" /></p>
<h3>解决方法</h3>
<p>1）替换AlarmService服务通用补丁（排除版本非常老的情况）
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=423152ac5d73b63812b6fee24665ea34" title="[AlarmServer (4).zip">AlarmServer.zip</a>
2）备份原有文件夹与配置文件AlarmService.json（防止后续出现其他问题，进行回退操作）
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=67d226d3608a5366005c12618296c675" alt="" />
ps：
1）建议就把备份放在同级文件夹下，也好追溯是否替换了补丁；
2）备份原有服务文件夹时，先在看门狗中停止守护服务，再停用目标服务后。进行备份与补丁替换；</p></div><h3>13.4.1.17、WCMSWebCenterService服务异常</h3><div style="margin-left:30px;"><h1>问题：WCMSWebCenterService服务启动失败</h1>
<h2>问题现状</h2>
<p>系统日志显示
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=71bb58049f5b5e2477fb5a928a8f0f00" alt="" />
手动启动服务提示
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=796823aac7a3ce1f24a18800e5a45f43" alt="" /></p>
<h2>解决方法：</h2>
<p>查看数据库-wcms4的systemconfig表中的IsAutoSynchronous字段值是否为1，若不等于1，修改后重启对应服务即可</p>
<h2>注意事项：</h2>
<p>mysql数据库端口为：3307
密码可通过查看：..\CMS Server\TransmitServer\HttpSdkService中的HttpSdkConfig.ini 的配置文件</p></div><h3>13.4.1.18、2023年最新授权文件</h3><div style="margin-left:30px;"><h1>DVRGTService（转发服务）启动失败</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6acde4e886f6100a9f209b52bdf0f107" alt="" /></p>
<h2>1、授权文件过期</h2>
<p>（1）进入CMS Server/TransmitServer，双击DVRGTService.exe运行，提示以下信息即表明授权文件过期。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c6003e63ae7d385930ac83e855b114f1" alt="" /></p>
<p>（2）替换当前目录下的授权文件即可，以下为2023年的授权文件，点击下载解压即可。</p>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=6bdb3f46dc0ea657e50d2a0d5a64cd44" title="[2023授权文件.zip">2023授权文件.zip</a>
替换方法：<a href="http://jfwiki.streamax.com:7503/web/#/p/752f8d1f3814f44320756eefb3e8c073">http://jfwiki.streamax.com:7503/web/#/p/752f8d1f3814f44320756eefb3e8c073</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=cd1d197827c850caa23a81c20fd9f808" alt="" /></p>
<h2>2、运行DVRGTService.exe提示load lib ProviderRmCMS.dvrplus fail</h2>
<p>盗版系统导致</p></div><h3>13.4.1.19、AlarmService服务异常2</h3><div style="margin-left:30px;"><h1>AlarmService服务异常2</h1>
<h3>问题背景：报警服务异常重启</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=8f9501a4ae2546f8cfbe7dd738e0a204" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=69715955d30e8140f8d6e1b085c25de4" alt="" />
查看证据服务最新rpt崩溃文件：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=967566291ced52048cbffb31ae8f8978" alt="" /></p>
<h3>结论：报警服务邮件库崩溃，替换90版本补丁解决；</h3>
<p>链接：<a href="http://jfwiki.streamax.com:7503/web/#/172/3460">http://jfwiki.streamax.com:7503/web/#/172/3460</a>
停止报警服务后仅替换Alarm服务下的当前补丁，再启动服务
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=ade680a7d25887ca8a08e5ffe5695945" alt="" /></p></div></div><h2>13.4.2、安装服务</h2><div style="margin-left:0px;"><h3>13.4.2.1、CB2多转发配置(DVRGT)</h3><div style="margin-left:30px;"><h2>概述</h2>
<p>如果客户平时接入的客户端过多，打开的视频数过高，可能会导致DVRGTService服务挂掉，可采用部署多DVRGT转发解决。</p>
<h2>使用场景</h2>
<p>1.DVRGT有规律的挂掉，一般是客户打开视频高峰的时候，此时有可能视频并发达到最高。
2.安装部署时如果客户有较多视频并发的使用需求。</p>
<h2>原理</h2>
<p>默认情况下CB2安装默认一个转发服务。我们一般在WEB里面加车时会配置转发服务IP、转发服务端口。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/38764f6547d9402d6a06bce02c2eadf1" alt="" />
默认情况下安装后转发服务IP、端口已经在~CMS Server\ClientBalance\BAGConfig.json文件中写死了，Web中配了不会起作用。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fa2d1d65635ecc0a057d5ab0ddea2ab5" alt="" />
要想使我们配置端口起作用，从而达到我们自己来定义哪辆车往哪个转发服务器上，只需要删除"gt":{"ip":"0.0.0.0","port":17891}字段即可。</p>
<h2>配置步骤</h2>
<h4>1.复制TransmitServer目录</h4>
<p>把C:\Program Files (x86)\CMS server\TransmitServer 根目录下的 config、dvrplus文件夹和所有的exe、dll文件和LIC_DVRGTSERVICE.dat复制到C:\Program Files (x86)\CMS server\TransmitServer1 文件夹（可以将这个服务安装到其它的服务器）
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f8f284eeca9cdaad254f67f7fc62aab5" alt="" /></p>
<h4>2.修改配置</h4>
<p>修改C:\Program Files (x86)\CMS server\TransmitServer1\ config\ DVRGTService.ini ，修改gtport为17892（需要在公网映射这个端口）
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f296d84c10a1e62fec0db1de3048b347" alt="" /></p>
<p>修改C:\Program Files (x86)\CMS server\TransmitServer1\dvrplus\providerrmdvr\init.ini，port为12094（需要在公网映射这个端口）（设置的为N9M设备）另外如果转发部署到其它服务器；则[RegAddr]下的ip字段不能填写为127.0.0.1，需要填写注册服务器的IP
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/bfca4f5bff9e5258d09638a48de3eab7" alt="" /></p>
<p>C:\Program Files (x86)\CMS server\TransmitServer1\dvrplus\providerrmmpeg4\init.ini，将VideoPort修改为12093 （需要在公网映射这个端口）（MDVR设备）；另外如果转发部署到其它服务器；则[RegAddr]下的ip字段不能填写为127.0.0.1，需要填写注册服务器的IP
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/28c3d5082b27b41c3c737ef14468889b" alt="" /></p>
<h2>3.安装转发服务器</h2>
<p>此方法可以部署任何其它服务
修改C:\Program Files (x86)\CMS server\TransmitServer\ServerCtrl.ini
A、[config] Servercount 字段的值在原来的基础上加1
B、[config] 最后增加以下内容（注意图片中的26，要替换成Servercount最后的值）
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f4186b01394434336633597707af1aa6" alt="" />
C、退出并且重启控制程序
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/65eee146757a030071ccbf2b69b41197" alt="" />
D、安装转发服务（选中转发服务器1，点击 安装服务器――安装当前服务 菜单，然后启动这个服务）</p>
<h2>4、修改接入服务配置</h2>
<p>C:\Program Files (x86)\CMS server\ClientBalance\ BAGConfig.json ，将"gt":{"ip":"0.0.0.0","port":17891} 这一行给删除掉；然后再重启ClientBalance服务</p>
<h6>注意:删除此配置后，web端上的转发服务IP、转发服务端口必须正确。</h6>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e801db41fb11e59cdbb22703f0e7ba80" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5160f014b063ad18de5b945a4e915d6b" alt="" /></p>
<h2>5.填写WEB</h2>
<p>在基础功能――车辆设备页面，修改转发服务器的IP，和转发端口（输入2步填写的的转发口17892）
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/945172e8b0a5b1db13a54296a0f1a679" alt="" /></p>
<h2>6.重启CB2客户端，双击已修改设备，查看直通视频</h2></div><h3>13.4.2.2、安装28181国标服务</h3><div style="margin-left:30px;"><h1>安装28181国标服务器</h1>
<h2>概述</h2>
<p>详细描述28181服务安装、配置过程</p>
<h2>准备工作</h2>
<h3>1）安装包</h3>
<p>本文档中的Gateway服务服务包为当前为止最新的</p>
<table width='100%' class='codestyle'><pre><code>Gateway服务包</code></pre></table>
<blockquote>
<p>注意：安装其余的服务也可以参考此安装过程</p>
</blockquote>
<h6>信息准备：</h6>
<table width='100%' class='codestyle'><pre><code>上级平台国标ID(上级域ID)
上级平台IP
上级平台信令端口

下级平台国标ID
下级平台登陆上级平台用户           --注意，如果上级平台无需鉴权的话，此项不需要
下级平台登陆上级平台密码           --注意，如果上级平台无需鉴权的话，此项不需要</code></pre></table>
<h2>安装部署</h2>
<h2>获取Gateway服务包</h2>
<p>下载地址： <a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=13484f49473ec5ea38bdf06619b2f036" title="[GBGatewayService.zip">GBGatewayService.zip</a></p>
<h2>1、将服务的文件夹拷贝到CMS Server/TransmitServer下</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ee89bf4505fdf1ed145b4751e4d6ecca" alt="" /></p>
<h2>2、修改ServerCtrl.ini</h2>
<p>（1）在CMS Server\TransmitServer下，找到ServerCtrl.ini并打开</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9fdd14997b5963dcddac5867de2ece37" alt="" /></p>
<p>（2）新增配置并保存
首先将服务器个数增加1：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d911531eec1ea3918471989a920d2b5d" alt="" />
然后在服务器控制信息末尾增加本服务的信息：
其中Server28Name=GBGatewayService表示本服务的名称；Server28Path表示本服的绝对路径；Server28Show表示在服务器控制软件中显示的名称；autoRestart28表示本服务是否自动重启。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/51126305aedbe22776a2931b3a16b268" alt="" /></p>
<p>配置修改完如下所示：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/98c189e043a92583917b96a30ed6d6ee" alt="" /></p>
<p>（3）重新启动看门狗界面
打开任务管理器--详细信息，找到DVRServerCtrl.exe，右键点击并选择结束任务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/59b87b82f253c92839e370200e452b3d" alt="" /></p>
<p>在CMS Server/TransmitServer下，找到DVRServerCtrl.exe，单击，并选择以管理员身份运行。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/77a08111170cc54d6dd00dc7e833b269" alt="" /></p>
<p>（4）再次打开看门狗界面，就会看到刚刚我们新增的国标服务，然后进行安装。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/37f2d891d0218198d0b096e994ec6391" alt="" /></p>
<p>选中该服务，点击左上角的安装服务器--安装当前服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9c5f49c11b9e55221fa25e5bd545a15f" alt="" /></p>
<p>随后提示安装成功，服务的状态会变为停止状态，等到服务正常启动，或者自手动启动即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ff29f9384250bbf220cf7c7436d103a0" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/379c2dc3f582194e9e1fb021b1f25f8b" alt="" /></p>
<h3>5）修改配置文件，配置文件说明如下</h3>
<p>打开GBGatewayService/config目录下的config.ini配置文件，根据注释修改其中的部分参数。主要修改的参数有：SIP服务器的国标ID、SIP服务器的IP地址、SIP服务器的端口、本地SIP国标ID、本地SIP监听地址、本地码流发送地址、SIP服务器注册用户名和密码（若平台不开启鉴权则不需要修改）、设备过滤用户名、设备过滤用户密码（本服务相当于一个CB2客户端，采用用户的车辆权限来过滤设备，若无需过滤则填写admin用户的用户名和密码）。
配置文件解析如下：</p>
<table width='100%' class='codestyle'><pre><code>;*****************************************************
;文 件 名：config.ini
;主要功能：国标网关注册SIP服务器相关配置参数
;*****************************************************
[CONFIG]

;启动sip测试模式，不连接cb2服务器
SipTest=0
;启动rtp测试模式，会存rtp流文件到当前目录下
RtpSave=0
;模拟一个设备
RtpTestDeviceID="test"
;日志级别
LogLevel=4

;SIP服务器的国标ID
SipSrvGBID   = 上级平台国标ID

;SIP服务器的IP地址
SipSrvIp     = 上级平台IP
;SIP服务器的端口
SipSrvPort   = 上级平台信令端口

;SIP服务器注册用户名
SipSrvUser   = 上级平台登陆用户

;SIP服务器注册密码
SipSrvPWD    =  上级平台登陆密码

;SIP服务器注册有效期,单位：秒
SipExpires   = 3600

;本地SIP国标ID
SipLocalGBID = 下级平台国标ID
SipDomain = 下级平台IP(一般填外网)

;本地SIP接收消息地址
SipLocalIP   = 下级平台IP(一般填外网)

;本地SIP监听端口
SipLocalPort = 12090

;增加配置 
;本地侦听ip端口，如果是内网，还需配置公网地址到SipContactIP 
;SipContactIP   = 127.0.0.1
;SipContactPort = 13090

;本地码流绑定地址(一般情况下与本地SIP监听地址相同，在网络配置比较复杂时可能不同)
LocalStreamIp= 0.0.0.0

;CEIBAⅡWeb服务器的IP地址(若国标网关与注册服务器部署在同一设备上,则使用本地回环地址127.0.0.1即可)
MonWebSrvIp  = 127.0.0.1

;CEIBAⅡWeb服务器的端口
MonWebSrvPort= CB2客户端登陆用户

;CEIBAⅡ客户端用户名
MonWebSrvUser=CB2客户端登陆密码

;CEIBAⅡ客户端密码
MonWebSrvPwd=123456

;CEIBAⅡ注册服务器的IP地址(若国标网关与注册服务器部署在同一设备上,则使用本地回环地址127.0.0.1即可)
RegSrvIp     = 127.0.0.1

;CEIBAⅡ注册服务器的端口
RegSrvPort   = 5556

;CEIBAⅡ转发服务器的IP地址(若国标网关与转发服务器部署在同一设备上,则使用本地回环地址127.0.0.1即可)
TransSrvIp   = 127.0.0.1

;CEIBAⅡ转发服务器的端口
TransSrvPort = 17891

;是否开启GPS上报(0-不开启；1-开启)
GpsEnable = 0

;每次目录上报最大个数(默认32个，宇视平台规定为8个，安徽创世必须逐个上报)
MaxNumCatalogNty = 16</code></pre></table>
<h3>6）按照如上配置修改之后，重启Gateway服务</h3>
<p>如果启动后，服务运行正常，则安装成功。</p>
<h3>6.1） 如果要部署多个28181服务</h3>
<p>按照上文中的部署方式再复制一个目录命名为GBGatewayService1再安装服务即可，需要注意的是：
配置文件中这个端口：
;本地SIP监听端口
SipLocalPort = 12090，#这个端口需要修改，例如改为13090，同时也需要请客户开发端口映射（TCP/UDP都开启）</p>
<p>7）检查</p></div><h3>13.4.2.3、安装一个新服务</h3><div style="margin-left:30px;"><h1>安装一个新服务</h1>
<p>本教程以ThreadMonitor服务为例，介绍如何在CB2服务器上部署一个新的服务</p>
<h2>1、将服务的文件夹拷贝到CMS Server/TransmitServer下</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b2db7e443f53f056ad8c01030c5fc131" alt="" /></p>
<h2>2、修改ServerCtrl.ini</h2>
<p>（1）在CMS Server\TransmitServer下，找到ServerCtrl.ini并打开</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9fdd14997b5963dcddac5867de2ece37" alt="" /></p>
<p>（2）新增配置并保存
首先将服务器个数（servercount）增加1：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=276819d22596a4a269b07b805e94865e" alt="" />
然后在服务器控制信息末尾增加本服务的信息：
其中Server39Name=ThreadMonitor表示本服务的名称；Server39Path表示本服的绝对路径；Server39Show表示在服务器控制软件中显示的名称；autoRestart39表示本服务是否自动重启。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=91ab9574f7ca100b6a988e4302268c39" alt="" /></p>
<p>配置修改完如下所示：</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=cd8d70d95bc3bb5550f33e26be4630d0" alt="" /></p>
<p>（3）重新启动看门狗界面
打开任务管理器--详细信息，找到DVRServerCtrl.exe，右键点击并选择结束任务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/59b87b82f253c92839e370200e452b3d" alt="" /></p>
<p>在CMS Server/TransmitServer下，找到DVRServerCtrl.exe，单击，并选择以管理员身份运行。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/77a08111170cc54d6dd00dc7e833b269" alt="" /></p>
<p>（4）再次打开看门狗界面，就会看到刚刚我们新增的单线程监控服务，然后进行安装。</p>
<p>选中该服务，点击左上角的安装服务器--安装当前服务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=ca23818b18474d25deae766c8b7e6ead" alt="" /></p>
<p>随后提示安装成功，服务的状态会变为停止状态，等到服务正常启动，或者自手动启动即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=ef344c4eba7f0748739a4c07c9f98c67" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e9f956e7ce2251e62b761929f984ea89" alt="" /></p></div></div><h2>13.4.3、HTTPS部署</h2><div style="margin-left:0px;"><h3>13.4.3.1、2.6.3.0.55及以上版本开启https</h3><div style="margin-left:30px;"><h1>2.6.3.0.55及以上</h1>
<h2>一、准备工作</h2>
<h3>1、检查证书和key</h3>
<p>检查客户提供的后缀名为crt和key的文件（nginx证书）
可以双击这两个文件打开
crt里里面会有证书的有效期和指向的域名，
key文件里面会有“BEGIN RSA PRIVATE KEY”和“END RSA PRIVATE KEY”字样</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/5739475720492ef585f3268254d9af3d" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d9dcc4c6502dcb4ce6df2aebdf7db15a" alt="" /></p>
<h2>二、修改文件名</h2>
<p>修改crt和key文件为：
xxx.crt-->certificate.pem
xxx.key-->privatekey.pem</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/77ffd90e4f2b176fedc4667638a1dba4" alt="" /></p>
<h2>三、备份文件</h2>
<p>找到路径CMS Server\ngnix\keys
修改该路径下的文件名，作为备份</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/958a87e94269a1aaa9c0df8e22eb54b8" alt="" /></p>
<h2>四、拷贝文件到指定路径</h2>
<p>拷贝到对应的CMS Server\ngnix\keys文件夹</p>
<h2>五、进入服务器配置工具，勾选使用https 并保存退出</h2>
<p>1、  以管理员身份运行</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/b8d4bcac22fd3fe68117524233f86338" alt="" /></p>
<p>2、  勾选https</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ebb8bbbedcde708982d3a77f156aa2c7" alt="" /></p>
<p>3、防火墙例外与映射，将红框框出来的端口在高级安全Windows防火墙里新增入站规则、请客户开启外网映射（具体可以百度）</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0624fcf9061c5e26e099a2277ba58c75" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d0a2cfe268b2c35b62c6148d8a9f55e1" alt="" /></p>
<h2>六、重启NginxBroker服务</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f7fbba3b8a7ff1b152e9049c983a9cb7" alt="" />
参考此faq进行处理：<a href="http://jfwiki.streamax.com:7503/web/#/172/1648">http://jfwiki.streamax.com:7503/web/#/172/1648</a></p>
<h2>七、功能验证</h2>
<p>1、 确保所有服务重启成功，运行正常</p>
<p>2、 使用Web功能查看证书是否有效</p>
<p>3、 https功能是否正常： <code>https://域名:端口</code> ,不被拦截，显示网页不安全</p></div><h3>13.4.3.2、2.6.3.0.55以下版本</h3><div style="margin-left:30px;"><h1>部署Https证书</h1>
<h2>1、替换https补丁</h2>
<h5>2.6.3.0.55版本下大致有以下补丁</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cd0481d224d3c95b96924f15423549e1" alt="" /></p>
<h5>（1）拷贝https补丁中WCMS5\root\目录下的各个文件到服务器WCMS5对应目录下(注意要把default.js文件替换到准确的目录下，尤其是目录层级较多时容易出错);</h5>
<h5>（2）把WCMS5\reactroot\node_modules\目录下.sword文件夹直接替换为补丁里面现有.sword文件夹；</h5>
<hr />
<h2>2、修改配置文件</h2>
<h5>（1）修改WCMS5\root\config\app.json配置文件，在最后加入以下几行。</h5>
<blockquote>
<p>注意：在app.json后添加数据最后一条数据后面没有逗号。</p>
</blockquote>
<table width='100%' class='codestyle'><pre><code>,"httpsFlvPort":9095,"httpsHlsPort":9100,"httpsReactPort":23113</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/ac940a98c52abb9deacd0435066d3f77" alt="" /></p>
<h5>(2)如果服务器自身在CMS Server下有nginx目录，那就进入CMS Server/nginx/conf，打开nginx.conf文件检查是否与第三步修改的app.json配置文件一致。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f1e5664cd7fface5b2af58781d78d494" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0bd53a748ac9bff8298ad2603249445a" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/4ac83e7b39fe665da00551c98082b5b7" alt="" /></p>
<h5>（3）若服务器自身在CMS Server下没有nginx目录，那将https补丁中的nginx-1.14.0拷贝到CMS Server下，然后按照第三步操作即可。</h5>
<h2>3、拷贝证书</h2>
<p>1.拷贝有效的ssl证书文件（.crt，.key）到nginx-1.14.0\ssl\ 目录，并修改ssl证书文件名称分别为streamax.crt，streamax.key（证书名称没有限制，但要与nginx配置中一致）；
2.开始---->运行---->cmd，或者是window+R组合键，调出命令窗口；
3.进入nginx-1.14.0目录；
4.启动nginx：start nginx
5.检查nginx是否启动：tasklist | findstr “nginx”（正常情况下有两个nginx.exe进程）
6.Nginx常用操作（须用cmd切换到nginx.exe所在目录）
a)start nginx               # 启动Nginx
b)nginx.exe -s stop         # 快速停止Nginx，可能并不保存相关信息
c)nginx.exe -s quit         # 完整有序的停止Nginx，并保存相关信息
d)nginx.exe -s reload       # 重新载入Nginx，当配置信息修改，需要重新载入这些配置时使用此命令。
e)nginx.exe -s reopen       # 重新打开日志文件
f)nginx -v                  # 查看Nginx版本</p>
<blockquote>
<p>注意：
1、启动之后，要在任务管理器-进程页面确认是否启动了两个nginx.exe进程（或者在cmd中输入tasklist | findstr “nginx”），如果没有，重复调用“start nginx” 命令，若无法启动可查看日志中的报错内容。
2、调用“nginx.exe -s stop”或“nginx.exe -s quit”指令停止Nginx时，同样需确认nginx.exe是否都被关闭，如果没有，重复调用命令
3、配置完之后，需要重启WCMS5和WCMS5REACT服务</p>
</blockquote>
<h3>自定义配置（当需要修改映射端口时，端口被占用时）</h3>
<p>1、修改 nginx-1.14.0\conf\ 目录下的 nginx.conf 配置文件；
配置位置：   http---->server---->listen  监听端口
节点1：webclientport（默认5557）
节点2：httpsFlvPort（默认9095）
节点3：httpsHlsPort（默认9100）
节点4：httpsreactport（默认23113）
2、修改后需要reload操作或者重启nginx服务；</p>
<p>同时，需要修改web端相关配置：服务器安装目录\WCMS5\root\config\app.json<br />
“httpsReactPort”:证据中心端口（与nginx.conf里httpsreactport端口保持一致）
"httpsFlvPort": 视频直通端口（与nginx.conf里视频直通端口保持一致）
"httpsHlsPort": 视频回放端口（与nginx.conf里视频回放端口保持一致）</p>
<h3>访问方式和接口url变化</h3>
<p>1、web客户端访问：<a href="https://服务器IP:5557">https://服务器IP:5557</a>
2、web直通视频URL示例：<a href="https://192.168.151.249:9095/live.flv?devid=009900003D&chl=1&svrid=127.0.0.1&svrport=17891&st=1&audio=1&ngnixport=12060">https://192.168.151.249:9095/live.flv?devid=009900003D&chl=1&svrid=127.0.0.1&svrport=17891&st=1&audio=1&ngnixport=12060</a>
3、web回放URL示例：https:// 192.168.151.249:9100/play/009900003D/3/20190802000000_20190802031810_main.m3u8
备注：要在公网上访问https，需开放5557、9095、9100、23113四个端口。</p></div><h3>13.4.3.3、nginx版本升级</h3><div style="margin-left:30px;"><h1>当前nginx版本</h1>
<p>63版本及以前版本都是1.19.1，比较老了
查看版本 nginx_basic.exe -v
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/04c90976bb8c754fa2ade290217a990d" alt="" /></p>
<h1>升级nginx到最新版本</h1>
<p>补丁包（更新版本联系研发提供）：
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=d8a24c7618efa1df2e67ac0404ab8707" title="[nginx1.23.3.1升级包.zip">nginx1.23.3.1升级包.zip</a></p>
<h1>替换方式</h1>
<p>在服务控制器程序面板中---
停止dvrrtservice服务
停止nginxbroker服务
替换补丁包内的文件（conf文件夹不要替换，只换两个EXE文件即可）。
启动dvrrtservice服务
启动nginxbroker服务--
查看版本 nginx_basic.exe -v
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/30954e5c232967e21f44095ea71241aa" alt="" /></p></div><h3>13.4.3.4、nginx-ssl证书升级手册</h3><div style="margin-left:30px;"><h2>0. 开始续期证书之前，需要准备两个证书文件（硬性要求）</h2>
<h4>1）证书本体文件，<code>xxx.crt</code>，并打开查看证书有效期是否符合要求：</h4>
<p>crt里里面会有证书的有效期和指向的域名
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e861c7bf2d96948d18c816bc9450f4a2" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=0dcf829d58bb7a22b073cd8c0aa91515" alt="" /></p>
<h4>2）密钥文件，<code>xxx.key</code>，或者是含有密钥的相关txt文件：</h4>
<p>key文件里面会有“BEGIN RSA PRIVATE KEY”和“END RSA PRIVATE KEY”字样
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=0b5e97a05e27dcdc1454e2b499e642b1" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=1e4e568135953461d4dd9e0614c9c9c9" alt="" /></p>
<h2>1. 证书替换</h2>
<h4>1）将准备好的两个文件分别改名</h4>
<p><code>xxx.crt</code> ====>  <code>certificate.pem</code>
<code>xxx.key</code> ====>  <code>privatekey.pem</code></p>
<h4>2）在nginx服务目录下替换原文件</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=49c5d44aeb97403b8e050f5dcf0603bc" alt="" />
即“四、拷贝文件到指定路径四、拷贝文件到指定路径”后，不要动防火墙，进行当前升级证书的下一步</p>
<h2>2. 重启nginxBroker服务</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=17602e659958fafdf87d6c166a1b5594" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2744f9a4160ff5baecf148cebb21e405" alt="" /></p></div><h3>13.4.3.5、开启https中Modify Config失败</h3><div style="margin-left:30px;"><h1>一、问题</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5c1da4c35b6570f4e0e5a8ddca5bdf1b" alt="" /></p></div></div><h2>13.4.4、基础数据定时备份</h2><div style="margin-left:0px;"><h3>13.4.4.1、CEIBA2基础数据自动备份</h3><div style="margin-left:30px;"><h1>CEIBA2基础数据自动备份</h1>
<h2>自动备份工具：</h2>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/805223a441474f3f4bc36bf902b5dbee" title="[BackMysql.zip">BackMysql.zip</a></p>
<h2>备份ceiba基础数据，并且上传ftp</h2>
<p>1、只备份了基础的表信息，ftp地址为124.161.255.231:8300,账号/密码：crocus/Crocus123
2、备份的文件以当天日期命名，例如（2020-11-04.sql）
3、如要在自己负责的Windows服务器上部署该脚本，推荐使用exe方式。（具体操作见BackMysql文件夹的操作方式）
4、config.ini与该脚本配合使用</p>
<h2>使用exe方式（BackMysql文件夹）</h2>
<p>1、将BackMysql.zip拷贝到对应服务器目录的CMS Server下。（如果没有CMS Server目录，拷贝到CEIBA的Mysql同级目录即可）
2、根据实际服务器的路径修改config.ini文件。（在BackMysql/dist/下，打开config.ini文件修改）
config.ini文件意义：
（1）path:对应服务器目录下的Mysql的bin目录。--备份用到的mysqldump在该路径下。
（2）port:对应服务器的Mysql数据库端口。--打开Mysql下的my.ini文件可以查看。
（3）savepath:存放此文件夹（BackMysql）的路径。
（4）ftppath：备份的文件上传至ftp的路径。
<strong>注意：使用该程序之前需要先进入ftp所在的服务器，在对应平台对应战区的目录下建立客户的文件夹，并更新权限（chown crocusftp:root + "文件路径"）</strong>。</p>
<blockquote>
<p>建文件夹需要联系技术专家部同事！！！</p>
</blockquote>
<p>3、改完config.ini，且在ftp的服务器上已经创建了客户的文件夹后，可以运行BackMysq/dist/BackMysql.exe，如果未提示错误，且在当前文件夹和ftp对应的文件夹上有当前日期命名的sql文件，即判断成功。
4、设置Windows计划任务，流程见以下：
（1）点击开始--点击管理工具--任务计划程序。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6a65408ff5864e991c098ef212e6f16f" alt="" />
（2）点击创建任务。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/c0ea199e472eca3c5f6a6e247902a9a8" alt="" />
（3）输入名称“定时备份ceiba基础数据”，选择不管用户是否登录都要执行。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9fc72f4ee3cdc59e1e55e702a7f7e769" alt="" />
（4）点击触发器--点击新建--选择每周--选择每周三--最后点击确认
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d5ae8a5a76ecb481c524293be1c40439" alt="" />
（5）点击操作--点击新建--点击浏览（选择BackMysql.exe文件的路径，同时起始于参数也需要填写相对应的文件路径）
例如：
程序或脚本："D:\Program Files (x86)\CMS server\BackMysql\dist\BackMysql.exe"
起始于：D:\Program Files (x86)\CMS server\BackMysql\dist\
注意：这个起始于的参数必填！！！（起始于填的值为程序或脚本的上一层目录）
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8aba3e9f1cd7eb671c835ff585b98cdd" alt="" />
（6）最后点击确认，输入administrator账号的密码，即可设置计划任务成功。</p></div></div><h2>13.4.5、其他</h2><div style="margin-left:0px;"><h3>13.4.5.1、运行看门狗工具提示other user run program</h3><div style="margin-left:30px;"><h1>现象</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a6160c5d11a522d4bfdd2a92b35cbc1a" alt="" /></p>
<h1>解决方法</h1>
<p>（1）打开任务管理器--详细信息，找到DVRGTServerCtrl.exe，右键点击结束任务。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f9c28cda132296d0b0da1177802c732f" alt="" /></p>
<p>（2）进入CMS Server/TransmitServer下，单击DVRGTServerCtrl.exe，选择以管理员身份运行即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/66df350f177fa71b2628c1c8bce50e87" alt="" /></p></div><h3>13.4.5.2、修改8081端口</h3><div style="margin-left:30px;"><h1>修改8081端口</h1>
<h5>1、进入CMS Server/ngnix/conf，打开ngnix.conf文件，搜索8081，找到后将其修改为自己想修改的端口，修改完成后重启NgnixBroker服务。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9eaaf0e9774761ca8a23542b46cc0dfb" alt="" /></p>
<hr />
<h5>2、进入CMS Server/ClientBalance，找到BAGconfig.json，打开，找到8081端口，将其修改为第一步中修改的端口，修改完成后重启ClientBalance服务。</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2927420908b48d941d1de3f8f8abcde4" alt="" /></p>
<h5>3、进入windows防火墙，开启inbound rule  新增端口例外规则</h5>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=4c5e46242293c969d8716cd3ee15b90e" alt="" /></p></div><h3>13.4.5.3、修改CB2每天自动定时重启时间</h3><div style="margin-left:30px;"><h1>修改CB2每天自动重启时间</h1>
<h2>背景</h2>
<p>CB2默认的重启时间是早上6点。</p>
<h2>修改方法</h2>
<p>（1）打开CMS Server/TransmitServer/ServerCtrl.ini</p>
<p>打开以后，找到下图的time1，这里是6，修改为想修改的时间即可，<strong>注意只能为整数！！！</strong>只有整数才会生效！！！</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fea07b925062b155caf60819cb6cab12" alt="" /></p>
<p>（2）修改完成以后，重启DVRRTService服务，观察是否生效。</p></div><h3>13.4.5.4、更改自动下载文件和证据文件存放路径</h3><div style="margin-left:30px;"><h1>更改自动下载视频路径</h1>
<p>详情请查看以下链接的FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1505">http://jfwiki.streamax.com:7503/web/#/172/1505</a></p>
<h1>更改证据文件路径</h1>
<p>详情请查看以下链接的FAQ：<a href="http://jfwiki.streamax.com:7503/web/#/172/1507">http://jfwiki.streamax.com:7503/web/#/172/1507</a></p></div><h3>13.4.5.5、CEIBA2服务器清理硬盘空间</h3><div style="margin-left:30px;"><h1>1、清理工具1号，</h1>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1ef17b908f65b96cd07e471fc48517ed" title="[服务器C盘清理.bat">服务器C盘清理.bat</a>   放C盘根目录下
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/f194623a43ec6b3796683f3658c62739" title="[deletlog.bat">deletlog.bat</a>    先拷贝到\CMS server\目录下，执行一下，也可以添加到windows任务计划中（添加方式请百度）</p>
<h1>2、清理工具2号：</h1>
<p><a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/dbff04780c97e38c2b8632dd44a2ffaf" title="[删除CEIBA2&运维服务器日志的快速方法.docx">删除CEIBA2&运维服务器日志的快速方法.docx</a>
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/27a948142f824d79da5f231b4d2553e7" title="[delete_log.exe">delete_log.exe</a>
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/7b457cf2eb91a0e3baf8f30a221092c0" title="[path.ini">path.ini</a>
2.推荐工具：<br />
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/57e1989fa478e21444bf3c691f9640c6" title="[spacesniffer.zip">spacesniffer.zip</a>
查看windows服务器硬盘占用：
使用方法：<br />
1.解压附件到任意目录，双击SpaceSniffer.exe。
2.选择平台软件安装的分区。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/33f2f0f6687d3334450c95e8fcce0d09" alt="" />
3.即可看到当前选择的分区硬盘占用情况<br />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8ece704f137d2e9a6306b3fceedffab3" alt="" />
非常直观的看到各个目录硬盘占用。<br />
/<strong>以下将会介绍可以删除的目录或者文件，保留最近几天的日志，其他可以直接删除。
</strong>/3. CEIBA2  </p>
<h1>3.1 平台服务日志</h1>
<p>参考1中的脚本，运行后会自动删除           </p>
<h1>3.2 历史GPS/报警</h1>
<p>Mongdb数据库：默认保存120天的GPS数据<br />
<strong>如果不需要存储120的GPS数据，建议根据客户需求改小一点，修改方式如下：</strong><br />
修改之后一定点“修改配置”，工具会自动重启服务生效，所以务必在业务低峰期或者得到客户允许情况下操作！！！！
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/9eb03891353758150cdc1f8a3b6e42c9" alt="" />
打开configTool网络配置工具<br />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/356e7d07a84c33ffb57b1e46d1609fc2" alt="" /></p>
<h2>手动删除mongodb历史数据</h2>
<table width='100%' class='codestyle'><pre><code>不需要重启服务，而且这个方法比较快，适合于磁盘马上要满了，
已经来不及等服务自动删除历史数据了
用mangodb客户端连接芒果数据库，详见笔记“mongdb客户端”       
27017对应mangodb，27018对应mangodb3.2 。  </code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/937f3132dd1a07fe49dbf627f3954ddb" alt="" />
在数据库上点击右键，选择drop database即可。<br />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/563a8cb93dc298c623a90dd800d9e96b" alt="" />
drop之前：
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8d1ffe3d502a1324bb45537d4f7ed96e" alt="" />
drop 之后<br />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/57f11d62b228ee5dffd154d94f44bc80" alt="" /></p></div><h3>13.4.5.6、fcgi.exe提示停止工作</h3><div style="margin-left:30px;"><h1>fcgi.exe提示停止工作</h1>
<h2>原因</h2>
<p>注册服务异常导致fcgi.exe异常</p>
<h2>解决方法</h2>
<p>如果是2.6.3.0.63版本，请下载以下链接的补丁，在服务器上做好备份，将补丁打上去：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1374">http://jfwiki.streamax.com:7503/web/#/172/1374</a></p>
<blockquote>
<p>注意：是替换补丁最里面层的文件，不是整个文件夹替换</p>
</blockquote></div><h3>13.4.5.7、修改客户端test显示的端口列表</h3><div style="margin-left:30px;"><h1>修改ClientBanlance配置文件</h1>
<p>该文件删除对应的配置后，就不会在客户端服务器测试那里出现。</p>
<h2>操作步骤</h2>
<p>1、进入服务器对应目录CMS Server\ClientBalance，找到BAGConfig.json文件。</p>
<p><strong>先备份一份</strong>。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0ec7e320308b17cf983b44d5a369843f" alt="" /></p>
<p>2、需要删除那一段的端口就自己删除掉，注意不要多删或者少删除了括号、逗号等。</p>
<p>比如删除12003端口，将以下这段删除，然后去重启ClientBanlance服务即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/0d007e569e23a94959801a9f67f4996b" alt="" /></p></div><h3>13.4.5.8、关闭设备上报CB2平台自动下发gps上报时间间隔</h3><div style="margin-left:30px;"><p>关闭设备上报CB2平台自动下发gps上报时间间隔</p>
<p>1.找到 安装目录/TransmitServer/MessagerServer/regsvr.ini文件打开</p>
<p>2.修改UpGpsEnable字段值， UpGpsEnable=-1</p>
<p>3.重启messageserver服务</p></div><h3>13.4.5.9、降低CB2服务器的资源占用</h3><div style="margin-left:30px;"><h1>与客户沟通：</h1>
<p>1、是否保存GPS，可选不保存，默认保存。
2、是否保存报警信息，可选不保存，默认保存。
3、是否向客户端推送实时GPS，可选不推送，默认推送
4、是否向客户端推送实时报警信息，可选不推送，默认推送
推荐只给客户端推送GPS 和报警，不写数据库。</p>
<h1>参考案例：截图是不推送不保存</h1>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=1d97388f94e4debd0ba8af449a67b2cb" alt="" /></p>
<h2>这两个数据库是专门用来写GPS和报警数据的， 既然数据都不需要保存，那就直接卸载了。</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=a5d717cd4aa3f9b3883a9819c9123bcc" alt="" /></p>
<h2>效果</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=ce9a14ebcfe29ef7c39c604137f6ae6e" alt="" /></p>
<h1>备注</h1>
<p>2020年01月07日以前出的241、251、252、262、263标准版本，关闭GPS开关后还有GPS信息，是设备报警中带的GPS数据没有被过滤，如果介意的话需要替换补丁。</p></div><h3>13.4.5.10、查看机器码</h3><div style="margin-left:30px;"><h1>查看机器码用于制作专属的转发服务授权文件</h1>
<h1>方法</h1>
<p>x:\Program Files (x86)\CMS Server\TransmitServer\DVRRegister.exe
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=b7a42014946d7f7f5bc338bfcae33287" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=84fd51f3bd812bc00367e0727bde5233" alt="" /></p></div><h3>13.4.5.11、服务器升级失败、服务安装失败</h3><div style="margin-left:30px;"><h1>服务器升级失败、服务安装失败</h1>
<h3>1. 升级后看门狗服务起不来</h3>
<p>参口文档：<a href="http://jfwiki.streamax.com:7503/web/#/172/1423">http://jfwiki.streamax.com:7503/web/#/172/1423</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=db08551fe09f951bba89583bc97e7b65" alt="" /></p>
<h4>2. 检查配置文件完整性</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=72afb27aa7d67899f68569eb11192f24" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=e69433077f5ba9665d69f72312d8ef0d" alt="" /></p>
<h4>3. 当前配置文件不完整，可能是服务未成功安装</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=821f37f0ab24ec6be3793cb480564e70" alt="" /></p>
<h4>4. 在执行卸载CMS服务之后，检查任务管理器</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=26ed6e8eddc2d46b65140546fd0ec8bd" alt="" /></p>
<h4>5. 当前服务还存在，建议卸载服务之后检查任务管理器服务状态，后重启服务器</h4>
<h4>原因：服务被卸载了，但是windows缓存没有清，显示服务还在。未完全卸载导致之后的安装服务异常。</h4></div></div><h2>13.4.6、补丁替换合集</h2><div style="margin-left:0px;"><h3>13.4.6.1、报警报表20条限制</h3><div style="margin-left:30px;"><h2>问题：报警报表导出20条限制</h2>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=5e32a3e1b3ecc3dd3d390c850df9e0bc" alt="" /></p>
<h2>补丁文件</h2>
<p>点我下载<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/dc846204a8bafea82b8d53914225f2f2" title="[2.6.3.0.55.zip">2.6.3.0.55.zip</a></p></div><h3>13.4.6.2、AlarmService 补丁</h3><div style="margin-left:30px;"><h2>AlarmService服务异常</h2>
<p>关键词：报警、地图、空白</p>
<h3>问题描述</h3>
<p>1）无报警信息
2）客户端、网页、APP地图空白
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=1a067572b8c9b8e6cbac6ed7f8aed489" alt="" /></p>
<h3>检查服务状态</h3>
<p>运行看门狗程序，检查服务的运行状态；
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=095a2848cdcb80b99e9d12b95b1edeee" alt="" /></p>
<h3>解决方法</h3>
<p>1）替换AlarmService服务通用补丁（排除版本非常老的情况）
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=423152ac5d73b63812b6fee24665ea34" title="[AlarmServer (4).zip">AlarmServer.zip</a>
2）备份原有文件夹与配置文件AlarmService.json（防止后续出现其他问题，进行回退操作）
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=67d226d3608a5366005c12618296c675" alt="" />
ps：
1）建议就把备份放在同级文件夹下，也好追溯是否替换了补丁；
2）备份原有服务文件夹时，先在看门狗中停止守护服务，再停用目标服务后。进行备份与补丁替换；</p></div><h3>13.4.6.3、message注册服务补丁</h3><div style="margin-left:30px;"><h1>现象：</h1>
<p>1.message服务CPU占用高，原因：老注册承载不了这么大的压力，应该连接数太多导致新连接连不上，5556端口时通时不通。重启注册服务；
2.设备大批量掉线；</p>
<h2>补丁文件：</h2>
<p><font color=white> </font></p>
<!-- [MessagerServer.zip](http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=f8e8c120796d07948177e6328176095d "[MessagerServer (2).zip")
--></div></div><h2>13.4.7、数据高可靠方案</h2><div style="margin-left:0px;"><h3>13.4.7.1、CB2 数据高可靠性保障方案</h3><div style="margin-left:30px;"><h1>背景</h1>
<p>针对当前绝大多数客户使用CB2单机部署，无数据备份，一旦因服务器因断电或操作异常，可能会导致数据损坏无法修复、数据丢失，服务器损坏等灾难情况。近期已经部分客户发生此类现象，这无疑对客户是一种损失，尤其对数据保障要求及其严格的一些政府客户。</p>
<h1>方案</h1>
<p>为了保障数据的安全，CB2平台建议各客户对数据库进行主从备份，方案请查看附件。将此方案作为CB2推广使用时保障数据安全的标准方案。
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2d95cd0d1644c53113c5cfba6ff07751" title="[CB2数据主从备份方案.doc">CB2数据主从备份方案.doc</a></p>
<h1>流程</h1>
<p>请前方技术支持，告知客户单机部署所存在的数据丢失的风险和数据主从部署后对数据的安全保障，请客户务必引起重视。如有客户需要数据库主从备份部署，研发、专家部、DBA可以提供部署支持。</p>
<h1>温馨提示</h1>
<p>另外在升级服务器的时候，卸载服务器虽然会弹出默认备份数据的对话框，但是还是建议先手动打开备份工具备份数据，检查数据后再行卸载服务。
     </p></div></div></div><h2>13.5、数据库</h2><div style="margin-left:20px;"><h3>13.5.1、进入数据库</h3><div style="margin-left:0px;"><h1>进入数据库</h1>
<h2>方法一：</h2>
<h3>1、进入服务器对应目录CMS Server/MySql5.5，找到my.ini文件并以记事本的方式打开，记下Mysql使用的端口。</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/54df3baf759ed156a4550e84f52241e8" alt="" /></p>
<center>图1.1</center>
<hr />
<h3>2、进入服务器对应目录CMS Server/MySql5.5/bin，将顶头的文件目录清空(见图2.1)，输入cmd（见图2.2）后回车，进入cmd中（见图2.3）。</h3>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/64b81ff95896a1f680190f6cf0f1a895" alt="" /></p>
<center>图2.1</center>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/279435a04f91039b2be8002bb405fe38" alt="" /></p>
<center>图2.2</center>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d791da8be266f1d8d60c2251ccffa9cd" alt="" /></p>
<center>图2.3</center>
<hr />
<h3>3.1、在cmd.exe中输入以下内容 (注意：-P指的是数据库使用的端口，将自己服务器Mysql使用的端口写在后面即可，我这里是3307所以我写的3307)。</h3>
<p><code>mysql -uroot -p -P3307</code></p>
<p>看到Enter Password后输入密码（默认密码为c6l7r8ceacvi2010vs）并回车</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/30802fef8b1015b738945bc32e3106d1" alt="" /></p>
<center>图3.1</center>
<h3>3.2、输入密码点击回车时未进入数据库，且返回了ERROR，很大可能是密码错误，即不可以使用默认密码登录数据库。</h3>
<p>如果出现类似图3.2的情况，请还原Mysql的密码后再尝试进入数据库。
还原Mysql密码参考文档链接：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1330">http://jfwiki.streamax.com:7503/web/#/172/1330</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/76ae7e4af520182bbd8e16a996184c1a" alt="" /></p>
<center>图3.2</center>
<h2>方法二：</h2>
<h3>使用navicat连接数据库</h3>
<p><a href="http://jfwiki.streamax.com:7503/web/#/172/1290">http://jfwiki.streamax.com:7503/web/#/172/1290</a></p></div><h3>13.5.2、数据库初始化</h3><div style="margin-left:0px;"><h1>数据库初始化 <font color='red'> （数据库初始化后，基础数据会被还原到服务器刚安装的初始状态，当前所有的账户、车组车辆信息都将丢失！） </font></h1>
<h2>1、初始化需要先进入数据库，请参考文档进入数据库，链接如下：</h2>
<p><a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a></p>
<h2>2、进入数据库后，执行以下语句</h2>
<blockquote>
<p>注意：以下语句的路径需要对应自己服务器上wcms4.sql的实际路径。</p>
<table width='100%' class='codestyle'><pre><code class="language-c">source C:\Program Files (x86)\CMS Server\WCMS4.0\wcms4.sql</code></pre></table>
<p>执行完成后，打开CMS Server\TransmitServer\ ConfigToolPro.exe，点击修改配置，然后重启所有的服务即可。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/1abe9e95ddac8d649e2ef30f17db2534" alt="" /></p>
</blockquote></div><h3>13.5.3、还原数据库密码</h3><div style="margin-left:0px;"><h1>还原数据库密码</h1>
<h2>1.先在安装目录找到my.ini配置文件</h2>
<p>路径为CMS Server/MySql5.5/my.ini
打开配置文件，找到[mysqld]一行，在下面添加skip-grant-tables后保存该文件，重启Mysql服务;</p>
<blockquote>
<p>注意：改了配置一定要重启Mysql服务！！！</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/39406d1aa77df2fdf17af9078c182a94" alt="" /></p>
<h2>2.然后在mysql的cmdline执行</h2>
<p>如何进入Mysql的cmdline请查看文档进入数据库的方法一，链接如下：
<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a>
进入数据库后执行以下语句：</p>
<table width='100%' class='codestyle'><pre><code class="language-c">use mysql;
update user set password=password('c6l7r8ceacvi2010vs') where user='root';
Flush privileges;</code></pre></table>
<h2>3.将刚才my.ini配置文件的添加那一行去掉，最后重新启动mysql就可以了。</h2></div><h3>13.5.4、修复损坏的数据表</h3><div style="margin-left:0px;"><h1>修复损坏的数据表</h1>
<h2>1、首先进入数据库，请使用navicat软件连接数据库</h2>
<p>参考http://jfwiki.streamax.com:7503/web/#/172/1329 的方法二。</p>
<h2>2、打开对应的数据库，找到需要修复的数据表。</h2>
<p>右键点击需要修复的表，选择维护--修复表--快速，然后耐心等待修复完成即可。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/d81e570e7d40871fc93217627485b2f0" alt="" /></p></div><h3>13.5.5、忘记密码后修改用户密码</h3><div style="margin-left:0px;"><h1>忘记密码后修改用户密码</h1>
<h2>1、连接数据库</h2>
<p>参考以下faq的方法连接数据库：<a href="http://jfwiki.streamax.com:7503/web/#/172/1329">http://jfwiki.streamax.com:7503/web/#/172/1329</a></p>
<h2>2、找到admin的初始密码</h2>
<p>打开对应服务器目录下的CMS Server/WCMS4.0/wcms4.sql
查找admin，复制后面那一串字符"D033E22AE348AEB5660FC2140AEC35850C4DA997"（加密后的密码，解密后为admin）</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/bbecb9bb3dfdd6cefe113881f489ffe3" alt="" /></p>
<h2>3、修改密码</h2>
<p>点击查询--新建查询，执行以下语句。</p>
<p>也可以把<code>admin</code>换成别的用户，最后修改后的初始密码就是admin。</p>
<table width='100%' class='codestyle'><pre><code class="language-sql">use wcms4;
update registerlogin  set userpassword = "D033E22AE348AEB5660FC2140AEC35850C4DA997" where username = "admin";</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2d0b15b2cb8f87589e5214fe9f59090a" alt="" /></p></div><h3>13.5.6、批量转组</h3><div style="margin-left:0px;"><h1>背景</h1>
<p>黑标用的CEIBA服务器设置的自动上报，因为黑龙江这边有10几家GPS服务商，所以我们给他们开了子账号。但是安装时候服务商都没有提前录入车辆信息在ceiba平台上。现在这些车辆都在以日期命名的分组下。我们这边想要把不同的车辆分给每家GPS服务商的分组下。我现在只能一个一个搜索序列号去修改分组。因为是已存在的车辆没有办法批量导入。有什么办法可以批量把一些车辆导入到某一个分组下吗。</p>
<h1>操作过程</h1>
<p>操作前对数据库基础数据备份（备份工具备份），确保备份成功
屏幕录屏
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=76d0a79a39318d7faaee9a3c3b549d50" title="[批量设置SQL语句.zip">批量设置SQL语句.zip</a>
模板文件
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=483a96cc2d6daef086da09fee0d0fef0" title="[车组转换模板.xls">车组转换模板.xls</a>
SQL语句：
<code>update vehicledevice set groupid=(select id from groupinfo where groupname='一分公司') where carlicence='B69T61'; </code></p></div><h3>13.5.7、从数据库导出车组车牌号设备ID</h3><div style="margin-left:0px;"><h1>背景</h1>
<p>需要从数据库导出车组车牌号设备ID的对应关系</p>
<h1>进数据库</h1>
<p>添加查询
SELECT gr.GroupName,v.CarLicence,v.DeviceID from vehicledevice as v LEFT JOIN groupinfo as gr ON gr.ID=v.GroupID ;
然后保存查询，名字随意
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=42fa326e1013795d50dba2174234d4c6" alt="" />
然后导出，服务器上导出为excel可能会失败，最好导出玩为txt
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2c023b905993284d800f2c6a08ebec4c" alt="" /></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=98a0af75b8df5de8118ebf9960056f70" alt="" />
导出的TXT，再导入到EXCEL。注意芯片号前面有0000，注意改下表格属性。
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=9528fdd5a6cc89b04d96e3eae5df4915" alt="" /></p></div><h3>13.5.8、Mysql启动错误处理</h3><div style="margin-left:0px;"><h1>问题：Mysql启动报如下错误</h1>
<p>数据库损坏，尝试进行修复。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=9e4d3c21f7c7eded1817ab4e6792eff7" alt="" /></p>
<p> </p>
<h1>步骤1：修改如下配置，启动mysql。</h1>
<p>在my.ini配置文件的[mysqld] 加参数 innodb_force_recovery=4启动下，不行的话就加大，最大到6。</p>
<p>如果能启动成功，则执行后续步骤2、3、4。</p>
<p>如果不能启动成功，则只执行步骤3，重新安装服务器，所有车辆用户数据丢失。</p>
<p> </p>
<h1>步骤2：启动成功后，备份数据。</h1>
<p>在c盘创建backup目录。</p>
<p>用管理员打开cmd命令行，进入mysql/bin目录。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=2cdf58f3cf2c84481f9026a5a8dfd00a" alt="" /></p>
<p> </p>
<p>执行如下命令备份数据：</p>
<p>mysqldump -uroot -pc6l7r8ceacvi2010vs -h127.0.0.1 -P3307 -E -R --single-transaction -A > c:\backup\20230511.sql</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=294a8ad7c53a3be324b31e16c3a3b76f" alt="" /></p>
<p> </p>
<h1>步骤3：重新安装服务器。</h1>
<p>备份C:\Program Files (x86)\CMS Server\mongodb_3.2\data\db目录到c:\backup目录。（如不需要报表数据，则不需要执行此操作）</p>
<p> </p>
<p>卸载服务器，重新安装服务器。</p>
<p> </p>
<h1>步骤4：恢复mysql数据。</h1>
<p>用管理员打开cmd命令行，进入mysql/bin目录。</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=37214dced9fc0ba550aac99366f062f5" alt="" /></p>
<p> </p>
<p>执行如下命令进入mysql：</p>
<p>mysql -uroot -p c6l7r8ceacvi2010vs</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=dd5e95eed9fcd3c3bd9a1b1d9537e603" alt="" /></p>
<p> </p>
<p>执行如下命令恢复数据:</p>
<p>use wcms4;</p>
<p>source c:\backup\20230511.sql;</p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=db3e15280aa7f99a4bff72967ab8a984" alt="" /></p></div></div><h2>13.6、安全漏洞</h2><div style="margin-left:20px;"><h2>13.6.1、等保安全</h2><div style="margin-left:0px;"><h3>13.6.1.1、CB2等保二/三级介绍</h3><div style="margin-left:30px;"><h2>CB2等保二级</h2>
<p>主要介绍Ceiba2系统等保相关整改项
主要从硬件和软件层面进行介绍
请在最新版本2.6.3.0.63上进行操作
<code>以下表格中标红的权重很高，有其中一项不满足，直接视为等保不通过</code></p>
<h3>硬件层面</h3>
<p><code>针对硬件层面的整改，主要以加强Windows系统本身的安全性为主</code>
本处主要由客户或者技术支持直接操作
参考文档：<a href="http://121.46.24.101:3100/wget/CB2/%E7%AD%89%E4%BF%9D%E5%AE%89%E5%85%A8/Windows%EF%BC%88PC%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E8%A7%84%E8%8C%83V1.0.doc" title="Windows(PC服务器)安全配置规范.DOCX">Windows(PC服务器)安全配置规范.DOCX</a></p>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/a255a2ad4c8e1ae3a11e241761f015d4" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/cb8905a38614cd644ff243de9cb9ab48" alt="" /></p>
<h3>防火墙</h3>
<p><code>服务器本机防火墙必须开启，务必关闭高危端口</code>
21：默认FTP端口
22：默认SSH端口
80：默认HTTP端口
3306：默认Mysql端口
3307：Ceiba2生产环境Mysql端口
3389：默认MSTSC端口
6379：默认Redis端口
8008：运维平台生产环境Mysql端口
27017：Ceiba2生产环境MongoDB端口
27018：Ceiba2生产环境MongoDB_3.2端口</p>
<h3>软件层面</h3>
<h4>1）Nginx整改方案</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/362f4870b92c11caa7105092cdacaeaf" alt="" /></p>
<h4>2）Mysql整改方案</h4>
<p>由于等保二级、三级要求Mysql有安全审计等功能，而目前版本<code>5.5.12</code>无法满足要求，考虑升级到<code>5.7</code>版本
详细操作步骤参考：Mysql整改全步骤
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/81729f7a5437e1f64b9d6cfeaddaf12d" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/adf06c974fd5673da364b1925c17d850" alt="" /></p>
<h4>3）MongoDB整改方案</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/e0b52d2840a7a800ddcf1d20d2839e70" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/fe1220d6d0dc22f70ce8b65eacf56358" alt="" /></p>
<h4>4) Ceiba2业务平台整改方案</h4>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/8a643db691620caa26b4488cf8c16601" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2ee7ba688ba034413415ac0f91458d6e" alt="" /></p></div><h3>13.6.1.2、Mysql等保整改说明</h3><div style="margin-left:30px;"><h2>概述</h2>
<p>Ceiba2自带Mysql为<code>5.5.12</code>版本
升级为<code>5.7</code>版本</p>
<h2>操作步骤</h2>
<h4>1）获取Mysql安装包</h4>
<p>下载地址：<a href="http://121.46.24.101:3100/wget/CB2/%E7%AD%89%E4%BF%9D%E5%AE%89%E5%85%A8/MySql.zip">http://121.46.24.101:3100/wget/CB2/%E7%AD%89%E4%BF%9D%E5%AE%89%E5%85%A8/MySql.zip</a>
解压路径：解压后重命名该目录为Mysql5.7,并复制到~\CMS Server根目录
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/3a5096288e27cc6511a21ff5a9bcc7e2" alt="" /></p>
<h4>2）备份原数据目录</h4>
<p>为了防止误操作，请备份原Mysql5.5数据
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6d5bcd2532548c1cac0f86fae2c96c2d" alt="" /></p>
<h4>3）WCMS4数据库备份</h4>
<p>使用navicat连接mysql,并将wcms4数据库全备<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/72c6b663b7f799a67ccd4c5be55dc6e9" alt="" /></p>
<h4>4）修改配置文件</h4>
<p>修改<code>~CMS Server\MySql5.7\my.ini</code>文件为以下内容：</p>
<table width='100%' class='codestyle'><pre><code class="language-shell">[client]
port=3308
socket=/tmp/mysql.sock
default-character-set=utf8

[mysqld]
skip-grant-tables
basedir="C:/Program Files (x86)/CMS Server/MySql5.7/"         --修改为实际的路径
datadir="C:/Program Files (x86)/CMS Server/MySql5.7/data/"    --修改为实际的路径
port=3308
socket=/tmp/mysql.sock
character-set-server=utf8
back_log=187
max_allowed_packet=35M
max_heap_table_size=315M
sort_buffer_size=47M
join_buffer_size=18M
thread_cache_size=80
thread_concurrency=120
query_cache_size=145M
query_cache_limit=2M
ft_min_word_len=4
default-storage-engine=InnoDB
transaction_isolation=REPEATABLE-READ
tmp_table_size=230M
table_open_cache=380
server-id=1
key_buffer_size=82M
thread_stack=407K
read_rnd_buffer_size=34M
innodb_additional_mem_pool_size=20M
innodb_buffer_pool_size=1768M
innodb_data_file_path=ibdata1:10M:autoextend
innodb_read_io_threads=20
innodb_write_io_threads=20
innodb_thread_concurrency=28
innodb_flush_log_at_trx_commit=1
innodb_log_buffer_size=8M
innodb_log_file_size=1024M
innodb_log_files_in_group=2
innodb_max_dirty_pages_pct=90
innodb_lock_wait_timeout=120
read_buffer_size=5M
max_connections=1200
max_connect_errors=21
innodb_file_per_table=true
skip-external-locking=true
skip-name-resolve=true
bind_address=127.0.0.1
federated
[mysqldump]
max_allowed_packet=16M
quick
[mysql]
no-auto-rehash

[mysqld_safe]
open-files-limit=32258</code></pre></table>
<h4>5）安装数据库服务</h4>
<p>进入Mysql5.7的bin目录，地址栏输入cmd,进入命令行
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/43544f1530fa1cc8a21474413e60f1ee" alt="" />
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/6aefea0606c0dc6350ab29fe4ff86f02" alt="" />
输入服务安装指令：</p>
<table width='100%' class='codestyle'><pre><code class="language-shell">mysqld.exe --install Mysql5.7 --defaults-file="~\CMS Server\MySql5.7\my.ini"   --配置文件以实际目录为准</code></pre></table>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/34dba5cae3a63791160624c146404423" alt="" />
出现以上结果即为安装成功，启动服务：任务管理器-服务-服务-Mysql5.7-启动
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/2e508ad7e772b40745ec923447648856" alt="" /></p>
<h4>5）启动mysql5.7</h4>
<h4>6）初始化数据库</h4>
<p>进入Mysql5.7的bin目录，cmd进入命令行
mysql -uroot -p -P3308 -hlocalhost
密码： 回车即可</p></div></div><h2>13.6.2、业务安全漏洞</h2><div style="margin-left:0px;"><h3>13.6.2.1、log4j2漏洞</h3><div style="margin-left:30px;"><h1>log4j2漏洞</h1>
<blockquote>
<p>注意：只影响263以上有BaseDataServer的服务器。</p>
</blockquote>
<h2>漏洞描述</h2>
<p>Apache Log4j2 是一款开源的 Java 日志记录工具，大量的业务框架都使用了该组件。此次漏洞是用于 Log4j2 提供的 lookup 功能造成的，该功能允许开发者通过一些协议去读取相应环境中的配置。但在实现的过程中，并未对输入进行严格的判断，从而造成漏洞的发生。
Apache Log4j2 远程代码执行漏洞的详细信息已被披露，本次 Apache Log4j 远程代码执行漏洞，正是由于组件存在 Java JNDI 注入漏洞：当程序将用户输入的数据记入日志时，攻击者通过构造特殊请求，来触发 Apache Log4j2 中的远程代码执行漏洞，从而利用此漏洞在目标服务器上执行任意代码。</p>
<h2>解决方案</h2>
<p>（1）找到CMS Server\TransmitServer\BaseDataServer\bin目录下start.bat,插入一行。</p>
<table width='100%' class='codestyle'><pre><code>-Dlog4j2.formatMsgNoLookups=true ^</code></pre></table>
<blockquote>
<p>没打错，就是有"^"</p>
</blockquote>
<p><img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile/sign/22ecf51b03c100e49236101f0392a68e" alt="" /></p>
<p>（2）然后重启BasedataServer即可。</p></div><h3>13.6.2.2、apache安全漏洞处理方案</h3><div style="margin-left:30px;"><h1>问题</h1>
<p>1) 服务“Apache2.2”运行“Apache HTTP Server” v2.2.16，这容易受到处于 [2.0.0，2.4.48]之间版本中存在的“CVE-2021-40438”的攻击。该漏洞是在<a href="https://nvd.nist.gov/vuln/detail/CVE-2021-40438">National Vulnerability Database (NVD)</a>中基于CPE '“CPE:2.3:a:apache:http_server”发现的，NVD严重程度为' Critical '。
此漏洞有一个已知的可利用攻击点。来源: <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">CISA Known Exploited Vulnerabilities Catalog</a>(<a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">https://www.cisa.gov/known-exploited-vulnerabilities-catalog</a>)。</p>
<h1>建议解决方案</h1>
<p>前提：确认是否有没有nginx
前提：确认是否有没有nginx
前提：确认是否有没有nginx
没有nginx，需要手动安装nginx和配置。</p>
<h2>手动安装nginx版本（复杂操作，最好联系专家部战区接口人配合处理）</h2>
<h2>有nginx按照方案修改配置文件（复杂操作，最好联系专家部战区接口人配合处理）。</h2>
<p>需要改wcms4-rest服务配置文件--bbkconfig.xml
需要改均衡服务配置文件--BAGConfig.json
需要新增nginx配置文件---nginx.conf，</p>
<h2>操作指南</h2>
<p>更换apache到windows  iis  ，操作指南：
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=63a5776b0cf4ed07705f21fa300164c3" title="[Window 环境下 IIS服务部署WCMS4.0 Web服务.docx">Window 环境下 IIS服务部署WCMS4.0 Web服务.docx</a>
设置防火墙规则，仅仅允许运维1.X 3.X的IP 访问CB2的12055，操作指南
<a href="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=980297b463d5a5146e40407ea8f76d00" title="[如何禁止外网访问CEIBA2 12055端口访问.docx">如何禁止外网访问CEIBA2 12055端口访问.docx</a>
或者让客户在服务器上层的硬件防火墙做如上配置。</p>
<h2>场景说明</h2>
<p>场景1： 运维1.X和CB2部署在同一个服务器上。
方案：关闭12055的外网映射和windows防火墙的端口例外。</p>
<p>场景2： 运维1.X或者运维3.X和CB2部署在同一个局域网
方案1：更换apache到windows  iis<br />
方案2：关闭12055的外网映射和
方案3：设置防火墙规则，仅仅允许运维1.X 3.X的IP 访问CB2的12055。</p>
<p>场景3：运维1.X或者运维3.X和CB2通过公网互访
方案1：更换apache到windows  iis<br />
方案2：设置防火墙规则，仅仅允许运维1.X 3.X的IP 访问CB2的12055</p></div><h3>13.6.2.3、12055及12040及12056安全漏洞处理方案</h3><div style="margin-left:30px;"><h1>12055 apache服务安全漏洞</h1>
<h1>12040 wcms-rest服务安全漏洞</h1>
<p>slow http denial of service attack
<img style='max-width:500' src="http://jfwiki.streamax.com:7503/server/index.php?s=/api/attachment/visitFile&sign=9166fa72e6ba34598f07671ed56cddae" alt="" /></p>
<h1>12056 wcms-rest服务安全漏洞</h1>
<h1>解决方案</h1></div></div></div></div></body></html>